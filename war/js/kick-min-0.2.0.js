/*!
 * New BSD License
 *
 * Copyright (c) 2011, Morten Nobel-Joergensen, Kickstart Games ( http://www.kickstartgames.com/ )
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
 * following conditions are met:
 *
 * - Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer.
 * - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following
 * disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -----
 * KICK.math is based on
 * glMatrix.js - High performance matrix and vector operations for WebGL
 * http://code.google.com/p/glmatrix/
 * version 0.9.6
 *
 * Copyright (c) 2011 Brandon Jones
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */
 'use strict';var KICK=KICK||{};KICK.namespace=KICK.namespace||function(h){var h=h.split("."),j=KICK,e;"KICK"===h[0]&&(h=h.slice(1));for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.core");h.Constants={};Object.defineProperties(h.Constants,{_VERSION:{value:"0.0.0",configurable:!0,enumerable:!0},_ASSERT:{value:!0,enumerable:!0,configurable:!0},_DEBUG:{value:!0,enumerable:!0,configurable:!0},_DEGREE_TO_RADIAN:{value:0.01745329251994,enumerable:!0},_RADIAN_TO_DEGREE:{value:57.2957795130824,enumerable:!0},_EPSILON:{value:1.0E-5,enumerable:!0},_LIGHT_TYPE_AMBIENT:{value:1,enumerable:!0},_LIGHT_TYPE_DIRECTIONAL:{value:2,enumerable:!0},_LIGHT_TYPE_POINT:{value:3,
enumerable:!0},GL_DEPTH_BUFFER_BIT:{value:256,enumerable:!0},GL_STENCIL_BUFFER_BIT:{value:1024,enumerable:!0},GL_COLOR_BUFFER_BIT:{value:16384,enumerable:!0},GL_POINTS:{value:0,enumerable:!0},GL_LINES:{value:1,enumerable:!0},GL_LINE_LOOP:{value:2,enumerable:!0},GL_LINE_STRIP:{value:3,enumerable:!0},GL_TRIANGLES:{value:4,enumerable:!0},GL_TRIANGLE_STRIP:{value:5,enumerable:!0},GL_TRIANGLE_FAN:{value:6,enumerable:!0},GL_ZERO:{value:0,enumerable:!0},GL_ONE:{value:1,enumerable:!0},GL_SRC_COLOR:{value:768,
enumerable:!0},GL_ONE_MINUS_SRC_COLOR:{value:769,enumerable:!0},GL_SRC_ALPHA:{value:770,enumerable:!0},GL_ONE_MINUS_SRC_ALPHA:{value:771,enumerable:!0},GL_DST_ALPHA:{value:772,enumerable:!0},GL_ONE_MINUS_DST_ALPHA:{value:773,enumerable:!0},GL_DST_COLOR:{value:774,enumerable:!0},GL_ONE_MINUS_DST_COLOR:{value:775,enumerable:!0},GL_SRC_ALPHA_SATURATE:{value:776,enumerable:!0},GL_FUNC_ADD:{value:32774,enumerable:!0},GL_BLEND_EQUATION:{value:32777,enumerable:!0},GL_BLEND_EQUATION_RGB:{value:32777,enumerable:!0},
GL_BLEND_EQUATION_ALPHA:{value:34877,enumerable:!0},GL_FUNC_SUBTRACT:{value:32778,enumerable:!0},GL_FUNC_REVERSE_SUBTRACT:{value:32779,enumerable:!0},GL_BLEND_DST_RGB:{value:32968,enumerable:!0},GL_BLEND_SRC_RGB:{value:32969,enumerable:!0},GL_BLEND_DST_ALPHA:{value:32970,enumerable:!0},GL_BLEND_SRC_ALPHA:{value:32971,enumerable:!0},GL_CONSTANT_COLOR:{value:32769,enumerable:!0},GL_ONE_MINUS_CONSTANT_COLOR:{value:32770,enumerable:!0},GL_CONSTANT_ALPHA:{value:32771,enumerable:!0},GL_ONE_MINUS_CONSTANT_ALPHA:{value:32772,
enumerable:!0},GL_BLEND_COLOR:{value:32773,enumerable:!0},GL_ARRAY_BUFFER:{value:34962,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER:{value:34963,enumerable:!0},GL_ARRAY_BUFFER_BINDING:{value:34964,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER_BINDING:{value:34965,enumerable:!0},GL_STREAM_DRAW:{value:35040,enumerable:!0},GL_STATIC_DRAW:{value:35044,enumerable:!0},GL_DYNAMIC_DRAW:{value:35048,enumerable:!0},GL_BUFFER_SIZE:{value:34660,enumerable:!0},GL_BUFFER_USAGE:{value:34661,enumerable:!0},GL_CURRENT_VERTEX_ATTRIB:{value:34342,
enumerable:!0},GL_FRONT:{value:1028,enumerable:!0},GL_BACK:{value:1029,enumerable:!0},GL_FRONT_AND_BACK:{value:1032,enumerable:!0},GL_TEXTURE_2D:{value:3553,enumerable:!0},GL_CULL_FACE:{value:2884,enumerable:!0},GL_BLEND:{value:3042,enumerable:!0},GL_DITHER:{value:3024,enumerable:!0},GL_STENCIL_TEST:{value:2960,enumerable:!0},GL_DEPTH_TEST:{value:2929,enumerable:!0},GL_SCISSOR_TEST:{value:3089,enumerable:!0},GL_POLYGON_OFFSET_FILL:{value:32823,enumerable:!0},GL_SAMPLE_ALPHA_TO_COVERAGE:{value:32926,
enumerable:!0},GL_SAMPLE_COVERAGE:{value:32928,enumerable:!0},GL_NO_ERROR:{value:0,enumerable:!0},GL_INVALID_ENUM:{value:1280,enumerable:!0},GL_INVALID_VALUE:{value:1281,enumerable:!0},GL_INVALID_OPERATION:{value:1282,enumerable:!0},GL_OUT_OF_MEMORY:{value:1285,enumerable:!0},GL_CW:{value:2304,enumerable:!0},GL_CCW:{value:2305,enumerable:!0},GL_LINE_WIDTH:{value:2849,enumerable:!0},GL_ALIASED_POINT_SIZE_RANGE:{value:33901,enumerable:!0},GL_ALIASED_LINE_WIDTH_RANGE:{value:33902,enumerable:!0},GL_CULL_FACE_MODE:{value:2885,
enumerable:!0},GL_FRONT_FACE:{value:2886,enumerable:!0},GL_DEPTH_RANGE:{value:2928,enumerable:!0},GL_DEPTH_WRITEMASK:{value:2930,enumerable:!0},GL_DEPTH_CLEAR_VALUE:{value:2931,enumerable:!0},GL_DEPTH_FUNC:{value:2932,enumerable:!0},GL_STENCIL_CLEAR_VALUE:{value:2961,enumerable:!0},GL_STENCIL_FUNC:{value:2962,enumerable:!0},GL_STENCIL_FAIL:{value:2964,enumerable:!0},GL_STENCIL_PASS_DEPTH_FAIL:{value:2965,enumerable:!0},GL_STENCIL_PASS_DEPTH_PASS:{value:2966,enumerable:!0},GL_STENCIL_REF:{value:2967,
enumerable:!0},GL_STENCIL_VALUE_MASK:{value:2963,enumerable:!0},GL_STENCIL_WRITEMASK:{value:2968,enumerable:!0},GL_STENCIL_BACK_FUNC:{value:34816,enumerable:!0},GL_STENCIL_BACK_FAIL:{value:34817,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_FAIL:{value:34818,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_PASS:{value:34819,enumerable:!0},GL_STENCIL_BACK_REF:{value:36003,enumerable:!0},GL_STENCIL_BACK_VALUE_MASK:{value:36004,enumerable:!0},GL_STENCIL_BACK_WRITEMASK:{value:36005,enumerable:!0},GL_VIEWPORT:{value:2978,
enumerable:!0},GL_SCISSOR_BOX:{value:3088,enumerable:!0},GL_COLOR_CLEAR_VALUE:{value:3106,enumerable:!0},GL_COLOR_WRITEMASK:{value:3107,enumerable:!0},GL_UNPACK_ALIGNMENT:{value:3317,enumerable:!0},GL_PACK_ALIGNMENT:{value:3333,enumerable:!0},GL_MAX_TEXTURE_SIZE:{value:3379,enumerable:!0},GL_MAX_VIEWPORT_DIMS:{value:3386,enumerable:!0},GL_SUBPIXEL_BITS:{value:3408,enumerable:!0},GL_RED_BITS:{value:3410,enumerable:!0},GL_GREEN_BITS:{value:3411,enumerable:!0},GL_BLUE_BITS:{value:3412,enumerable:!0},
GL_ALPHA_BITS:{value:3413,enumerable:!0},GL_DEPTH_BITS:{value:3414,enumerable:!0},GL_STENCIL_BITS:{value:3415,enumerable:!0},GL_POLYGON_OFFSET_UNITS:{value:10752,enumerable:!0},GL_POLYGON_OFFSET_FACTOR:{value:32824,enumerable:!0},GL_TEXTURE_BINDING_2D:{value:32873,enumerable:!0},GL_SAMPLE_BUFFERS:{value:32936,enumerable:!0},GL_SAMPLES:{value:32937,enumerable:!0},GL_SAMPLE_COVERAGE_VALUE:{value:32938,enumerable:!0},GL_SAMPLE_COVERAGE_INVERT:{value:32939,enumerable:!0},GL_NUM_COMPRESSED_TEXTURE_FORMATS:{value:34466,
enumerable:!0},GL_COMPRESSED_TEXTURE_FORMATS:{value:34467,enumerable:!0},GL_DONT_CARE:{value:4352,enumerable:!0},GL_FASTEST:{value:4353,enumerable:!0},GL_NICEST:{value:4354,enumerable:!0},GL_GENERATE_MIPMAP_HINT:{value:33170,enumerable:!0},GL_BYTE:{value:5120,enumerable:!0},GL_UNSIGNED_BYTE:{value:5121,enumerable:!0},GL_SHORT:{value:5122,enumerable:!0},GL_UNSIGNED_SHORT:{value:5123,enumerable:!0},GL_INT:{value:5124,enumerable:!0},GL_UNSIGNED_INT:{value:5125,enumerable:!0},GL_FLOAT:{value:5126,enumerable:!0},
GL_DEPTH_COMPONENT:{value:6402,enumerable:!0},GL_ALPHA:{value:6406,enumerable:!0},GL_RGB:{value:6407,enumerable:!0},GL_RGBA:{value:6408,enumerable:!0},GL_LUMINANCE:{value:6409,enumerable:!0},GL_LUMINANCE_ALPHA:{value:6410,enumerable:!0},GL_UNSIGNED_SHORT_4_4_4_4:{value:32819,enumerable:!0},GL_UNSIGNED_SHORT_5_5_5_1:{value:32820,enumerable:!0},GL_UNSIGNED_SHORT_5_6_5:{value:33635,enumerable:!0},GL_FRAGMENT_SHADER:{value:35632,enumerable:!0},GL_VERTEX_SHADER:{value:35633,enumerable:!0},GL_MAX_VERTEX_ATTRIBS:{value:34921,
enumerable:!0},GL_MAX_VERTEX_UNIFORM_VECTORS:{value:36347,enumerable:!0},GL_MAX_VARYING_VECTORS:{value:36348,enumerable:!0},GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS:{value:35661,enumerable:!0},GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS:{value:35660,enumerable:!0},GL_MAX_TEXTURE_IMAGE_UNITS:{value:34930,enumerable:!0},GL_MAX_FRAGMENT_UNIFORM_VECTORS:{value:36349,enumerable:!0},GL_SHADER_TYPE:{value:35663,enumerable:!0},GL_DELETE_STATUS:{value:35712,enumerable:!0},GL_LINK_STATUS:{value:35714,enumerable:!0},GL_VALIDATE_STATUS:{value:35715,
enumerable:!0},GL_ATTACHED_SHADERS:{value:35717,enumerable:!0},GL_ACTIVE_UNIFORMS:{value:35718,enumerable:!0},GL_ACTIVE_ATTRIBUTES:{value:35721,enumerable:!0},GL_SHADING_LANGUAGE_VERSION:{value:35724,enumerable:!0},GL_CURRENT_PROGRAM:{value:35725,enumerable:!0},GL_NEVER:{value:512,enumerable:!0},GL_LESS:{value:513,enumerable:!0},GL_EQUAL:{value:514,enumerable:!0},GL_LEQUAL:{value:515,enumerable:!0},GL_GREATER:{value:516,enumerable:!0},GL_NOTEQUAL:{value:517,enumerable:!0},GL_GEQUAL:{value:518,enumerable:!0},
GL_ALWAYS:{value:519,enumerable:!0},GL_KEEP:{value:7680,enumerable:!0},GL_REPLACE:{value:7681,enumerable:!0},GL_INCR:{value:7682,enumerable:!0},GL_DECR:{value:7683,enumerable:!0},GL_INVERT:{value:5386,enumerable:!0},GL_INCR_WRAP:{value:34055,enumerable:!0},GL_DECR_WRAP:{value:34056,enumerable:!0},GL_VENDOR:{value:7936,enumerable:!0},GL_RENDERER:{value:7937,enumerable:!0},GL_VERSION:{value:7938,enumerable:!0},GL_NEAREST:{value:9728,enumerable:!0},GL_LINEAR:{value:9729,enumerable:!0},GL_NEAREST_MIPMAP_NEAREST:{value:9984,
enumerable:!0},GL_LINEAR_MIPMAP_NEAREST:{value:9985,enumerable:!0},GL_NEAREST_MIPMAP_LINEAR:{value:9986,enumerable:!0},GL_LINEAR_MIPMAP_LINEAR:{value:9987,enumerable:!0},GL_TEXTURE_MAG_FILTER:{value:10240,enumerable:!0},GL_TEXTURE_MIN_FILTER:{value:10241,enumerable:!0},GL_TEXTURE_WRAP_S:{value:10242,enumerable:!0},GL_TEXTURE_WRAP_T:{value:10243,enumerable:!0},GL_TEXTURE:{value:5890,enumerable:!0},GL_TEXTURE_CUBE_MAP:{value:34067,enumerable:!0},GL_TEXTURE_BINDING_CUBE_MAP:{value:34068,enumerable:!0},
GL_TEXTURE_CUBE_MAP_POSITIVE_X:{value:34069,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_X:{value:34070,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Y:{value:34071,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:{value:34072,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Z:{value:34073,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:{value:34074,enumerable:!0},GL_MAX_CUBE_MAP_TEXTURE_SIZE:{value:34076,enumerable:!0},GL_TEXTURE0:{value:33984,enumerable:!0},GL_TEXTURE1:{value:33985,enumerable:!0},GL_TEXTURE2:{value:33986,
enumerable:!0},GL_TEXTURE3:{value:33987,enumerable:!0},GL_TEXTURE4:{value:33988,enumerable:!0},GL_TEXTURE5:{value:33989,enumerable:!0},GL_TEXTURE6:{value:33990,enumerable:!0},GL_TEXTURE7:{value:33991,enumerable:!0},GL_TEXTURE8:{value:33992,enumerable:!0},GL_TEXTURE9:{value:33993,enumerable:!0},GL_TEXTURE10:{value:33994,enumerable:!0},GL_TEXTURE11:{value:33995,enumerable:!0},GL_TEXTURE12:{value:33996,enumerable:!0},GL_TEXTURE13:{value:33997,enumerable:!0},GL_TEXTURE14:{value:33998,enumerable:!0},GL_TEXTURE15:{value:33999,
enumerable:!0},GL_TEXTURE16:{value:34E3,enumerable:!0},GL_TEXTURE17:{value:34001,enumerable:!0},GL_TEXTURE18:{value:34002,enumerable:!0},GL_TEXTURE19:{value:34003,enumerable:!0},GL_TEXTURE20:{value:34004,enumerable:!0},GL_TEXTURE21:{value:34005,enumerable:!0},GL_TEXTURE22:{value:34006,enumerable:!0},GL_TEXTURE23:{value:34007,enumerable:!0},GL_TEXTURE24:{value:34008,enumerable:!0},GL_TEXTURE25:{value:34009,enumerable:!0},GL_TEXTURE26:{value:34010,enumerable:!0},GL_TEXTURE27:{value:34011,enumerable:!0},
GL_TEXTURE28:{value:34012,enumerable:!0},GL_TEXTURE29:{value:34013,enumerable:!0},GL_TEXTURE30:{value:34014,enumerable:!0},GL_TEXTURE31:{value:34015,enumerable:!0},GL_ACTIVE_TEXTURE:{value:34016,enumerable:!0},GL_REPEAT:{value:10497,enumerable:!0},GL_CLAMP_TO_EDGE:{value:33071,enumerable:!0},GL_MIRRORED_REPEAT:{value:33648,enumerable:!0},GL_FLOAT_VEC2:{value:35664,enumerable:!0},GL_FLOAT_VEC3:{value:35665,enumerable:!0},GL_FLOAT_VEC4:{value:35666,enumerable:!0},GL_INT_VEC2:{value:35667,enumerable:!0},
GL_INT_VEC3:{value:35668,enumerable:!0},GL_INT_VEC4:{value:35669,enumerable:!0},GL_BOOL:{value:35670,enumerable:!0},GL_BOOL_VEC2:{value:35671,enumerable:!0},GL_BOOL_VEC3:{value:35672,enumerable:!0},GL_BOOL_VEC4:{value:35673,enumerable:!0},GL_FLOAT_MAT2:{value:35674,enumerable:!0},GL_FLOAT_MAT3:{value:35675,enumerable:!0},GL_FLOAT_MAT4:{value:35676,enumerable:!0},GL_SAMPLER_2D:{value:35678,enumerable:!0},GL_SAMPLER_CUBE:{value:35680,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_ENABLED:{value:34338,enumerable:!0},
GL_VERTEX_ATTRIB_ARRAY_SIZE:{value:34339,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_STRIDE:{value:34340,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_TYPE:{value:34341,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_NORMALIZED:{value:34922,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_POINTER:{value:34373,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:{value:34975,enumerable:!0},GL_COMPILE_STATUS:{value:35713,enumerable:!0},GL_SHADER_COMPILER:{value:36346,enumerable:!0},GL_LOW_FLOAT:{value:36336,enumerable:!0},GL_MEDIUM_FLOAT:{value:36337,
enumerable:!0},GL_HIGH_FLOAT:{value:36338,enumerable:!0},GL_LOW_INT:{value:36339,enumerable:!0},GL_MEDIUM_INT:{value:36340,enumerable:!0},GL_HIGH_INT:{value:36341,enumerable:!0},GL_FRAMEBUFFER:{value:36160,enumerable:!0},GL_RENDERBUFFER:{value:36161,enumerable:!0},GL_RGBA4:{value:32854,enumerable:!0},GL_RGB5_A1:{value:32855,enumerable:!0},GL_RGB565:{value:36194,enumerable:!0},GL_DEPTH_COMPONENT16:{value:33189,enumerable:!0},GL_STENCIL_INDEX:{value:6401,enumerable:!0},GL_STENCIL_INDEX8:{value:36168,
enumerable:!0},GL_DEPTH_STENCIL:{value:34041,enumerable:!0},GL_RENDERBUFFER_WIDTH:{value:36162,enumerable:!0},GL_RENDERBUFFER_HEIGHT:{value:36163,enumerable:!0},GL_RENDERBUFFER_INTERNAL_FORMAT:{value:36164,enumerable:!0},GL_RENDERBUFFER_RED_SIZE:{value:36176,enumerable:!0},GL_RENDERBUFFER_GREEN_SIZE:{value:36177,enumerable:!0},GL_RENDERBUFFER_BLUE_SIZE:{value:36178,enumerable:!0},GL_RENDERBUFFER_ALPHA_SIZE:{value:36179,enumerable:!0},GL_RENDERBUFFER_DEPTH_SIZE:{value:36180,enumerable:!0},GL_RENDERBUFFER_STENCIL_SIZE:{value:36181,
enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:{value:36048,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:{value:36049,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:{value:36050,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:{value:36051,enumerable:!0},GL_COLOR_ATTACHMENT0:{value:36064,enumerable:!0},GL_DEPTH_ATTACHMENT:{value:36096,enumerable:!0},GL_STENCIL_ATTACHMENT:{value:36128,enumerable:!0},GL_DEPTH_STENCIL_ATTACHMENT:{value:33306,enumerable:!0},GL_NONE:{value:0,
enumerable:!0},GL_FRAMEBUFFER_COMPLETE:{value:36053,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:{value:36054,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:{value:36055,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:{value:36057,enumerable:!0},GL_FRAMEBUFFER_UNSUPPORTED:{value:36061,enumerable:!0},GL_FRAMEBUFFER_BINDING:{value:36006,enumerable:!0},GL_RENDERBUFFER_BINDING:{value:36007,enumerable:!0},GL_MAX_RENDERBUFFER_SIZE:{value:34024,enumerable:!0},GL_INVALID_FRAMEBUFFER_OPERATION:{value:1286,
enumerable:!0},GL_UNPACK_FLIP_Y_WEBGL:{value:37440,enumerable:!0},GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL:{value:37441,enumerable:!0},GL_CONTEXT_LOST_WEBGL:{value:37442,enumerable:!0},GL_UNPACK_COLORSPACE_CONVERSION_WEBGL:{value:37443,enumerable:!0},GL_BROWSER_DEFAULT_WEBGL:{value:37444,enumerable:!0}})})();this.exports=this.exports||{};exports.Constants=KICK.core.Constants;KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){KICK.namespace("KICK.material").GLSLConstants={"error_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main(void)\n{\ngl_FragColor = vec4(1.0,0.5, 0.9, 1.0);\n}","error_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ","light.glsl":"struct DirectionalLight {\nvec3 lDir;\nvec3 colInt;\nvec3 halfV;\n};\n// assumes that normal is normalized\nvoid getDirectionalLight(vec3 normal, DirectionalLight dLight, float specularExponent, out vec3 diffuse, out float specular){\nfloat diffuseContribution = max(dot(normal, dLight.lDir), 0.0);\n\tfloat specularContribution = max(dot(normal, dLight.halfV), 0.0);\nspecular = pow(specularContribution, specularExponent);\n\tdiffuse = (dLight.colInt * diffuseContribution);\n}\nuniform DirectionalLight _dLight;\nuniform vec3 _ambient;","phong_fs.glsl":'#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform vec3 mainColor;\nuniform float specularExponent;\nuniform vec3 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\n#pragma include "shadowmap.glsl"\nvoid main(void)\n{\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(vNormal, _dLight, specularExponent, diffuse, specular);\nfloat visibility;\nif (SHADOWS){\ncomputeLightVisibility();\n} else {\nvisibility = 1.0;\n}\nvec3 color = max(diffuse*visibility,_ambient.xyz)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*vec4(color, 1.0)+vec4(specular*specularColor,0.0);\n}\n',
"phong_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat4 _lightMat;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec4 vShadowMapCoord;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\ngl_Position = _mvProj * v;\nvUv = uv1;\nvNormal= normalize(_norm * normal);\nvShadowMapCoord = _lightMat * v;\n} ","pick_fs.glsl":"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 gameObjectUID;\nvoid main(void)\n{\ngl_FragColor = gameObjectUID;\n}",
"pick_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nuniform vec4 _gameObjectUID;\nvarying vec4 gameObjectUID;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\ngameObjectUID = _gameObjectUID;\n}","shadowmap.glsl":"varying vec4 vShadowMapCoord;\nuniform sampler2D _shadowMapTexture;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 16777216.0 ), 1.0 / ( 65536.0 ), 1.0 / 256.0, 1.0 );\nreturn dot( rgba_depth, bit_shift );\n}\nfloat computeLightVisibility(){\nvec3 shadowCoord = vShadowMapCoord.xyz / vShadowMapCoord.w;\nvec4 packedShadowDepth = texture2D(_shadowMapTexture,shadowCoord.xy);\nfloat shadowDepth = unpackDepth(packedShadowDepth);\nif (shadowDepth < shadowCoord.z){\nreturn 1.0;\n}\nreturn 0.0;\n}",
"shadowmap_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 packDepth( const in float depth ) {\nconst vec4 bitShift = vec4( 16777216.0, 65536.0, 256.0, 1.0 );\nconst vec4 bitMask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bitShift );\nres -= res.xxyz * bitMask;\nreturn res;\n}\nvoid main() {\ngl_FragColor = packDepth( gl_FragCoord.z );\n}\n","shadowmap_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ",
"transparent_phong_fs.glsl":'#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform vec4 mainColor;\nuniform float specularExponent;\nuniform vec3 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\nvoid main(void)\n{\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(vNormal, _dLight, specularExponent, diffuse, specular);\nvec4 color = vec4(max(diffuse,_ambient.xyz),1.0)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*color+vec4(specular*specularColor,0.0);\n}\n',
"transparent_phong_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n// compute light info\nvNormal= normalize(_norm * normal);\n} ","transparent_unlit_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = texture2D(mainTexture,vUv)*mainColor;\n}\n",
"transparent_unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}","unlit_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nuniform vec3 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = texture2D(mainTexture,vUv)*vec4(mainColor,1.0);\n}\n","unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}"}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.math"),j=KICK.namespace("KICK.math.vec2"),e=KICK.namespace("KICK.math.vec3"),u=KICK.namespace("KICK.math.vec4"),m=KICK.namespace("KICK.math.mat3"),c=KICK.namespace("KICK.math.mat4"),f=KICK.namespace("KICK.math.quat4"),g=KICK.namespace("KICK.math.aabb"),x=Math.min,A=Math.max,l=Math.sqrt,o=Math.cos,y=Math.acos,n=Math.sin,s=Math.asin,t=Math.abs,w=Math.tan,q=Math.atan,v=Math.atan2,r=Math.PI,z=function(a,b){var d,i=0,k=a.length/b,c=Array(k);for(d=0;d<k;d++,i+=b)c[d]=
a.subarray(i,i+b);return c};h.vec2=j;j.wrapArray=function(a){return z(a,2)};j.array=function(a,b){var d=new Float32Array(2*a);if(b)b.mem=d;return j.wrapArray(d)};j.create=function(a){var b=new Float32Array(2);a&&(b[0]=a[0],b[1]=a[1]);return b};j.set=function(a,b){b[0]=a[0];b[1]=a[1];return b};j.add=function(a,b,d){if(!d||a==d)return a[0]+=b[0],a[1]+=b[1],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];return d};j.subtract=function(a,b,d){if(!d||a==d)return a[0]-=b[0],a[1]-=b[1],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];return d};
j.equal=function(a,b,d){d||(d=1.0E-5);for(var i=0;2>i;i++)if(t(a[i]-b[i])>d)return!1;return!0};j.normalize=function(a,b){b||(b=a);var d=a[0],i=a[1],k=l(d*d+i*i);if(k){if(1==k)return b[0]=d,b[1]=i,b}else return b[0]=0,b[1]=0,b;k=1/k;b[0]=d*k;b[1]=i*k;return b};h.vec3=e;e.wrapArray=function(a){return z(a,3)};e.array=function(a,b){var d=new Float32Array(3*a);if(b)b.mem=d;return e.wrapArray(d)};e.create=function(a){var b=new Float32Array(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b};e.set=function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};e.add=function(a,b,d){if(!d||a===d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d};e.subtract=function(a,b,d){if(!d||a===d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};e.equal=function(a,b,d){d||(d=1.0E-5);for(var i=0;3>i;i++)if(t(a[i]-b[i])>d)return!1;return!0};e.multiply=function(a,b,d){if(!d||a==d)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;d[0]=a[0]*b[0];
d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};e.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};e.scale=function(a,b,d){if(!d||a===d)return a[0]*=b,a[1]*=b,a[2]*=b,a;d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};e.normalize=function(a,b){b||(b=a);var d=a[0],i=a[1],k=a[2],c=Math.sqrt(d*d+i*i+k*k);if(c){if(1===c)return b[0]=d,b[1]=i,b[2]=k,b}else return b[0]=0,b[1]=0,b[2]=0,b;c=1/c;b[0]=d*c;b[1]=i*c;b[2]=k*c;return b};e.cross=function(a,b,d){d||(d=a);var i=a[0],k=a[1],a=a[2],c=b[0],
p=b[1],b=b[2];d[0]=k*b-a*p;d[1]=a*c-i*b;d[2]=i*p-k*c;return d};e.length=function(a){var b=a[0],d=a[1],a=a[2];return l(b*b+d*d+a*a)};e.lengthSqr=function(a){var b=a[0],d=a[1],a=a[2];return b*b+d*d+a*a};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};e.direction=function(a,b,d){d||(d=a);var i=a[0]-b[0],k=a[1]-b[1],a=a[2]-b[2],b=l(i*i+k*k+a*a);if(!b)return d[0]=0,d[1]=0,d[2]=0,d;b=1/b;d[0]=i*b;d[1]=k*b;d[2]=a*b;return d};e.lerp=function(a,b,d,i){i||(i=a);i[0]=a[0]+d*(b[0]-a[0]);i[1]=a[1]+d*
(b[1]-a[1]);i[2]=a[2]+d*(b[2]-a[2]);return i};e.dist=function(a,b){var d=b[0]-a[0],i=b[1]-a[1],k=b[2]-a[2];return Math.sqrt(d*d+i*i+k*k)};e.unproject=function(a,b,d,i,k){k||(k=a);var f=c.create(),p=new Float32Array(4);p[0]=2*(a[0]-i[0])/i[2]-1;p[1]=2*(a[1]-i[1])/i[3]-1;p[2]=2*a[2]-1;p[3]=1;c.multiply(d,b,f);if(!c.inverse(f))return null;c.multiplyVec4(f,p);if(0===p[3])return null;k[0]=p[0]/p[3];k[1]=p[1]/p[3];k[2]=p[2]/p[3];return k};e.sphericalToCarterian=function(a,b){var d=a[0],i=-a[1],k=a[2],c=
d*o(k);b||(b=e.create());b[0]=c*o(i);b[1]=d*n(k);b[2]=c*n(i);return b};e.cartesianToSpherical=function(a,b){var d=a[0],i=a[1],k=a[2],c;0==d&&(d=1.0E-5);b||(b=e.create());b[0]=c=l(d*d+i*i+k*k);b[1]=-q(k/d);0>d&&(b[1]+=r);b[2]=s(i/c);return b};e.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};h.vec4=u;u.wrapArray=function(a){return z(a,4)};u.array=function(a,b){var d=new Float32Array(4*a);if(b)b.mem=d;return u.wrapArray(d)};u.create=function(a){var b=new Float32Array(4);a&&(b[0]=a[0],b[1]=a[1],
b[2]=a[2],b[3]=a[3]);return b};u.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};u.add=function(a,b,d){if(!d||a==d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};u.subtract=function(a,b,d){if(!d||a==d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a[3]-=b[3],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};u.equal=function(a,b,d){d||(d=1.0E-5);for(var i=0;2>i;i++)if(t(a[i]-b[i])>d)return!1;
return!0};u.multiply=function(a,b,d){if(!d||a==d)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a[3]*=b[3],a;d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};u.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};u.length=function(a){var b=a[0],d=a[1],i=a[2],a=a[3];return l(b*b+d*d+i*i+a*a)};u.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};u.scale=function(a,b,d){if(!d||a==d)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;d[0]=a[0]*b;d[1]=a[1]*
b;d[2]=a[2]*b;d[3]=a[2]*b;return d};u.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};h.mat3=m;m.create=function(a){var b=new Float32Array(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]);return b};m.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};m.identity=function(a){a||(a=m.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};m.transpose=
function(a,b){if(!b||a===b){var d=a[1],i=a[2],k=a[5];a[1]=a[3];a[2]=a[6];a[3]=d;a[5]=a[7];a[6]=i;a[7]=k;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};m.toMat4=function(a,b){b||(b=c.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};m.toQuat=function(a,b){var d=a[0],i=a[1],k=a[2],c=a[3],p=a[4],g=a[5],F=a[6],B=a[7],o=a[8],n=
d+p+o;b||(b=f.create());0<n?(d=0.5/l(n+1),b[0]=(g-B)*d,b[1]=(F-k)*d,b[2]=(i-c)*d,b[3]=0.25/d):d>p&&d>o?(d=2*l(1+d-p-o),b[0]=0.25*d,b[1]=(c+i)/d,b[2]=(F+k)/d,b[3]=(g-B)/d):p>o?(d=2*l(1+p-d-o),b[0]=(c+i)/d,b[1]=0.25*d,b[2]=(B+g)/d,b[3]=(F-k)/d):(d=2*l(1+o-d-p),b[0]=(F+k)/d,b[1]=(B+g)/d,b[2]=0.25*d,b[3]=(i-c)/d);return b};m.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};m.strPretty=function(a){return"["+a[0]+", "+a[3]+", "+a[6]+"\n, "+
a[1]+", "+a[4]+", "+a[7]+"\n, "+a[2]+", "+a[5]+", "+a[8]+"]"};h.mat4=c;c.create=function(a){var b=new Float32Array(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b};c.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};
c.setTRS=function(a,b,d,i){i||(i=c.create());c.identity(i);c.translate(i,a);c.multiply(i,f.toMat4(b));c.scale(i,d);return i};c.setTRSInverse=function(){var a=new Float32Array(4);return function(b,d,i,k){k||(k=c.create());c.identity(k);c.scale(k,[1/i[0],1/i[1],1/i[2]]);f.conjugate(d,a);c.multiply(k,f.toMat4(a));c.translate(k,[-b[0],-b[1],-b[2]]);return k}}();c.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;
return a};c.transpose=function(a,b){if(!b||a===b){var d=a[1],i=a[2],k=a[3],c=a[6],p=a[7],f=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=d;a[6]=a[9];a[7]=a[13];a[8]=i;a[9]=c;a[11]=a[14];a[12]=k;a[13]=p;a[14]=f;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};c.determinant=function(a){var b=a[0],d=a[1],i=a[2],k=a[3],c=a[4],p=a[5],f=a[6],g=a[7],B=a[8],o=a[9],l=a[10],
n=a[11],h=a[12],e=a[13],m=a[14],a=a[15];return h*o*f*k-B*e*f*k-h*p*l*k+c*e*l*k+B*p*m*k-c*o*m*k-h*o*i*g+B*e*i*g+h*d*l*g-b*e*l*g-B*d*m*g+b*o*m*g+h*p*i*n-c*e*i*n-h*d*f*n+b*e*f*n+c*d*m*n-b*p*m*n-B*p*i*a+c*o*i*a+B*d*f*a-b*o*f*a-c*d*l*a+b*p*l*a};c.inverse=function(a,b){b||(b=a);var d=a[0],i=a[1],k=a[2],c=a[3],p=a[4],f=a[5],g=a[6],B=a[7],o=a[8],l=a[9],n=a[10],h=a[11],e=a[12],m=a[13],y=a[14],x=a[15],s=d*f-i*p,r=d*g-k*p,j=d*B-c*p,z=i*g-k*f,w=i*B-c*f,A=k*B-c*g,q=o*m-l*e,t=o*y-n*e,v=o*x-h*e,u=l*y-n*m,K=l*x-
h*m,M=n*x-h*y,D=s*M-r*K+j*u+z*v-w*t+A*q;if(!D)return null;D=1/D;b[0]=(f*M-g*K+B*u)*D;b[1]=(-i*M+k*K-c*u)*D;b[2]=(m*A-y*w+x*z)*D;b[3]=(-l*A+n*w-h*z)*D;b[4]=(-p*M+g*v-B*t)*D;b[5]=(d*M-k*v+c*t)*D;b[6]=(-e*A+y*j-x*r)*D;b[7]=(o*A-n*j+h*r)*D;b[8]=(p*K-f*v+B*q)*D;b[9]=(-d*K+i*v-c*q)*D;b[10]=(e*w-m*j+x*s)*D;b[11]=(-o*w+l*j-h*s)*D;b[12]=(-p*u+f*t-g*q)*D;b[13]=(d*u-i*t+k*q)*D;b[14]=(-e*z+m*r-y*s)*D;b[15]=(o*z-l*r+n*s)*D;return b};c.toRotationMat=function(a,b){b||(b=c.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];
b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};c.toMat3=function(a,b){b||(b=m.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};c.toNormalMat3=function(a,b){var d=a[0],i=a[1],k=a[2],c=a[4],p=a[5],f=a[6],g=a[8],B=a[9],o=a[10],l=o*p-f*B,n=-o*c+f*g,h=B*c-p*g,e=d*l+i*n+k*h;if(!e)return null;e=1/e;b||(b=m.create());b[0]=l*e;b[3]=(-o*i+k*B)*e;b[6]=(f*i-k*
p)*e;b[1]=n*e;b[4]=(o*d-k*g)*e;b[7]=(-f*d+k*c)*e;b[2]=h*e;b[5]=(-B*d+i*g)*e;b[8]=(p*d-i*c)*e;return b};c.toInverseMat3=function(a,b){var d=a[0],i=a[1],k=a[2],c=a[4],p=a[5],f=a[6],g=a[8],B=a[9],o=a[10],l=o*p-f*B,n=-o*c+f*g,e=B*c-p*g,h=d*l+i*n+k*e;if(!h)return null;h=1/h;b||(b=m.create());b[0]=l*h;b[1]=(-o*i+k*B)*h;b[2]=(f*i-k*p)*h;b[3]=n*h;b[4]=(o*d-k*g)*h;b[5]=(-f*d+k*c)*h;b[6]=e*h;b[7]=(-B*d+i*g)*h;b[8]=(p*d-i*c)*h;return b};c.multiply=function(a,b,d){d||(d=a);var i=a[0],k=a[1],c=a[2],p=a[3],f=a[4],
g=a[5],o=a[6],h=a[7],l=a[8],n=a[9],e=a[10],m=a[11],y=a[12],x=a[13],s=a[14],a=a[15],r=b[0],j=b[1],z=b[2],w=b[3],A=b[4],q=b[5],t=b[6],v=b[7],u=b[8],V=b[9],K=b[10],M=b[11],D=b[12],W=b[13],Y=b[14],b=b[15];d[0]=r*i+j*f+z*l+w*y;d[1]=r*k+j*g+z*n+w*x;d[2]=r*c+j*o+z*e+w*s;d[3]=r*p+j*h+z*m+w*a;d[4]=A*i+q*f+t*l+v*y;d[5]=A*k+q*g+t*n+v*x;d[6]=A*c+q*o+t*e+v*s;d[7]=A*p+q*h+t*m+v*a;d[8]=u*i+V*f+K*l+M*y;d[9]=u*k+V*g+K*n+M*x;d[10]=u*c+V*o+K*e+M*s;d[11]=u*p+V*h+K*m+M*a;d[12]=D*i+W*f+Y*l+b*y;d[13]=D*k+W*g+Y*n+b*x;d[14]=
D*c+W*o+Y*e+b*s;d[15]=D*p+W*h+Y*m+b*a;return d};c.multiplyVec3=function(a,b,d){d||(d=b);var i=b[0],k=b[1],b=b[2];d[0]=a[0]*i+a[4]*k+a[8]*b+a[12];d[1]=a[1]*i+a[5]*k+a[9]*b+a[13];d[2]=a[2]*i+a[6]*k+a[10]*b+a[14];return d};c.multiplyVec3Vector=function(a,b,d){d||(d=b);var i=b[0],k=b[1],b=b[2];d[0]=a[0]*i+a[4]*k+a[8]*b;d[1]=a[1]*i+a[5]*k+a[9]*b;d[2]=a[2]*i+a[6]*k+a[10]*b;d[3]=a[3]*i+a[7]*k+a[11]*b;return d};c.multiplyVec4=function(a,b,d){d||(d=b);var i=b[0],k=b[1],c=b[2],b=b[3];d[0]=a[0]*i+a[4]*k+a[8]*
c+a[12]*b;d[1]=a[1]*i+a[5]*k+a[9]*c+a[13]*b;d[2]=a[2]*i+a[6]*k+a[10]*c+a[14]*b;d[3]=a[3]*i+a[7]*k+a[11]*c+a[15]*b;return d};c.translate=function(a,b,d){var i=b[0],k=b[1],b=b[2],c,p,f,g,o,h,l,n,e,m,y,x;if(!d||a===d)return a[12]=a[0]*i+a[4]*k+a[8]*b+a[12],a[13]=a[1]*i+a[5]*k+a[9]*b+a[13],a[14]=a[2]*i+a[6]*k+a[10]*b+a[14],a[15]=a[3]*i+a[7]*k+a[11]*b+a[15],a;c=a[0];p=a[1];f=a[2];g=a[3];o=a[4];h=a[5];l=a[6];n=a[7];e=a[8];m=a[9];y=a[10];x=a[11];d[0]=c;d[1]=p;d[2]=f;d[3]=g;d[4]=o;d[5]=h;d[6]=l;d[7]=n;d[8]=
e;d[9]=m;d[10]=y;d[11]=x;d[12]=c*i+o*k+e*b+a[12];d[13]=p*i+h*k+m*b+a[13];d[14]=f*i+l*k+y*b+a[14];d[15]=g*i+n*k+x*b+a[15];return d};c.scale=function(a,b,d){var i=b[0],k=b[1],b=b[2];if(!d||a===d)return a[0]*=i,a[1]*=i,a[2]*=i,a[3]*=i,a[4]*=k,a[5]*=k,a[6]*=k,a[7]*=k,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;d[0]=a[0]*i;d[1]=a[1]*i;d[2]=a[2]*i;d[3]=a[3]*i;d[4]=a[4]*k;d[5]=a[5]*k;d[6]=a[6]*k;d[7]=a[7]*k;d[8]=a[8]*b;d[9]=a[9]*b;d[10]=a[10]*b;d[11]=a[11]*b;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};
c.rotate=function(a,b,d,i){var k=d[0],c=d[1],d=d[2],p,f,g,h,e,m,y,x,s,r,j,z,w,A,q,t,v,u,J,R,S;h=l(k*k+c*c+d*d);if(!h)return null;1!==h&&(h=1/h,k*=h,c*=h,d*=h);p=n(b);f=o(b);g=1-f;b=a[0];h=a[1];e=a[2];m=a[3];y=a[4];x=a[5];s=a[6];r=a[7];j=a[8];z=a[9];w=a[10];A=a[11];q=k*k*g+f;t=c*k*g+d*p;v=d*k*g-c*p;u=k*c*g-d*p;J=c*c*g+f;R=d*c*g+k*p;S=k*d*g+c*p;k=c*d*g-k*p;c=d*d*g+f;i?a!==i&&(i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15]):i=a;i[0]=b*q+y*t+j*v;i[1]=h*q+x*t+z*v;i[2]=e*q+s*t+w*v;i[3]=m*q+r*t+A*v;i[4]=
b*u+y*J+j*R;i[5]=h*u+x*J+z*R;i[6]=e*u+s*J+w*R;i[7]=m*u+r*J+A*R;i[8]=b*S+y*k+j*c;i[9]=h*S+x*k+z*c;i[10]=e*S+s*k+w*c;i[11]=m*S+r*k+A*c;return i};c.rotateX=function(a,b,d){var i=n(b),b=o(b),k=a[4],c=a[5],p=a[6],f=a[7],g=a[8],h=a[9],l=a[10],e=a[11];d?a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[4]=k*b+g*i;d[5]=c*b+h*i;d[6]=p*b+l*i;d[7]=f*b+e*i;d[8]=k*-i+g*b;d[9]=c*-i+h*b;d[10]=p*-i+l*b;d[11]=f*-i+e*b;return d};c.rotateY=function(a,b,d){var i=n(b),
b=o(b),k=a[0],c=a[1],p=a[2],f=a[3],g=a[8],h=a[9],l=a[10],e=a[11];d?a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=k*b+g*-i;d[1]=c*b+h*-i;d[2]=p*b+l*-i;d[3]=f*b+e*-i;d[8]=k*i+g*b;d[9]=c*i+h*b;d[10]=p*i+l*b;d[11]=f*i+e*b;return d};c.rotateZ=function(a,b,d){var i=n(b),b=o(b),k=a[0],c=a[1],p=a[2],f=a[3],g=a[4],h=a[5],l=a[6],e=a[7];d?a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=k*
b+g*i;d[1]=c*b+h*i;d[2]=p*b+l*i;d[3]=f*b+e*i;d[4]=k*-i+g*b;d[5]=c*-i+h*b;d[6]=p*-i+l*b;d[7]=f*-i+e*b;return d};c.frustum=function(a,b,d,i,k,f,p){p||(p=c.create());var g=b-a,h=i-d,l=f-k;p[0]=2*k/g;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2*k/h;p[6]=0;p[7]=0;p[8]=(b+a)/g;p[9]=(i+d)/h;p[10]=-(f+k)/l;p[11]=-1;p[12]=0;p[13]=0;p[14]=-(2*f*k)/l;p[15]=0;return p};c.perspective=function(a,b,d,i,k){a=d*w(a*r/360);b*=a;return c.frustum(-b,b,-a,a,d,i,k)};c.ortho=function(a,b,d,i,k,f,p){p||(p=c.create());var g=b-a,h=
i-d,l=f-k;p[0]=2/g;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2/h;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=-2/l;p[11]=0;p[12]=-(a+b)/g;p[13]=-(i+d)/h;p[14]=-(f+k)/l;p[15]=1;return p};c.lookAt=function(a,b,d,i){i||(i=c.create());var k=a[0],f=a[1],a=a[2],p=d[0],g=d[1],h=d[2],d=b[1],e=b[2];if(k==b[0]&&f==d&&a==e)return c.identity(i);var o,n,m,y,d=k-b[0],e=f-b[1],b=a-b[2];y=1/l(d*d+e*e+b*b);d*=y;e*=y;b*=y;o=g*b-h*e;h=h*d-p*b;p=p*e-g*d;(y=l(o*o+h*h+p*p))?(y=1/y,o*=y,h*=y,p*=y):p=h=o=0;g=e*p-b*h;n=b*o-d*p;m=d*h-e*o;(y=
l(g*g+n*n+m*m))?(y=1/y,g*=y,n*=y,m*=y):m=n=g=0;i[0]=o;i[1]=g;i[2]=d;i[3]=0;i[4]=h;i[5]=n;i[6]=e;i[7]=0;i[8]=p;i[9]=m;i[10]=b;i[11]=0;i[12]=-(o*k+h*f+p*a);i[13]=-(g*k+n*f+m*a);i[14]=-(d*k+e*f+b*a);i[15]=1;return i};c.decompose=function(a,b,d,i){var k=[a[0],a[1],a[2]],g=[a[4],a[5],a[6]],p=[a[8],a[9],a[10]];b||(b=e.create());d||(d=f.create());i||(i=e.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];i[0]=k=e.length(k);i[1]=g=e.length(g);i[2]=p=e.length(p);a=c.create(a);a[0]/=k;a[1]/=k;a[2]/=k;a[4]/=g;a[5]/=
g;a[6]/=g;a[8]/=p;a[9]/=p;a[10]/=p;f.setFromRotationMatrix(a,d);return[b,d,i]};c.fromRotationTranslation=function(a,b,d){d||(d=c.create());var i=a[0],k=a[1],f=a[2],g=a[3],h=i+i,e=k+k,o=f+f,a=i*h,l=i*e,i=i*o,n=k*e,k=k*o,f=f*o,h=g*h,e=g*e,g=g*o;d[0]=1-(n+f);d[1]=l+g;d[2]=i-e;d[3]=0;d[4]=l-g;d[5]=1-(a+f);d[6]=k+h;d[7]=0;d[8]=i+e;d[9]=k-h;d[10]=1-(a+n);d[11]=0;d[12]=b[0];d[13]=b[1];d[14]=b[2];d[15]=1;return d};c.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+
", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};c.strPretty=function(a){return"["+a[0]+", "+a[4]+", "+a[8]+", "+a[12]+"\n, "+a[1]+", "+a[5]+", "+a[9]+", "+a[13]+"\n, "+a[2]+", "+a[6]+", "+a[10]+", "+a[14]+"\n, "+a[3]+", "+a[7]+", "+a[11]+", "+a[15]+"]"};h.quat4=f;f.create=u.create;f.set=u.set;f.calculateW=function(a,b){var d=a[0],i=a[1],k=a[2],c=-l(t(1-d*d-i*i-k*k));if(!b||a==b)return a[3]=c,a;b[0]=d;b[1]=i;b[2]=k;b[3]=c;return b};f.inverse=function(a,
b){var d=1/f.dot(a,a);if(!b||a==b)return a[0]*=-d,a[1]*=-d,a[2]*=-d,a[3]*=d,a;b[0]=-a[0]*d;b[1]=-a[1]*d;b[2]=-a[2]*d;b[3]=a[3]*d;return b};f.conjugate=function(a,b){if(!b||a==b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};f.length=u.length;f.dot=u.dot;f.normalize=function(a,b){b||(b=a);var d=a[0],i=a[1],k=a[2],c=a[3],f=Math.sqrt(d*d+i*i+k*k+c*c);if(0===f)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;f=1/f;b[0]=d*f;b[1]=i*f;b[2]=k*f;b[3]=c*f;return b};f.multiply=
function(a,b,d){d||(d=a);var i=a[0],k=a[1],c=a[2],a=a[3],f=b[0],g=b[1],h=b[2],b=b[3];d[0]=i*b+a*f+k*h-c*g;d[1]=k*b+a*g+c*f-i*h;d[2]=c*b+a*h+i*g-k*f;d[3]=a*b-i*f-k*g-c*h;return d};f.multiplyVec3=function(a,b,d){d||(d=b);var i=b[0],k=b[1],c=b[2],b=a[0],f=a[1],g=a[2],a=a[3],h=a*i+f*c-g*k,e=a*k+g*i-b*c,o=a*c+b*k-f*i,i=-b*i-f*k-g*c;d[0]=h*a+i*-b+e*-g-o*-f;d[1]=e*a+i*-f+o*-b-h*-g;d[2]=o*a+i*-g+h*-f-e*-b;return d};f.identity=function(a){a||(a=f.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};f.toEuler=function(a,
b){var d=a[0],i=a[1],c=a[2],f=a[3],g=i*i;b||(b=e.create());b[0]=57.2957795130824*v(2*(f*d+i*c),1-2*(d*d+g));b[1]=57.2957795130824*s(2*(f*i-c*d));b[2]=57.2957795130824*v(2*(f*c+d*i),1-2*(g+c*c));return b};f.angleAxis=function(a,b,d){var a=0.00872664625997*a,i=n(a);d||(d=f.create());d[3]=o(a);d[2]=b[2]*i;d[1]=b[1]*i;d[0]=b[0]*i;return d};f.lookAt=function(a,b,d,i,c){var f=e.create(),g=e.create(),h=e.create();e.subtract(a,b,h);e.normalize(h);e.cross(d,h,g);e.normalize(g);e.cross(h,g,f);e.normalize(f);
c||(c=m.create());c[0]=g[0];c[1]=g[1];c[2]=g[2];c[3]=f[0];c[4]=f[1];c[5]=f[2];c[6]=h[0];c[7]=h[1];c[8]=h[2];return m.toQuat(c,i)};f.setEuler=function(a,b){var d=0.00872664625997*a[0],i=0.00872664625997*a[1],c=0.00872664625997*a[2],g=o(d),h=o(i),e=o(c),d=n(d),i=n(i),c=n(c);b||(b=f.create());b[3]=g*h*e+d*i*c;b[0]=d*h*e-g*i*c;b[1]=g*i*e+d*h*c;b[2]=g*h*c-d*i*e;return b};f.setFromRotationMatrix=function(a,b){var d,i,k,g;k=a[0];var h=a[4],e=a[8],o=a[1],l=a[5],n=a[9],m=a[2],y=a[6],x=a[10],s=Math.pow(c.determinant(a),
1/3);g=Math.sqrt(Math.max(0,s+k+l+x))/2;d=Math.sqrt(Math.max(0,s+k-l-x))/2;i=Math.sqrt(Math.max(0,s-k+l-x))/2;k=Math.sqrt(Math.max(0,s-k-l+x))/2;d=0>y-n?-Math.abs(d):Math.abs(d);i=0>e-m?-Math.abs(i):Math.abs(i);k=0>o-h?-Math.abs(k):Math.abs(k);d=[d,i,k,g];b?f.set(d,b):b=f.create(d);f.normalize(b);return b};f.toMat3=function(a,b){b||(b=m.create());var d=a[0],i=a[1],c=a[2],f=a[3],g=d+d,h=i+i,e=c+c,o=d*g,l=d*h,d=d*e,n=i*h,i=i*e,c=c*e,g=f*g,h=f*h,f=f*e;b[0]=1-(n+c);b[1]=l+f;b[2]=d-h;b[3]=l-f;b[4]=1-(o+
c);b[5]=i+g;b[6]=d+h;b[7]=i-g;b[8]=1-(o+n);return b};f.toMat4=function(a,b){b||(b=c.create());var d=a[0],i=a[1],k=a[2],f=a[3],g=d+d,h=i+i,e=k+k,o=d*g,l=d*h,d=d*e,n=i*h,i=i*e,k=k*e,g=f*g,h=f*h,f=f*e;b[0]=1-(n+k);b[1]=l+f;b[2]=d-h;b[3]=0;b[4]=l-f;b[5]=1-(o+k);b[6]=i+g;b[7]=0;b[8]=d+h;b[9]=i-g;b[10]=1-(o+n);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};f.slerp=function(a,b,d,i){i||(i=a);var c=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];if(1<=t(c))return i!=a&&(i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3]),
i;var f=y(c),g=l(1-c*c);if(0.0010>t(g))return i[0]=0.5*a[0]+0.5*b[0],i[1]=0.5*a[1]+0.5*b[1],i[2]=0.5*a[2]+0.5*b[2],i[3]=0.5*a[3]+0.5*b[3],i;c=n((1-d)*f)/g;d=n(d*f)/g;i[0]=a[0]*c+b[0]*d;i[1]=a[1]*c+b[1]*d;i[2]=a[2]*c+b[2]*d;i[3]=a[3]*c+b[3]*d;return i};f.difference=function(a,b,d){d||(d=a);var i=-a[0],c=-a[1],f=-a[2],a=a[3],g=b[0],h=b[1],e=b[2],b=b[3];d[0]=i*b+a*g+c*e-f*h;d[1]=c*b+a*h+f*g-i*e;d[2]=f*b+a*e+i*h-c*g;d[3]=a*b-i*g-c*h-f*e;return d};f.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+
a[3]+"]"};h.aabb=g;g.create=function(a,b){var d=new Float32Array(6);a?(d[0]=a[0],d[1]=a[1],d[2]=a[2],6==a.length?(d[3]=a[3],d[4]=a[4],d[5]=a[5]):b?(d[3]=b[0],d[4]=b[1],d[5]=b[2]):(d[3]=d[0],d[4]=d[1],d[5]=d[2])):(d[0]=Number.MAX_VALUE,d[1]=Number.MAX_VALUE,d[2]=Number.MAX_VALUE,d[3]=Number.MIN_VALUE,d[4]=Number.MIN_VALUE,d[5]=Number.MIN_VALUE);return d};g.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b};g.merge=function(a,b,d){d||(d=new Float32Array(6));d[0]=
x(a[0],b[0]);d[1]=x(a[1],b[1]);d[2]=x(a[2],b[2]);d[3]=A(a[3],b[3]);d[4]=A(a[4],b[4]);d[5]=A(a[5],b[5]);return d};g.addPoint=function(a,b){a[0]=x(a[0],b[0]);a[1]=x(a[1],b[1]);a[2]=x(a[2],b[2]);a[3]=A(a[3],b[0]);a[4]=A(a[4],b[1]);a[5]=A(a[5],b[2]);return a}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.core"),j=KICK.namespace("KICK.scene"),e=new ArrayBuffer(4),u=new Uint32Array(e),m=new Uint8Array(e);h.Engine=function(c,f){var g=null,e="string"===typeof c?document.getElementById(c):c,m=["experimental-webgl","webgl"],l=this,o=(new Date).getTime()-16,y=0,n=new h.Time,s=0,t=0,w=1,q=[],v=[],r,z=new h.Project(this),a=null,b=null,d,i={},k=function(a){l._gameLoop(a)},H=KICK.math.vec2;Object.defineProperties(this,{version:{value:"0.2.0"},resourceManager:{value:new h.ResourceManager(this)},
project:{value:z},gl:{get:function(){return g}},canvas:{value:e},activeScene:{get:function(){return d},set:function(a){d=null===a?new KICK.scene.Scene(engine):a}},mouseInput:{get:function(){a||(a=new h.MouseInput(l),this.addFrameListener(a));return a}},keyInput:{get:function(){b||(b=new h.KeyInput,this.addFrameListener(b));return b}},eventQueue:{get:function(){return r}},time:{value:n},config:{value:new h.Config(f||{})},paused:{get:function(){return null===i},set:function(a){a!=l.paused&&(a?(cancelRequestAnimFrame(i),
i=null):(o=(new Date).getTime()-16,i=requestAnimationFrame(k,this.canvas)))}}});this.isFullScreenSupported=function(){return e.requestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen};this.setFullscreen=function(a){if(this.isFullScreenSupported())a?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?(e.onwebkitfullscreenchange=function(){document.webkitIsFullScreen?(e.originalWidth=e.width,e.originalHeight=e.height,e.width=screen.width,e.height=screen.height):(e.width=
e.originalWidth,e.height=e.originalHeight);l.canvasResized()},e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)):e.mozRequestFullScreen&&e.mozRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};this._gameLoop=function(a){y=a-o;o=a;y*=w;s+=y;t+=1;r.run();this.activeScene.updateAndRender();for(a=v.length-1;0<=a;a--)v[a].frameUpdated();null!==i&&
(i=requestAnimationFrame(k,this.canvas))};this.addFrameListener=function(a){v.push(a)};this.removeFrameListener=function(a){return h.Util.removeElementFromArray(v,a)};this.addContextListener=function(a){q.push(a)};this.removeContextListener=function(a){return h.Util.removeElementFromArray(q,a)};this.createUID=function(){return++z.maxUID};this.getUID=function(a){if(!a.uid)a.uid=l.createUID();return a.uid};this.canvasResized=function(){g.viewportSize=H.create([e.width,e.height]);a&&a.updateCanvasElementPosition()};
(function(){var a,b,i=function(){for(a=m.length-1;0<=a;a--)try{if(g=e.getContext(m[a],l.config))break}catch(b){alert(b)}if(!g)return!1;l.config.enableDebugContext&&(window.WebGLDebugUtils?g=WebGLDebugUtils.makeDebugContext(g):console.log("webgl-debug.js not included - cannot find WebGLDebugUtils"));g.enable(2929);g.enable(3089);return!0};i()?(e.addEventListener("webglcontextlost",function(d){b=l.paused;l.pause();for(a=0;a<q.length;a++)q[a].contextLost();d.preventDefault()},!1),e.addEventListener("webglcontextrestored",
function(d){i();for(a=0;a<q.length;a++)q[a].contextRestored(g);b||l.resume();d.preventDefault()},!1),l.canvasResized(),l.config.checkCanvasResizeInterval&&setInterval(function(){(e.height!==g.viewportSize[0]||e.width!==g.viewportSize[1])&&l.canvasResized()},l.config.checkCanvasResizeInterval),Object.defineProperties(n,{time:{get:function(){return s}},deltaTime:{get:function(){return y}},frame:{get:function(){return t}},scale:{get:function(){return w},set:function(a){w=a}}}),Object.freeze(n),d=new j.Scene(l),
r=new h.EventQueue(l),t=s=0,l._gameLoop(o)):l.config.webglNotFoundFn(e)})()};h.EventQueue=function(c){var f=[],g=function(c,f){return c.timeStart-f.timeStart},e=c.time;this.add=function(c,l,o){var m=e.time+1,c={task:c,timeStart:l+m,timeEnd:(o||l)+m};h.Util.insertSorted(c,f,g);return c};this.cancel=function(c){h.Util.removeElementFromArray(f,c)};this.run=function(){for(var c=0,g=e.time,h=f.length,m;c<h&&(m=f[c]).timeStart<g;c++)m.task(),m.timeEnd<g&&(f.splice(c,1),h--)};this.clear=function(){f=[]}};
h.Project=function(c){var f={},g={},e={},m=this,l=0;Object.defineProperties(this,{maxUID:{get:function(){return l},set:function(c){l=c}}});this.newProject=function(){m.loadProject({maxUID:0,resourceDescriptors:[]})};this.loadProject=function(c){var c=c||{},f=c.resourceDescriptors||[];0<l&&m.closeProject();l=c.maxUID||0;for(c=0;c<f.length;c++)m.addResourceDescriptor(f[c])};this.closeProject=function(){for(var c in f)m.removeResourceDescriptor(c)};this.load=function(h){var l=g[h];if(l)return e[h]++,
l;return(l=f[h])?(l=l.instantiate(c),g[h]=l,e[h]=1,l):null};this.loadByName=function(c,g){for(var h in f){var e=f[h];if(e.name===c&&(!g||e.type===g))return m.load(e.uid)}return null};this.release=function(c){var f=g[c];f&&(e[c]--,0>=e[c]&&(delete g[c],delete e[c],f.destroy&&f.destroy()))};this.registerObject=function(l,m){var n=c.getUID(l);g[n]||(g[n]=l,e[n]=1,f[n]||(f[n]=new h.ResourceDescriptor({uid:n,type:m,config:{name:l.name}})))};this.refreshResourceDescriptors=function(){for(var c in f)if(f[c]instanceof
h.ResourceDescriptor){var e=g[c];e&&f[c].updateConfig(e)}};this.getResourceDescriptorByType=function(c){var g=[],h;for(h in f)f[h].type===c&&g.push(f[h]);return g};this.addResourceDescriptor=function(c){c instanceof h.ResourceDescriptor||(c=new h.ResourceDescriptor(c));return f[c.uid]=c};this.removeResourceDescriptor=function(c){var h=g[c];h&&h.detroy&&h.destroy();delete g[c];delete e[c];delete f[c]};this.toJSON=function(){var g=[];m.refreshResourceDescriptors();for(var e in f)f[e]instanceof h.ResourceDescriptor&&
g.push(f[e].toJSON());return{engineVersion:c.version,maxUID:l,resourceDescriptors:g}}};h.ResourceDescriptor=function(c){var c=c||{},f=c.type,g=c.uid,e=c.config,m=h.Util.hasProperty;Object.defineProperties(this,{name:{get:function(){return e.name},set:function(c){e.name=c}},type:{value:f},config:{get:function(){return e}},uid:{value:g}});this.updateConfig=function(c){e=c.toJSON()};this.instantiate=function(c){var h=KICK.namespace(f),j=e,n={},s;for(s in j)if(m(j,s)){var t=j[s],w=t.reftype;t&&t.ref&&
w&&("resource"===w?t=c.resourceManager[t.refMethod](t.ref):"project"===w&&(t=c.project.load(t.ref)));n[s]=t}n.uid=g;c=new h(c,n);"function"===typeof c.init&&c.init();return c};this.toJSON=function(){return{type:f,uid:g,config:e}}};h.Config=function(c){this.shadows=c.shadows||!1;this.maxNumerOfLights=c.maxNumerOfLights?c.maxNumerOfLights:1;this.enableDebugContext="boolean"===typeof c.enableDebugContext?c.enableDebugContext:!1;this.preserveDrawingBuffer=c.preserveDrawingBuffer||!1;this.alpha="boolean"===
typeof c.alpha?c.alpha:!0;this.depth="boolean"===typeof c.depth?c.depth:!0;this.stencil="boolean"===typeof c.stencil?c.stencil:!1;this.antialias="boolean"===typeof c.antialias?c.antialias:!0;this.premultipliedAlpha="boolean"===typeof c.premultipliedAlpha?c.premultipliedAlpha:!0;this.checkCanvasResizeInterval=c.checkCanvasResizeInterval||0;this.webglNotFoundFn=c.webglNotFoundFn?"string"===typeof c.webglNotFoundFn?KICK.namespace(c.webglNotFoundFn):c.webglNotFoundFn:function(c){c.innerHTML="";var g=
document.createElement("div");g.style.cssText=c.style.cssText+";width:"+c.width+"px;height:"+c.height+"px;display: table-cell;vertical-align: middle;background:#ffeeee;";g.innerHTML="<div style='padding:12px;text-align: center;'><img src='http://www.khronos.org/assets/images/api_logos/webgl.png' style='width:74px;35px;margin-bottom: 10px;margin-left: auto;'><br clear='all'>It doesn't appear your computer can support WebGL.<br><br><a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a></div>";
c.parentNode.replaceChild(g,c)}};h.Time=function(){};h.MouseInput=function(c){var f=KICK.math.vec2,g=[],e=[],m=[],l=f.create(),o=f.create(),j=null,n=f.create(),s=f.create(),t=!1,w=c.canvas,q=h.Util.removeElementFromArray,v=h.Util.contains,r=!0,z=document.body,a=-1!==navigator.userAgent.indexOf("Firefox"),b=-1!==navigator.userAgent.indexOf("Chrome"),d=function(a){a.preventDefault();return!1},i=function(a){l[0]=a.clientX-n[0]+z.scrollLeft;l[1]=a.clientY-n[1]+z.scrollTop;j?f.subtract(l,o,j):j=f.create();
f.set(l,o)},k=function(a){b?(s[0]+=a.wheelDeltaX,s[1]+=a.wheelDeltaY):1===a.axis?s[0]-=a.detail:s[1]-=a.detail;if(t)return a.preventDefault(),!1},H=function(a){a=a.button;v(g,a)||(m.push(a),g.push(a));r||i()},p=function(a){a=a.button;e.push(a);q(g,a);r||i()},u=function(){for(var a=w,b=0,d=0;a.offsetParent;)b+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;b+=a.offsetLeft;d+=a.offsetTop;n[0]=b;n[1]=d};Object.defineProperties(this,{mousePosition:{get:function(){return l}},deltaMovement:{get:function(){return j||
f.create()}},deltaWheel:{get:function(){return s}},mouseWheelPreventDefaultAction:{get:function(){return t},set:function(a){t=a}},mouseMovementEventsEnabled:{get:function(){return r},set:function(a){r!==a&&((r=a)?w.addEventListener("mousemove",i,!1):(w.removeEventListener("mousemove",i,!1),j=null))}}});this.isButtonDown=function(a){return v(m,a)};this.isButtonUp=function(a){return v(e,a)};this.isButton=function(a){return v(g,a)};this.frameUpdated=function(){m.length=0;e.length=0;s[0]=0;s[1]=0;j&&
(j[0]=0,j[1]=0)};this.updateCanvasElementPosition=u;(function(){u();var g=c.canvas;g.addEventListener("mousedown",H,!0);g.addEventListener("mouseup",p,!0);g.addEventListener("mousemove",i,!0);g.addEventListener("contextmenu",d,!0);a?g.addEventListener("MozMousePixelScroll",k,!0):b?g.addEventListener("mousewheel",k,!0):g.addEventListener("DOMMouseScroll",k,!0)})()};h.KeyInput=function(){var c=[],f=[],g=[],e=h.Util.removeElementFromArray,m=h.Util.contains;this.isKeyDown=function(g){return m(c,g)};this.isKeyUp=
function(c){return m(f,c)};this.isKey=function(c){return m(g,c)};this.frameUpdated=function(){c.length=0;f.length=0};document.addEventListener("keydown",function(f){f=f.keyCode;m(g,f)||(c.push(f),g.push(f))},!1);document.addEventListener("keyup",function(c){c=c.keyCode;f.push(c);e(g,c)},!1)};h.Util={hasProperty:function(c,f){return Object.prototype.hasOwnProperty.call(c,f)},getJSONReference:function(c,f){if(null==f)return null;var g=f instanceof KICK.scene.GameObject;return!g&&f.gameObject instanceof
KICK.scene.GameObject||g?{ref:c.getUID(f),name:"string"===typeof f.name?f.name:"",reftype:g?"gameobject":"component"}:{ref:f.uid,name:f.name,reftype:"project"}},componentToJSON:function(c,f,g){var e,m={},g={type:g||f.constructor.name,uid:c.getUID(f),config:m};""===g.type&&h.Util.fail("Cannot serialize object type. Either provide toJSON function or use explicit function name 'function SomeObject(){}' ");for(e in f)if(h.Util.hasProperty(f,e)&&"gameObject"!==e){var l=f[e],o=typeof l;"function"!==o&&
(m[e]=l&&l.buffer instanceof ArrayBuffer?h.Util.typedArrayToArray(l):"object"===o?h.Util.getJSONReference(c,l):l)}return g},applyConfig:function(c,f,g){var e=h.Util.contains,m=h.Util.hasProperty,f=f||{},g=g||[],l;for(l in f)"function"!==typeof f[l]&&!e(g,l)&&m(c,l)&&(c[l]=f[l]);if(f.uid&&f.uid!==c.uid)c.uid=f.uid},getParameter:function(c,f){var g=RegExp("[\\?&]"+f+"=([^&#]*)").exec(c);return null==g?null:g[1]},getParameterInt:function(c,f,g){c=h.Util.getParameter(c,f);return null===c?g:parseInt(c)},
getParameterFloat:function(c,f,g){c=h.Util.getParameter(c,f);return null===c?g:parseFloat(c)},scaleImage:function(c,f,g){var e=document.createElement("canvas");e.width=f;e.height=g;e.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,e.width,e.height);return e},warn:function(c){debugger;console.log(c)},fail:function(c){debugger;console.error(c)},typedArrayToArray:function(c){for(var f=c.length,g=Array(f),e=0;e<f;e++)g[e]=c[e];return g},removeElementFromArray:function(c,f,g){for(var e=!1,h=c.length-
1;0<=h&&!(c[h]===f&&(e=!0,c.splice(h,1),!g));h--);return e},removeElementsFromArray:function(c,f){var g,e;for(g=c.length-1;0<=g;g--)for(e=f.length-1;0<=e;e--)c[g]===f[e]&&c.splice(g,1)},insertSorted:function(c,f,g){var e;if(!g)g=this.numberSortFunction;for(e=f.length-1;0<=e;e--)if(0>g(f[e],c)){f.splice(e+1,0,c);return}f.unshift(c)},numberSortFunction:function(c,f){return c-f},contains:function(c,f){for(var g=c.length-1;0<=g;g--)if(c[g]===f)return!0;return!1},uint32ToVec4:function(c,f){f||(f=new Float32Array(4));
u[0]=c;for(var g=0;4>g;g++)f[g]=m[g]/255;return f},vec4ToUint32:function(c){for(var f=0;4>f;f++)m[f]=255*c[f];return u[0]},vec4uint8ToUint32:function(c){for(var f=0;4>f;f++)m[f]=c[f];return u[0]}};Object.freeze(h.Util);if("undefined"===typeof window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){return window.setTimeout(c,
16.7)}}(),window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;if("undefined"===typeof window.console)window.console={};if("undefined"===typeof window.console.log)window.console.log=function(c){alert(c)}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.texture"),j=KICK.namespace("KICK.core"),e=KICK.math.vec2,u=function(c){--c;for(var f=1;32>f;f<<=1)c|=c>>f;return c+1},m=KICK.core.Util.applyConfig;h.RenderTexture=function(c,f){var g=c.gl,e=f||{},h=g.createFramebuffer(),m=e.colorTexture,o=f.dimension,j=[],n=this,s=function(){for(var c=0;c<j.length;c++)g.deleteRenderbuffer(j[c])},t=function(){var c;o=m?m.dimension:o;s();g.bindFramebuffer(36160,h);m?g.framebufferTexture2D(36160,36064,3553,m.textureId,0):(c=g.createRenderbuffer(),
g.bindRenderbuffer(36161,c),g.renderbufferStorage(36161,32854,o[0],o[1]),g.framebufferRenderbuffer(36160,36064,36161,c),j.push(c));c=g.createRenderbuffer();g.bindRenderbuffer(36161,c);g.renderbufferStorage(36161,33189,o[0],o[1]);g.framebufferRenderbuffer(36160,36096,36161,c);j.push(c);g.bindFramebuffer(36160,null)};this.bind=function(){g.renderTarget=n;g.bindFramebuffer(36160,h)};Object.defineProperties(this,{dimension:{get:function(){return o}},colorTexture:{get:function(){return m},set:function(c){m=
c;t()}}});this.destroy=function(){null!==h&&(s(),g.deleteFramebuffer(h),h=null,c.project.removeResourceDescriptor(n.uid))};this.toJSON=function(){return{uid:n.uid,colorTexture:KICK.core.Util.getJSONReference(c,m)}};t();c.project.registerObject(n,"KICK.texture.RenderTexture")};h.Texture=function(c,f){var g=c.gl,h=g.createTexture(),A="Texture",l=10497,o=10497,y=9729,n=9729,s=!0,t=null,w=!0,q=6408,v=3553,r=null,z=this,a=e.create(),b=function(){null!==r&&r!==v&&(g.deleteTexture(h),h=g.createTexture());
r=v};this.init=function(){t&&c.resourceManager.getImageData(t,z)};this.bind=function(a){g.activeTexture(33984+a);g.bindTexture(v,h)};this.destroy=function(){null!==h&&(g.deleteTexture(h),h=null,c.project.removeResourceDescriptor(z.uid))};this.setImage=function(d,c){var f,h;t=c;b();z.bind(0);if(3553===v){if(0!=(d.width&d.width-1)||0!=(d.height&d.height-1))f=u(d.width),h=u(d.height),d=j.Util.scaleImage(d,f,h);w?g.pixelStorei(37440,!0):g.pixelStorei(37440,!1);g.pixelStorei(3317,1);g.texImage2D(3553,
0,q,q,5121,d);g.texParameteri(3553,10242,l);g.texParameteri(3553,10243,o);e.set([d.width,d.height],a)}else{var m=[34069,34070,34071,34072,34073,34074],r=d.width/6,A=d.height;f=h=u(d.height);var B=document.createElement("canvas");B.width=f;B.height=h;for(var x=B.getContext("2d"),E=0;6>E;E++)x.drawImage(d,E*r,0,r,A,0,0,f,h),g.pixelStorei(37440,!1),g.pixelStorei(3317,1),g.texImage2D(m[E],0,q,q,5121,B);e.set([f,h],a)}g.texParameteri(v,10240,n);g.texParameteri(v,10241,y);s&&g.generateMipmap(v)};this.isFPTexturesSupported=
function(){var a=g.isTexFloatEnabled;if("boolean"!==typeof a)a=g.getExtension("OES_texture_float"),g.isTexFloatEnabled=a;return a};this.setImageData=function(d,c,f,h,m,j){b();5126===h&&!g.isTexFloatEnabled&&!z.isFPTexturesSupported()&&(KICK.core.Util.fail("OES_texture_float unsupported on the platform. Using 5121 instead of 5126."),h=5121);if(3553!==v)KICK.core.Util.fail("Texture.setImageData only supported by TEXTURE_2D");else{var r=q;e.set([d,c],a);t=j;z.bind(0);g.pixelStorei(3317,1);g.texImage2D(3553,
0,q,d,c,f,r,h,m);g.texParameteri(3553,10240,n);g.texParameteri(3553,10241,y);g.texParameteri(3553,10242,l);g.texParameteri(3553,10243,o);s&&g.generateMipmap(3553)}};this.setTemporaryTexture=function(){var a=new Uint8Array([255,255,255,0,0,0,0,0,0,255,255,255]),b=q;q=6407;this.setImageData(2,2,0,5121,a,"tempTexture");q=b};Object.defineProperties(this,{textureId:{value:h},name:{get:function(){return A},set:function(a){A=a}},dimension:{get:function(){return a}},dataURI:{get:function(){return t},set:function(a){t=
a}},wrapS:{get:function(){return l},set:function(a){l=a}},wrapT:{get:function(){return o},set:function(a){o=a}},minFilter:{get:function(){return y},set:function(a){y=a}},magFilter:{get:function(){return n},set:function(a){n=a}},generateMipmaps:{get:function(){return s},set:function(a){s=a}},flipY:{get:function(){return w},set:function(a){w=a}},internalFormat:{get:function(){return q},set:function(a){6406!==a&&6407!==a&&6408!==a&&6409!==a&&6410!==a&&KICK.core.Util.fail("Texture.internalFormat should be either 6406, 6407, 6408, 6409, or LUMINANCE_ALPHA");
q=a}},textureType:{get:function(){return v},set:function(a){3553!==a&&34067!==a&&KICK.core.Util.fail("Texture.textureType should be either 3553 or 34067");v=a}}});this.toJSON=function(){return{uid:z.uid,wrapS:l,wrapT:o,minFilter:y,magFilter:n,name:A,generateMipmaps:s,flipY:w,internalFormat:q,textureType:v,dataURI:t}};m(z,f);if(!g.currentTexture)g.currentTexture={};c.project.registerObject(z,"KICK.texture.Texture")};h.MovieTexture=function(c,f){var g=c.gl,e="MovieTexture",h=null,l=g.createTexture(),
o=33071,j=33071,n=9728,s=9728,t=6408,w=0,q=!1,v=c.time,r=this,z=-1;this.bind=function(a){g.activeTexture(33984+a);g.bindTexture(3553,l);z<v.frame&&h&&(z=v.frame+w,g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,h),q&&g.generateMipmap(3553))};this.destroy=function(){null!==l&&(g.deleteTexture(l),l=null,c.project.removeResourceDescriptor(r.uid))};this.setTemporaryTexture=function(){var a=new Uint8Array([255,255,255,0,0,0,0,0,0,255,255,255]);r.bind(0);
g.pixelStorei(3317,1);g.texImage2D(3553,0,t,2,2,0,6407,5121,a);g.texParameteri(3553,10240,s);g.texParameteri(3553,10241,n);g.texParameteri(3553,10242,o);g.texParameteri(3553,10243,j)};Object.defineProperties(this,{name:{get:function(){return e},set:function(a){e=a}},skipFrames:{get:function(){return w},set:function(a){w=a}},videoElement:{get:function(){return h},set:function(a){h=a}},generateMipmaps:{get:function(){return q},set:function(a){q=a}},textureId:{value:l},wrapS:{get:function(){return o},
set:function(a){o=a}},wrapT:{get:function(){return j},set:function(a){j=a}},minFilter:{get:function(){return n},set:function(a){n=a}},magFilter:{get:function(){return s},set:function(a){s=a}},internalFormat:{get:function(){return t},set:function(a){6406!==a&&6407!==a&&6408!==a&&6409!==a&&6410!==a&&KICK.core.Util.fail("Texture.internalFormat should be either 6406, 6407, 6408, 6409, or LUMINANCE_ALPHA");t=a}}});this.toJSON=function(){return{uid:r.uid,wrapS:o,wrapT:j,minFilter:n,name:e,magFilter:s,internalFormat:t}};
m(r,f);if(!g.currentTexture)g.currentTexture={};c.project.registerObject(r,"KICK.texture.MovieTexture")}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.scene"),j=KICK.namespace("KICK.core");KICK.namespace("KICK.math");var e=KICK.namespace("KICK.math.vec3"),u=KICK.namespace("KICK.math.quat4"),m=KICK.namespace("KICK.math.vec4"),c=KICK.namespace("KICK.math.mat4"),f=KICK.core.Util.applyConfig,g=KICK.core.Util.insertSorted,x=KICK.core.Util.vec4uint8ToUint32;h.GameObject=function(c,g){var e=new KICK.scene.Transform(this),h=[e],m=1,s,t=c.engine.createUID();Object.defineProperties(this,{scene:{value:c},engine:{value:c.engine},
transform:{value:e},layer:{get:function(){return m},set:function(c){"number"!==typeof c&&KICK.core.Util.fail("GameObject.layer must be a Number");m=c}},name:{get:function(){return s},set:function(c){s=c}},uid:{get:function(){return t},set:function(c){t=c}},numberOfComponents:{get:function(){return h.length}}});this.getComponent=function(c){return h[c]};this.addComponent=function(c){if(!(c instanceof KICK.scene.Transform)){if(c.gameObject)throw{name:"Error",message:"Component "+c+" already added to gameObject "+
c.gameObject};if(!c.scriptPriority)c.scriptPriority=0;c.gameObject=this;h.push(c);this.scene.addComponent(c)}};this.removeComponent=function(c){try{delete c.gameObject}catch(g){}j.Util.removeElementFromArray(h,c);this.scene.removeComponent(c)};this.destroy=function(){var c;for(c=h.length-1;0<=c;c--)this.removeComponent(h[c]);this.scene.destroyObject(this)};this.getComponentOfType=function(c){var g,f;for(f=h.length-1;0<=f;f--)if(g=h[f],g instanceof c)return g;return null};this.getComponentsOfType=
function(c){var g,f,e=[];for(f=h.length-1;0<=f;f--)g=h[f],g instanceof c&&e.push(g);return e};this.toJSON=function(){for(var c=[],g,f=0;f<h.length;f++)g=h[f],g.toJSON?c.push(g.toJSON()):c.push(KICK.core.Util.componentToJSON(engine,g));return{name:s,layer:m,uid:t,components:c}};f(this,g,["uid"])};h.Transform=function(g){var f=c.identity(c.create()),h=c.identity(c.create()),m=c.identity(c.create()),n=c.identity(c.create()),s=e.create([0,0,0]),t=e.create([0,0,0]),w=u.create([0,0,0,1]),q=u.create([0,
0,0,1]),v=e.create([1,1,1]),r=new Int8Array(6),z=[],a=null,b=this,d=function(){var a;r[2]=1;r[3]=1;r[4]=1;r[5]=1;for(a=z.length-1;0<=a;a--)z[a]._markGlobalDirty()},i=function(){r[0]=1;r[1]=1;d()};Object.defineProperties(this,{gameObject:{value:g},position:{get:function(){if(null==a)return e.create(t);r[4]&&(c.multiplyVec3(this.getGlobalMatrix(),[0,0,0],s),r[4]=0);return e.create(s)},set:function(b){var d;null==a?this.localPosition=b:(d=this.position,e.set(b,t),this.localPosition=[t[0]+d[0]-b[0],t[1]+
d[1]-b[1],t[2]+d[2]-b[2]])}},localPosition:{get:function(){return e.create(t)},set:function(a){e.set(a,t);i()}},localRotationEuler:{get:function(){var a=e.create();u.toEuler(q,a);return a},set:function(a){u.setEuler(a,q);i()}},rotationEuler:{get:function(){var a=e.create();u.toEuler(this.rotation,a);return a},set:function(a){var b=u.create();u.setEuler(a,b);this.rotation=b}},rotation:{get:function(){var b=null;if(null==a)return u.create(q);if(r[5]){u.set(q,w);for(b=this.parent;null!=b;)u.multiply(b.localRotation,
w,w),b=b.parent;r[5]=!1}return w},set:function(b){if(null==a)this.localRotation=b;else{var d=u.create();u.difference(b,this.rotation,d);this.localRotation=u.multiply(q,d)}}},localRotation:{get:function(){return q},set:function(a){u.set(a,q);i()}},localScale:{get:function(){return e.create(v)},set:function(a){e.set(a,v);i()}},children:{value:z},parent:{get:function(){return a},set:function(b){b===this&&KICK.core.Util.fail("Cannot assign parent to self");b!==a&&(null===b?(a=null,j.Util.removeElementFromArray(b.children,
this)):(a=b,b.children.push(this)),d())}}});this.getLocalMatrix=function(){r[0]&&(c.setTRS(t,q,v,f),r[0]=0);return f};this.getLocalTRSInverse=function(){r[1]&&(c.setTRSInverse(t,q,v,m),r[1]=0);return m};this.getGlobalMatrix=function(){if(r[2]){c.set(b.getLocalMatrix(),h);for(var a=b.parent;null!==a;)c.multiply(a.getLocalMatrix(),h,h),a=a.parent;r[2]=0}return h};this.getGlobalTRSInverse=function(){if(r[3]){c.set(b.getLocalTRSInverse(),n);for(var a=b.parent;null!==a;)c.multiply(n,a.getLocalTRSInverse(),
n),a=a.parent;r[3]=0}return n};this._markGlobalDirty=d;this.toJSON=function(){var d=KICK.core.Util.typedArrayToArray;return{type:"KICK.scene.Transform",uid:g.engine.getUID(b),config:{localPosition:d(t),localRotationQuat:d(q),localScale:d(v),parent:a?KICK.core.Util.getJSONReference(a):null}}};this.str=function(){return JSON.stringify(b.toJSON())}};h.Scene=function(c,g){var f={},e=[],m=[],s=[],t=[],w=[],q=[],v=[],r=[],z=[],a=[],b=[],d=[],i=new KICK.scene.SceneLights,k=g?g.name:"Scene",x=this,p=function(a,
b){return a.scriptPriority-b.scriptPriority},u=function(a,b){return b.cameraIndex-a.cameraIndex},F=function(a){a=new h.GameObject(x,a);s.push(a);e.push(a);return f[a.uid]=a};this.destroy=function(){c.project.removeResourceDescriptor(x.uid);if(x===c.activeScene)c.activeScene=null};this.addComponentListener=function(b){h.ComponentChangedListener.isComponentListener(b)||KICK.core.Util.fail("Component listener does not have the correct interface. It should contain the two functions: componentsAdded(components) and componentsRemoved(components)");
z.push(b);b.componentsAdded(a)};this.findComponentsOfType=function(a){for(var b=[],d=e.length-1;0<=d;d--)for(var c=e[d].getComponentsOfType(a),i=0;i<c.length;i++)b.push(c[i]);return b};this.removeComponentListener=function(a){j.Util.removeElementFromArray(z,a)};this.addComponent=function(a){j.Util.insertSorted(a,v,p);var b=c.getUID(a);f[b]=a};this.getObjectByUID=function(a){return f[a]};this.removeComponent=function(a){j.Util.removeElementFromArray(v,a);r.push(a);delete f[a.uid]};Object.defineProperties(this,
{engine:{value:c},name:{get:function(){return k},set:function(a){k=a}}});this.createGameObject=function(a){var a=F(a),b=a.transform;f[b.uid]=b;return a};this.destroyObject=function(a){t.push(a);delete f[a.uid]};this.getNumberOfGameObjects=function(){return e.length};this.getGameObject=function(a){return e[a]};this.updateAndRender=function(){var g,f;if(0<s.length)m=m.concat(s),s.length=0;if(0<v.length){var k=v;v=[];for(g=k.length-1;0<=g;g--)if(f=k[g],a.push(f),"function"===typeof f.activated&&f.activated(),
"function"===typeof f.update&&j.Util.insertSorted(f,w,p),"function"===typeof f.lateUpdate&&j.Util.insertSorted(f,q,p),"function"===typeof f.render&&d.push(f),"function"===typeof f.render&&j.Util.removeElementFromArray(d,f),f instanceof h.Camera)KICK.core.Util.insertSorted(f,b,u);else if(f instanceof h.Light)1==f.type?i.ambientLight=f:2===f.type?i.directionalLight=f:i.otherLights.push(f);for(g=z.length-1;0<=g;g--)z[g].componentsAdded(k)}for(g=w.length-1;0<=g;g--)w[g].update();for(g=q.length-1;0<=g;g--)q[g].lateUpdate();
if(0<t.length)j.Util.removeElementsFromArray(m,t),j.Util.removeElementsFromArray(e,t),t.length=0;if(0<r.length){k=r;r=[];for(g=k.length-1;0<=g;g--)if(f=k[g],j.Util.removeElementFromArray(a,f),"function"===typeof f.deactivated&&f.deactivated(),"function"===typeof f.update&&j.Util.removeElementFromArray(w,f),"function"===typeof f.lateUpdate&&j.Util.removeElementFromArray(q,f),f instanceof h.Camera)j.Util.removeElementFromArray(b,f);else if(f instanceof h.Light)1==f.type?i.ambientLight=null:2===f.type?
i.directionalLight=null:j.Util.removeElementFromArray(i.otherLights,f);for(g=z.length-1;0<=g;g--)z[g].componentsRemoved(k)}for(g=b.length-1;0<=g;g--)b[g].renderScene(i);c.gl.flush()};this.toJSON=function(){for(var a=[],b=0;b<e.length;b++)a.push(e[b].toJSON());return{uid:x.uid,gameObjects:a,name:k}};(function(){var a,b=KICK.core.Util.hasProperty,d=KICK.core.Util.applyConfig;if(g){var i=g.gameObjects,e={},h={};(function(){for(var b=0;b<i.length;b++)a=g.gameObjects[b],a.newObject=F(a),e[a.uid]=a.newObject})();
(function(){for(var i,k,m,n=g.gameObjects,j=0;j<n.length;j++){m=g.gameObjects[j];a=m.newObject;for(var p=0;m.components&&p<m.components.length;p++)i=m.components[p],"KICK.scene.Transform"===i.type?(k=a.transform,k.uid=i.uid,f[k.uid]=k):(k=KICK.namespace(i.type),k=new k(a,{uid:i.uid}),k.uid=i.uid,a.addComponent(k)),e[i.uid]=k,h[i.uid]=i.config}for(var s in e)if(b(e,s)&&(i=h[s])){m={};n=void 0;for(n in i)if(b(i,n)){if((j=i[n])&&j&&j.ref&&j.reftype)if("project"===j.reftype)j=c.project.load(j.ref);else if("gameobject"===
j.reftype||"component"===j.reftype)j=x.getObjectByUID(j.ref);m[n]=j}d(e[s],m)}})()}c.project.registerObject(x,"KICK.scene.Scene")})()};h.Camera=function(h){var l,o=this,y,n,s=null,t=60,w=0.1,q=1E3,v=-1,r=1,z=-1,a=1,b=[0,0,0,1],d=!0,i=!0,k=!0,u,p=1,I=4294967295,F=new KICK.renderer.ForwardRenderer,B,N,E=null,C=null,G=null,T=m.create(),O=c.create(),P=c.create(),X=c.create(),$=c.create(),L={viewMatrix:P,projectionMatrix:O,viewProjectionMatrix:X,lightViewProjectionMatrix:$},Q=[],U=[],Z=[],aa=[Q,U,Z],J=
m.create([0,0,1,1]),R=function(){u=(i?16384:0)|(k?256:0)},S=function(a){if(l.currentClearColor!==a)l.currentClearColor=a,l.clearColor(a[0],a[1],a[2],a[3])},V=function(){var i=s?s.dimension:l.viewportSize,f=i[0],g=f*J[0],e=f*J[1],f=f*J[2],i=i[1]*J[3];l.viewport(g,e,f,i);l.scissor(g,e,f,i);if(l.renderTarget!==s)s?s.bind():l.bindFramebuffer(36160,null),l.renderTarget=s;S(b);l.clear(u);d?c.perspective(t,l.viewportSize[0]/l.viewportSize[1],w,q,O):c.ortho(v,r,z,a,w,q,O);g=y.getGlobalTRSInverse();c.set(g,
P);c.multiply(O,P,X)},K=function(a,b){return(a.renderOrder||1E3)-(b.renderOrder||1E3)},M=function(){for(var a=e.create(),b=y.position,d=U.length-1;0<=d;d--){var c=U[d];c.distanceToCamera=e.lengthSqr(e.subtract(c.gameObject.transform.position,b,a))}U.sort(function(a,b){return b.distanceToCamera-a.distanceToCamera})},D=function(a,b){L.sceneLights=a;F.render(Q,L,b);F.render(U,L,b);F.render(Z,L,b)},W=function(a){if(!o.isShadowDisabled){var b=a.directionalLight,d=b.gameObject.transform,i=b.shadowRenderTexture,
f=i.dimension,g=f[0],f=f[1];l.viewport(0,0,g,f);l.scissor(0,0,g,f);i.bind();S([0,0,0,0]);l.clear(16640);c.ortho(-5,5,-5,5,-10,10,O);d=d.getGlobalTRSInverse();c.set(d,P);c.multiply(O,P,X);D(a,B);c.set(X,$);b.shadowRenderTextureDebug.bind();l.clear(16640);D(a)}};this.pick=function(a,b,d,c,i){c=c||1;i=i||1;E||(E=[],C=n.resourceManager.getShader("kickjs://shader/pick/"),G=new KICK.texture.RenderTexture(n,{dimension:l.viewportSize}));E.push({gameObjectPickedFn:a,x:b,y:l.viewportSize[1]-d,width:c,height:i})};
this.activated=function(){var a=this.gameObject;n=a.engine;y=a.transform;l=n.gl;N=a.scene;N.addComponentListener(o);B=n.resourceManager.getShader("kickjs://shader/shadowmap/")};this.deactivated=function(){N.removeComponentListener(o)};this.componentsAdded=function(a){for(var b=a.length-1;0<=b;b--){var d=a[b];if("function"===typeof d.render&&d.gameObject.layer&I){var c=d.renderOrder||1E3;2E3>c?g(d,Q,K):3E3<=c?g(d,Z,K):U.push(d)}}};this.componentsRemoved=function(a){for(var b=a.length-1;0<=b;b--){var d=
a[b];if("function"===typeof d.render)for(var c=aa.length-1;0<=c;c--)j.Util.removeElementFromArray(aa[c],d)}};this.renderScene=function(a){a.directionalLight&&a.directionalLight.shadow&&W(a);V();a.recomputeDirectionalLight(P);0<U.length&&M();D(a);s&&s.colorTexture&&s.colorTexture.generateMipmaps&&(l.bindTexture(l.TEXTURE_2D,s.colorTexture.textureId),l.generateMipmap(l.TEXTURE_2D));if(E&&0<E.length){G.bind();S(T);l.clear(16640);D(a,C);for(var b=E.length-1;0<=b;b--)(function(){var a=E[b],d=4*a.width*
a.width,c=new Uint8Array(d);l.readPixels(a.x,a.y,a.width,a.height,6408,5121,c);for(var i=[],f={},g=0;g<d;g+=4){var e=c.subarray(g,g+4),e=x(e);if(0<e)if(f[e])f[e]++;else{var h=N.getObjectByUID(e);h&&(i.push(h),f[e]=1)}}i.length&&n.eventQueue.add(function(){for(var b=0;b<i.length;b++){var d=i[b];a.gameObjectPickedFn(d,f[d.uid])}},0)})();E.length=0}};Object.defineProperties(this,{renderer:{get:function(){return F},set:function(a){F=a}},layerMask:{get:function(){return I},set:function(a){I=a}},renderTarget:{get:function(){return s},
set:function(a){s=a}},fieldOfView:{get:function(){return t},set:function(a){t=a}},near:{get:function(){return w},set:function(a){w=a}},far:{get:function(){return q},set:function(a){q=a}},perspective:{get:function(){return d},set:function(a){d=a}},left:{get:function(){return v},set:function(a){v=a}},right:{get:function(){return r},set:function(a){r=a}},bottom:{get:function(){return z},set:function(a){z=a}},top:{get:function(){return a},set:function(b){a=b}},cameraIndex:{get:function(){return p},set:function(a){p=
a}},clearColor:{get:function(){return m.create(b)},set:function(a){b=m.create(a)}},clearFlagColor:{get:function(){return i},set:function(a){R();i=a}},clearFlagDepth:{get:function(){return k},set:function(a){R();k=a}},normalizedViewportRect:{get:function(){return J},set:function(a){m.set(a,J)}}});this.toJSON=function(){return{type:"KICK.scene.Camera",uid:7,config:{renderer:F,layerMask:I,renderTarget:s,fieldOfView:t,near:w,far:q,perspective:d,left:v,right:r,bottom:z,top:a,cameraIndex:p,clearColor:b,
clearFlagColor:i,clearFlagDepth:k,normalizedViewportRect:KICK.core.Util.typedArrayToArray(J)}}};f(this,h);R()};h.Camera.prototype.setupClearFlags=function(c,f){this.clearColor=c;this.clearDepth=f;delete this._currentClearFlags};h.ComponentChangedListener={isComponentListener:function(c){return c&&"function"===typeof c.componentsAdded&&"function"===typeof c.componentsRemoved}};h.MeshRenderer=function(c){var g,e=[],h,m;this.activated=function(){g=this.gameObject.transform};Object.defineProperties(this,
{renderOrder:{get:function(){return m}},material:{get:function(){return 0===e.length?null:e[0]},set:function(c){e[0]=c;m=e[0].renderOrder},enumerable:!0},materials:{get:function(){return e},set:function(c){e=[];for(var f=0;f<c.length;f++)e[f]=c[f],m=e[f].renderOrder},enumerable:!0},mesh:{get:function(){return h},set:function(c){h=c},enumerable:!0}});this.render=function(c,f){for(var m=e.length,n=0;n<m;n++){var j=f||e[n].shader;h.bind(j);j.bindUniform(e[n],c,g);h.render(n)}};this.toJSON=function(){return KICK.core.Util.componentToJSON(engine,
this,"KICK.scene.MeshRenderer")};f(this,c)};h.Light=function(c){var g=this,h=e.create([1,1,1]),m,n=3,j,t=1,w=0.05,q=null,v=null,r=null,z=null,a=1,b=e.create(),d=function(){e.set([h[0]*a,h[1]*a,h[2]*a],b)},i,k,x=function(){j?(q=new KICK.texture.Texture(m,{minFilter:9728,magFilter:9728,wrapS:33071,wrapT:33071,flipY:!1,generateMipmaps:!1}),q.setImageData(512,512,0,5121,null,""),v=new KICK.texture.RenderTexture(m,{colorTexture:q}),r=new KICK.texture.Texture(m,{minFilter:9728,magFilter:9728,wrapS:33071,
wrapT:33071,flipY:!1,generateMipmaps:!1}),r.setImageData(512,512,0,5121,null,""),z=new KICK.texture.RenderTexture(m,{colorTexture:r})):v&&(v.destroy(),q.destroy())};Object.defineProperties(this,{shadowRenderTextureDebug:{get:function(){return z}},shadowTextureDebug:{get:function(){return r}},shadowRenderTexture:{get:function(){return v}},shadowTexture:{get:function(){return q}},shadow:{get:function(){return j},set:function(a){a!==j&&(j=a,m&&x())}},shadowStrength:{get:function(){return t},set:function(a){t=
a}},shadowBias:{get:function(){return w},set:function(a){w=a}},color:{get:function(){return e.create(h)},set:function(a){e.set(a,h);d()}},type:{get:function(){return n},set:function(a){m||(n=a)}},intensity:{get:function(){return a},set:function(b){a=b;d()}},colorIntensity:{get:function(){return b},set:function(a){b=a}},gameObject:{get:function(){return i},set:function(a){i=a}},scriptPriority:{get:function(){return k},set:function(a){k=a}}});this.activated=function(){m=g.gameObject.engine;x()};f(this,
c)};Object.freeze(h.Light);h.SceneLights=function(){var f=null,g=null,h=e.create(),j=e.create(),n=null;Object.defineProperties(this,{ambientLight:{get:function(){return f},set:function(c){f=c}},directionalLight:{get:function(){return g},set:function(c){g=c;n=null!==c?g.gameObject.transform:null}},directionalHalfVector:{value:h},directionalLightDirection:{value:j},otherLights:{value:[]}});this.recomputeDirectionalLight=function(f){null!==g&&(m.set([0,0,-1],j),u.multiplyVec3(n.rotation,j),c.multiplyVec3Vector(f,
j),e.normalize(j),e.add([0,0,1],j,h),e.normalize(h))}}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.mesh");KICK.namespace("KICK.scene");KICK.namespace("KICK.core");KICK.namespace("KICK.math");var j=KICK.namespace("KICK.math.vec3");KICK.namespace("KICK.math.quat4");var e=KICK.namespace("KICK.math.vec4"),u=KICK.namespace("KICK.math.mat4");h.MeshData=function(e){var c={},f=this,g=[],x,A,l,o,y,n=function(){l=A=x=null},s=function(){return c.vertex},t=function(){var f=x.byteLength/l,g,a,b,d,i=0,e;c={};for(g=0;g<f;g++){for(b in A){d=A[b];a=5126===d.type?Float32Array:
Int32Array;0===g&&(c[b]=new a(f*d.size));e=new a(x,i+d.pointer);for(a=0;a<d.size;a++)c[b][g*d.size+a]=e[a]}i+=l}},w=function(f,g){if(5126===f||5124===f){var a=5126===f?Float32Array:Int32Array;return{get:function(){!s()&&x&&t();return c[g]},set:function(b){b&&(b=new a(b));c[g]=b;n()}}}},q=function(){var c=[],g=[],a=[],b=0,d=[],i,e,h=f.vertex,h=h?h.length/3:0,m={};i=function(i,e,h){var k=f[i];k&&(c.push(e),g.push(i),a.push(h),d.push(k),m[i]={pointer:4*b,size:e,normalized:!1,type:h},b+=e)};i("vertex",
3,5126);i("normal",3,5126);i("uv1",2,5126);i("uv2",2,5126);i("tangent",4,5126);i("color",4,5126);i("int1",1,5124);i("int2",2,5124);i("int3",3,5124);i("int4",4,5124);var n=new ArrayBuffer(4*b*h);for(e=0;e<h;e++)for(var j=4*e*b,o=0;o<g.length;o++){i=5126===a[o]?new Float32Array(n,j):new Int32Array(n,j);for(var s=d[o],t=c[o],q=0;q<t;q++)i[q]=s[e*t+q],j+=4}x=n;A=m;l=4*b};Object.defineProperties(this,{aabb:{get:function(){var c=f.vertex;if(!c)return null;for(var g=c.length,a=KICK.math.aabb.create(),b=
0;b<g;b+=3){var d=c.subarray(b,b+3);KICK.math.aabb.addPoint(a,d)}return a}},name:{get:function(){return y},set:function(c){y=c}},interleavedArray:{get:function(){!x&&s()&&q();return x},set:function(c){c?x=c:n()}},interleavedArrayFormat:{get:function(){!x&&s()&&q();return A},set:function(c){c?A=c:n()}},vertexAttrLength:{get:function(){!x&&s()&&q();return l},set:function(c){c?l=c:n()}},vertex:w(5126,"vertex"),normal:w(5126,"normal"),uv1:w(5126,"uv1"),uv2:w(5126,"uv2"),tangent:w(5126,"tangent"),color:w(5126,
"color"),int1:w(5124,"int1"),int2:w(5124,"int2"),int3:w(5124,"int3"),int4:w(5124,"int4"),indices:{get:function(){return 0==g?null:g[0]},set:function(c){c&&!(c instanceof Uint16Array)&&(c=new Uint16Array(c));g[0]&&s()&&n();c&&(g[0]=c)}},subMeshes:{get:function(){return g},set:function(c){for(var f=0;f<c.length;f++)c[f]&&!(c[f]instanceof Uint16Array)&&(c[f]=new Uint16Array(c[f]));g=c}},meshType:{get:function(){return o},set:function(c){o=c}}});this.isValid=function(){!s()&&x&&t();for(var f=c.vertex.length/
3,e=0;e<g.length;e++)for(var a=g[e].length-1;0<=a;a--)if(g[e][a]>=f){debugger;return!1}return!0};this.isVertexDataInitialized=s;this.isInterleavedDataInitialized=function(){return x};this.transform=function(c){for(var f=new h.MeshData(this),a=j.wrapArray(f.vertex),b=a.length-1;0<=b;b--)u.multiplyVec3(c,a[b]);return f};this.combine=function(c,g){if(f.meshType!==c.meshType||6==f.meshType)return null;for(var a="vertex,normal,uv1,uv2,tangent,color,int1,int2,int3,int4,indices".split(","),b=a.length-1;0<=
b;b--){var d=a[b];(!f[d]||!c[d])&&a.splice(b,1)}b=function(b,d,c){var f,g,e,h,m;for(f=a.length-1;0<=f;f--)if(e=a[f],b[e]){h=d[e];if(c&&"indices"===e){h=new Uint16Array(h);m=h.length;for(g=0;g<m;g++)h[g]+=c}for(g=0;g<h.length;g++)b[e].push(h[g])}else b[e]=KICK.core.Util.typedArrayToArray(d[e])};d={meshType:f.meshType};g&&(c=c.transform(g));b(d,f,0);b(d,c,this.vertex.length/3);5===f.meshType&&d.indices.splice(f.indices,0,d.indices[f.indices.length],d.indices[f.indices.length+1]);return new h.MeshData(d)};
e||(e={});var w=function(){f.vertex=e.vertex?new Float32Array(e.vertex):null;f.normal=e.normal?new Float32Array(e.normal):null;f.uv1=e.uv1?new Float32Array(e.uv1):null;f.uv2=e.uv2?new Float32Array(e.uv2):null;f.tangent=e.tangent?new Float32Array(e.tangent):null;f.color=e.color?new Float32Array(e.color):null;f.int1=e.int1?new Int32Array(e.int1):null;f.int2=e.int2?new Int32Array(e.int2):null;f.int3=e.int3?new Int32Array(e.int3):null;f.int4=e.int4?new Int32Array(e.int4):null},v=function(){f.interleavedArray=
e.interleavedArray;f.interleavedArrayFormat=e.interleavedArrayFormat;f.vertexAttrLength=e.vertexAttrLength};e instanceof h.MeshData?e.isVertexDataInitialized()?w():v():e.vertex?w():e.interleavedArray&&v();f.name=e.name;f.indices=e.indices;f.meshType=e.meshType||4};h.MeshData.prototype.recalculateNormals=function(){var e=this.vertex.length/3,c=this.indices.length/3,f=this.indices,g=j.wrapArray(this.vertex),h,u={},l=j.array(e,u),o=j.create(),y=j.create(),n=j.create();for(h=0;h<c;h++){var s=f[3*h+0],
t=f[3*h+1],w=f[3*h+2],q=g[s],v=g[w];j.subtract(g[t],q,o);j.subtract(v,q,y);j.cross(o,y,n);j.normalize(n);j.add(l[s],n);j.add(l[t],n);j.add(l[w],n)}for(h=0;h<e;h++)j.normalize(l[h]);this.normal=u.mem};h.MeshData.prototype.recalculateTangents=function(){var h=j.wrapArray(this.vertex),c=h.length,f=j.wrapArray(this.normal),g=this.uv1,u=this.indices,A=u.length/3,l=this.tangent,o=j.array(c),y=j.array(c),n,s=j.create(),t=j.create();for(n=0;n<A;n++){var w=u[3*n+0],q=u[3*n+1],v=u[3*n+2],r=h[w],z=h[q],a=h[v],
b=g[w],d=g[q],i=g[v],k=z[0]-r[0],H=a[0]-r[0],p=z[1]-r[1],I=a[1]-r[1],z=z[2]-r[2],r=a[2]-r[2],a=d[0]-b[0],F=i[0]-b[0],d=d[1]-b[1],i=i[1]-b[1],b=1/(a*i-F*d),i=j.create([(i*k-d*H)*b,(i*p-d*I)*b,(i*z-d*r)*b]),k=j.create([(a*H-F*k)*b,(a*I-F*p)*b,(a*r-F*z)*b]);j.add(o[w],i);j.add(o[q],i);j.add(o[v],i);j.add(y[w],k);j.add(y[q],k);j.add(y[v],k)}if(!l)this.tangent=l=new Float32Array(4*c);l=e.wrapArray(l);for(n=0;n<c;n++)h=f[n],g=o[n],j.subtract(g,h,s),j.dot(h,g,t),j.set(j.normalize(j.multiply(s,t)),l[n]),
l[n][3]=0>j.dot(j.cross(h,g,j.create()),y[n])?-1:1};h.Mesh=function(e,c){var f=e.gl,g,h,j=[],l,o,y,n=null,s=this,t=0,w,q=[],v={contextLost:function(){},contextRestored:function(a){g=j=null;f=a;z()}},r=function(){for(var a=0;a<j.length;a++)f.deleteBuffer(j[a]);"number"===typeof g&&(f.deleteBuffer(g),g=null);q.length=0;j.length=0},z=function(){var a=o.subMeshes;r();h=o.interleavedArrayFormat;t=o.vertexAttrLength;w=o.meshType;g=f.createBuffer();f.bindBuffer(34962,g);f.bufferData(34962,o.interleavedArray,
35044);for(var b=0;b<a.length;b++){var d=a[b],c=f.createBuffer();q[b]=d.length;j.push(c);f.bindBuffer(34963,c);f.bufferData(34963,d,35044)}};e.addContextListener(v);Object.defineProperties(this,{aabb:{get:function(){if(!n&&o)n=o.aabb;return n}},name:{get:function(){return l},set:function(a){l=a||"Mesh"}},meshData:{get:function(){return o},set:function(a){o=a;n=null;z()}},urlResource:{get:function(){return y},set:function(a){a!==y&&e.resourceManager.getMeshData(a,s);y=a}}});KICK.core.Util.applyConfig(this,
c);e.project.registerObject(this,"KICK.mesh.Mesh");this.verify=function(a){var b=[],d,c;for(c in a.lookupAttribute)"string"===typeof c&&((d=h[c])||b.push(c));return null};this.bind=function(a){a.bind();if(f.meshBuffer!==g||f.meshShader!==a){f.meshBuffer=g;f.meshShader=a;f.bindBuffer(34962,g);for(var b in h)if("undefined"!==typeof a.lookupAttribute[b]){var d=h[b],c=a.lookupAttribute[b];f.enableVertexAttribArray(c);f.vertexAttribPointer(c,d.size,d.type,!1,t,d.pointer)}}};this.render=function(a){f.bindBuffer(34963,
j[a]);f.drawElements(w,q[a],5123,0)};this.destroy=function(){null!==g&&(r(),e.removeContextListener(v),e.project.removeResourceDescriptor(s.uid))};this.toJSON=function(){return{uid:s.uid,name:l,urlResource:y}}}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};(function(){var h=KICK.namespace("KICK.renderer");KICK.namespace("KICK.core");KICK.namespace("KICK.scene");KICK.namespace("KICK.math");h.NullRenderer=function(){};h.NullRenderer.prototype.render=function(){};h.ForwardRenderer=function(){this.render=function(h,e,u){for(var m=h.length,c=0;c<m;c++)h[c].render(e,u)}}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.material"),j=KICK.namespace("KICK.math"),e=j.mat3,u=j.mat4,j=j.vec4,m=KICK.namespace("KICK.core"),c=m.Util.applyConfig,f=KICK.core.Util.uint32ToVec4,g=u.create(),x=e.create(),A=j.create(),l=u.create([0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1]);h.Shader=function(f,g){var e=f.gl,m=this,j=-1,l=!0,q=1029,v=513,r=!1,z=770,a=771,b=!1,d=2.5,i=10,k=1E3,u=null,p="",x,A=h.GLSLConstants,B=A["error_vs.glsl"],N=A["error_fs.glsl"],E=KICK.core.Util.fail,C=function(){x=(z+
1E4*a)*(r?-1:1)},G=function(a,b){var d,a=h.Shader.getPrecompiledSource(f,a);d=b?e.createShader(35632):e.createShader(35633);e.shaderSource(d,a);e.compileShader(d);return!e.getShaderParameter(d,35713)?(d=e.getShaderInfoLog(d),"function"===typeof E&&E(d),null):d};Object.defineProperties(this,{name:{get:function(){return p},set:function(a){p=a}},dataURI:{get:function(){return u},set:function(a){u=a}},gl:{value:e},vertexShaderSrc:{get:function(){return B},set:function(a){"string"!==typeof a&&KICK.core.Util.fail("Shader.vertexShaderSrc must be a string");
B=a}},fragmentShaderSrc:{get:function(){return N},set:function(a){"string"!==typeof a&&KICK.core.Util.fail("Shader.fragmentShaderSrc must be a string");N=a}},renderOrder:{get:function(){return k},set:function(a){"number"!==typeof a&&KICK.core.Util.fail("Shader.renderOrder must be a number");k=a}},errorLog:{get:function(){return E},set:function(a){E=a}},engine:{value:f},shaderProgramId:{get:function(){return j}},polygonOffsetEnabled:{get:function(){return b},set:function(a){b=a}},polygonOffsetFactor:{get:function(){return d},
set:function(a){d=a}},polygonOffsetUnits:{get:function(){return i},set:function(a){i=a}},faceCulling:{get:function(){return q},set:function(a){q=a}},depthMask:{get:function(){return l},set:function(a){l=a}},zTest:{get:function(){return v},set:function(a){v=a}},blend:{get:function(){return r},set:function(a){r=a;C()}},blendSFactor:{get:function(){return z},set:function(a){z=a;C()}},blendDFactor:{get:function(){return a},set:function(b){a=b;C()}}});this.markUniformUpdated=function(){e.boundShader=-1;
e.meshShader=-1};this.updateShader=function(){var a=E||console.log,b=G(B,!1,a),d=G(N,!0,a),c=null===d||null===b;c&&(b=G(A["error_vs.glsl"],!1,a),d=G(A["error_fs.glsl"],!0,a));j=e.createProgram();e.attachShader(j,b);e.attachShader(j,d);e.linkProgram(j);if(!e.getProgramParameter(j,35714))return a("Could not initialise shaders"),!1;e.useProgram(j);e.boundShader=j;b=e.getProgramParameter(j,35718);this.activeUniforms=Array(b);this.lookupUniform={};for(a=0;a<b;a++)d=e.getActiveUniform(j,a),this.activeUniforms[a]=
{size:d.size,type:d.type,name:d.name,location:e.getUniformLocation(j,d.name)},this.lookupUniform[d.name]=this.activeUniforms[a];b=e.getProgramParameter(j,35721);this.activeAttributes=Array(b);this.lookupAttribute={};for(a=0;a<b;a++)d=e.getActiveAttrib(j,a),this.activeAttributes[a]={size:d.size,type:d.type,name:d.name},this.lookupAttribute[d.name]=a;m.markUniformUpdated();return!c};this.destroy=function(){-1!==j&&(e.deleteProgram(j),j=-1,f.project.removeResourceDescriptor(m.uid))};this.isValid=function(){return-1!==
j};this.bind=function(){if(e.boundShader!==j){e.boundShader=j;e.useProgram(j);var c=e.faceCulling;if(c!==q)0===q?e.disable(2884):((!c||0===c)&&e.enable(2884),e.cullFace(q)),e.faceCulling=q;if(e.zTest!==v)e.depthFunc(v),e.zTest=v;if(e.depthMaskCache!==l)e.depthMask(l),e.depthMaskCache=l;if(e.blendKey!==x)e.blendKey=x,r?e.enable(3042):e.disable(3042),e.blendFunc(z,a);if(e.polygonOffsetEnabled!==b)(e.polygonOffsetEnabled=b)?e.enable(32823):e.disable(32823);b&&e.polygonOffset(d,i)}};this.toJSON=function(){return u?
{uid:m.uid,name:p,dataURI:u}:{uid:m.uid,name:p,blend:r,blendSFactor:z,dataURI:u,depthMask:l,faceCulling:q,fragmentShaderSrc:N,vertexShaderSrc:B,polygonOffsetEnabled:b,polygonOffsetFactor:d,polygonOffsetUnits:i,renderOrder:k,zTest:v}};c(m,g);f.project.registerObject(m,"KICK.material.Shader");u?f.resourceManager.getShaderData(u,m):(C(),m.updateShader())};h.Shader.getPrecompiledSource=function(c,e){for(var f in h.GLSLConstants)if("string"===typeof f)var g=h.GLSLConstants[f],e=e.replace('#pragma include "'+
f+'"',g),e=e.replace("#pragma include '"+f+"'",g);return e="#define SHADOWS "+(!0===c.config.shadows)+"\n#line 1\n"+e};Object.freeze(h.Shader);h.Shader.prototype.bindUniform=function(c,e,h){var j=this.gl,m=c.uniforms,w,q,v,r,z,a=this.lookupUniform._mv,b=this.lookupUniform._proj,d=this.lookupUniform._mvProj,i=this.lookupUniform._norm,k=this.lookupUniform._gameObjectUID,H=this.lookupUniform._time,p=this.lookupUniform._viewport,I=this.lookupUniform._shadowMapTexture,c=this.lookupUniform._lightMat;w=
e.sceneLights;var F=w.ambientLight,B=w.directionalLight,N=w.otherLights,E,C=0;for(q in m)if(v=this.lookupUniform[q])switch(r=m[q],z=v.location,r=r.value,v.type){case 5126:j.uniform1fv(z,r);break;case 35674:j.uniformMatrix2fv(z,!1,r);break;case 35675:j.uniformMatrix3fv(z,!1,r);break;case 35676:j.uniformMatrix4fv(z,!1,r);break;case 35664:j.uniform2fv(z,r);break;case 35665:j.uniform3fv(z,r);break;case 35666:j.uniform4fv(z,r);break;case 5124:j.uniform1iv(z,r);break;case 35667:j.uniform2iv(z,r);break;
case 35668:j.uniform3iv(z,r);break;case 35669:j.uniform4iv(z,r);break;case 35680:case 35678:r.bind(C);j.uniform1i(z,C);C++;break;default:console.log("Warn cannot find type "+v.type)}b&&j.uniformMatrix4fv(b.location,!1,e.projectionMatrix);if(a||i)E=h.getGlobalMatrix(),q=u.multiply(e.viewMatrix,E,g),a&&j.uniformMatrix4fv(a.location,!1,q),i&&(q=u.toNormalMat3(q,x),j.uniformMatrix3fv(i.location,!1,q));d&&(E=E||h.getGlobalMatrix(),j.uniformMatrix4fv(d.location,!1,u.multiply(e.viewProjectionMatrix,E,g)));
if(null!==F)(d=this.lookupUniform._ambient)&&j.uniform3fv(d.location,F.colorIntensity);if(null!==B&&(d=this.lookupUniform["_dLight.colInt"]))j.uniform3fv(d.location,B.colorIntensity),d=this.lookupUniform["_dLight.lDir"],j.uniform3fv(d.location,w.directionalLightDirection),d=this.lookupUniform["_dLight.halfV"],j.uniform3fv(d.location,w.directionalHalfVector);for(w=N.length-1;0<=w;w--);if(H)w=this.engine.time,j.uniform1f(H.location,w.time);p&&j.uniform2fv(p.location,j.viewportSize);k&&(H=f(h.gameObject.uid,
A),3>this.engine.time.frame&&console.log("transform.gameObject.uid "+h.gameObject.uid),j.uniform4fv(k.location,H));I&&(B.shadowTexture.bind(C),j.uniform1i(I.location,C));c&&(E=E||h.getGlobalMatrix(),e=u.multiply(e.lightViewProjectionMatrix,E,g),j.uniformMatrix4fv(c.location,!1,u.multiply(l,e,g)))};h.Material=function(e,f){var g="Material",j=null,l={},u=this,q;Object.defineProperties(this,{name:{get:function(){return g},set:function(c){g=c}},shader:{get:function(){return j},set:function(c){j=c;u.init()}},
uniforms:{get:function(){return l},set:function(c){l=c;j&&j.markUniformUpdated()}},renderOrder:{get:function(){return q}}});this.destroy=function(){e.project.removeResourceDescriptor(u.uid)};this.init=function(){"string"===typeof j&&(j=e.project.load(j));j||(KICK.core.Util.fail("Cannot initiate shader in material "+g),j=e.project.load("kickjs://shader/error/"));q=j.renderOrder};this.toJSON=function(){var c={},f;for(f in l)if("string"===typeof f){var h=l[f],a=h.value,a=a instanceof Float32Array||a instanceof
Int32Array?m.Util.typedArrayToArray(a):KICK.core.Util.getJSONReference(e,a);c[f]={type:h.type,value:a}}return{uid:u.uid,name:g,uniforms:c}};(function(){c(u,f);e.project.registerObject(u,"KICK.material.Material");for(var g in l){var j=l[g].type,m=l[g].value;if((35678===j||35680===j)&&m&&"number"===typeof m.ref)l[g].value=e.project.load(m.ref)}h.Material.verifyUniforms(l)})()};h.Material.verifyUniforms=function(c){var e,f;for(e in c)if(Array.isArray(c[e].value)||"number"===typeof c[e].value)if(f=c[e].type,
5124===f||35667===f||35668===f||35669===f)c[e].value=new Int32Array(c[e].value);else if(!(35678===f||35680===f))c[e].value=new Float32Array(c[e].value)}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.mesh"),j=KICK.namespace("KICK.math"),e=j.vec3,u=j.vec2;h.MeshFactory={createTriangleData:function(){var e=Math.sqrt(0.75);return new h.MeshData({name:"Triangle",vertex:[0,1,0,-e,-0.5,0,e,-0.5,0],uv1:[0.5,1,0.125,0.25,0.875,0.25],normal:[0,0,1,0,0,1,0,0,1],indices:[0,1,2]})},createPlaneData:function(){return new h.MeshData({name:"Plane",vertex:[1,-1,0,1,1,0,-1,-1,0,-1,1,0],uv1:[1,0,1,1,0,0,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1],indices:[0,1,2,2,1,3]})},createUVSphereData:function(j,
c,f){if(!j||3>j)j=20;if(!c||2>c)c=10;f||(f=1);for(var g=2*c*(j+1)+2*(c-1),x={},A=e.array(g,x),l={},o=e.array(g,l),y={},g=u.array(g,y),n=[],s=Math.PI/c,t=Math.PI/2,w=2*Math.PI,q=0,v=0;v<c;v++)for(var r=s*v-t,z=s*(v+1)-t,a=Math.sin(r),r=Math.cos(r),b=Math.sin(z),z=Math.cos(z),d=0;d<=j;d++){var i=w/j*d,k=Math.sin(i),H=Math.cos(i),i=H*r,p=a,I=k*r,H=H*z,F=b,k=k*z;e.set([i,p,I],A[q]);u.set([1-d/j,v/c],g[q]);e.set([f*i,f*p,f*I],o[q]);n.push(q);0<v&&0==d&&n.push(q);q++;e.set([H,F,k],A[q]);u.set([1-d/j,(v+
1)/c],g[q]);e.set([f*H,f*F,f*k],o[q]);n.push(q);d==j&&v<c-1&&n.push(q);q++}return new h.MeshData({name:"UVSphere",vertex:l.mem,uv1:y.mem,normal:x.mem,indices:n,meshType:5})},createCubeData:function(e){e||(e=1);return new h.MeshData({name:"Cube",vertex:[e,e,e,-e,e,e,-e,-e,e,e,-e,e,e,e,e,e,-e,e,e,-e,-e,e,e,-e,e,e,e,e,e,-e,-e,e,-e,-e,e,e,-e,e,e,-e,e,-e,-e,-e,-e,-e,-e,e,-e,-e,-e,e,-e,-e,e,-e,e,-e,-e,e,e,-e,-e,-e,-e,-e,-e,e,-e,e,e,-e],uv1:[1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,
0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],color:[1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,0,1,0,1,0,1,1,1],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.importer"),j=KICK.namespace("KICK.math"),e=j.quat4,u=j.mat4,m=function(c,e){return c.querySelector("[id="+e+"]")};h.ColladaImporter={};h.ColladaImporter.import=function(c,f,g){"string"===typeof c&&(c=(new DOMParser).parseFromString(c,"text/xml"));var h={},j=function(c,a){a||(a=Array);var c=c.replace(/^\s+|\s+$/g,""),c=c.replace(/\s{2,}/g," "),b=c.split(" ").map(Number);return!a||a===Array?b:new a(b)},l=function(e){"#"===e.charAt(0)&&(e=e.substring(1));if(h[e])return h[e];
var a=m(c,e),a=j(a.textContent,"float_array"===a.tagName?Float32Array:Int32Array);return h[e]=a},o=function(e){e.getAttribute("semantic");e=m(c,e.getAttribute("source").substring(1));"vertices"===e.tagName&&(e=e.getElementsByTagName("input")[0],e=m(c,e.getAttribute("source").substring(1)));e=e.getElementsByTagName("technique_common")[0].getElementsByTagName("accessor")[0];e.getAttribute("count");var a=Number(e.getAttribute("stride")),b=Number(e.getAttribute("offset"));b||(b=0);var e=e.getAttribute("source"),
d=l(e);return function(c,e){return d[b+a*c+e]}},y=function(c,a,b){for(var d=c.firstChild,e,f,g=function(){return 3},c=Number(c.getAttribute("count")),h=[],l={},n={},m={},q=[],r=KICK.core.Util.contains,s=b.numberOfVertices||0;null!==d;){e=d.tagName;if("input"===e){e=d.getAttribute("semantic");var u=Number(d.getAttribute("offset"));n[e]=new o(d);h.push(e);l[e]=u;m[e]="TEXCOORD"===e?2:3;r(q,u)||q.push(u)}else if("vcount"===e)var t=j(d.textContent,Int32Array),g=function(a){return t[a]};else if("p"===
e){var w=q.length,v=j(d.textContent,Int32Array),u={};for(e=0;e<h.length;e++)u[h[e]]=[];var x=function(a,d,c){var e="",f,g,i,j,k=a*w;for(i=0;i<h.length;i++)g=h[i],f=l[g],f=v[f+k],e+=a+"#"+f+"#";g=b[e];if("number"===typeof g)L.push(g);else{for(i=0;i<h.length;i++){g=h[i];var a=n[g],o=m[g];f=l[g];f=v[f+k];for(j=0;j<o;j++){var q=a(f,j);d[g].push(q)}}d=s;s+=1;c.push(d);b[e]=d}},y=0,L=[];for(e=0;e<c;e++){var Q=g(e);for(f=0;3>f;f++)x(y+f,u,L);for(f=3;f<Q;f++)x(y+0,u,L),x(y+f-1,u,L),x(y+f,u,L);y+=Q}for(e=
0;e<h.length;e++)y=h[e],f=y.toLowerCase(),"texcoord"===f&&(f="uv1"),a[f]&&a[f].length?(Q=KICK.core.Util.typedArrayToArray,x=Q(a[f]),y=Q(u[y]),x.push.apply(x,y),a[f]=x):a[f]=u[y];a.meshType=4;e=a.subMeshes;e.push(L);a.subMeshes=e;console.log("pushing new sub mesh with "+L.length+" as # "+a.subMeshes.length)}d=d.nextSibling}b.numberOfVertices=s},n=function(c,a){var b=g.createGameObject(),d=b.transform;if(a)d.parent=a;b.name=c.getAttribute("id");q.push(b);for(var h=c.firstElementChild;h;){var k=h.tagName;
if("translate"===k||"rotate"===k||"scale"===k||"matrix"===k){var k=d,l=h,m=l.tagName;l.getAttribute("sid");if("translate"===m)k.localPosition=j(l.textContent);else if("rotate"===m){if(l=j(l.textContent),m=l[3])l=e.angleAxis(m,l),k.localRotation=e.multiply(k.localRotation,l,l)}else if("scale"===m)k.localScale=j(l.textContent);else if("matrix"===m)l=j(l.textContent),l=u.decompose(l),k.localPosition=l[0],k.localRotation=l[1],k.localScale=l[2]}else if("instance_geometry"===k){k=b;l=h.getAttribute("url");
m=void 0;l&&(l=l.substring(1));var o;m=f;o=l;var s=[],r=void 0,t=void 0;if(v[o])o=v[o];else{o&&"#"===o.charAt(0)&&(o=o.substring(1));for(r=0;r<w.length;r++)if(t=w[r],t.getAttribute("id")===o){var x=t,C=void 0,G=void 0,r=x.getAttribute("name"),t=void 0,C=x.getElementsByTagName("mesh");if(0==C.length)r=null;else{x={};C=C[0];for(G=C.firstChild;null!==G;)C=G.tagName,"lines"===C?console.log("lines - unsupported"):"linestrips - unsupported"===C?console.log("linestrips"):"polygons"===C?console.log("polygons  - unsupported"):
"polylist"===C||"triangles"===C?(t||(t=new KICK.mesh.MeshData({name:r})),y(G,t,x)):"trifans"===C?console.log("trifans unsupported"):"tristrips"===C&&console.log("tristrips - unsupported"),G=G.nextSibling;r=t}r&&s.push(new KICK.mesh.Mesh(m,{meshData:r}));break}o=v[o]=s}for(s=0;s<o.length;s++)m=new KICK.scene.MeshRenderer,m.mesh=o[s],console.log("Mesh",m.mesh),m.material=new KICK.material.Material(f,{name:"Some material",shader:f.resourceManager.getShader("kickjs://shader/default/")}),console.log("Getting mesh by id "+
l),console.log("meshRenderer.material name "+m.material.name),console.log("meshRenderer.material shader "+m.material.shader),k.addComponent(m)}else"node"===k?n(h,d):console.log("Unknown tagName '"+k+"'");h=h.nextElementSibling}},s=c.firstChild.getElementsByTagName("library_geometries"),t=c.firstChild.getElementsByTagName("visual_scene"),w;if(!g)g=f.activeScene;s=s[0];w=s.getElementsByTagName("geometry");for(var q=[],v={},s=0;s<t.length;s++)for(var r=t[s].firstElementChild;r;)n(r,null),r=r.nextElementSibling;
return q}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.importer");KICK.namespace("KICK.math");h.ObjImporter={};h.ObjImporter.import=function(h,e,u){for(var h=h.split("\n"),m=h.length,c=[],f=[],g=[],x=[],A=[],l=[x],o=[],y="MeshObject",n=function(c,a){a||(a=Array);var c=c.replace(/^\s+|\s+$/g,""),c=c.replace(/\s{2,}/g," "),b=c.split(" ").map(Number);return!a||a===Array?b:new a(b)},s=function(c){for(var a=[],b=0;b<c.length;b++){var d=c[b].split("/"),e=parseInt(d[0]);a.push([e,2<=d.length?parseInt(d[1]):e,3<=d.length?
parseInt(d[2]):e])}return a},t=function(){var h=function(a,b,c){a=a[b-1];for(b=0;b<a.length;b++)c.push(a[b])};if(0!=c.length){for(var a=u.createGameObject(),b=new KICK.mesh.MeshData,d=new KICK.mesh.Mesh(e),i=[],j=[],m=[],n,q=[],r={},t=0,w=0;w<l.length;w++){x=l[w];n=[];q.push(n);for(var v=0;v<x.length;v++)for(var C=x[v],G=s(C),T=0;3>T;T++){var O=C[T];"number"===typeof r[O]?n.push(r[O]):(h(c,G[T][0],i),g.length&&h(g,G[T][1],m),f.length&&h(f,G[T][2],j),n.push(t),r[O]=t,t++)}}b.vertex=i;if(j.length)b.normal=
j;if(m.length)b.uv1=m;b.subMeshes=q;d.meshData=b;h=new KICK.scene.MeshRenderer;h.mesh=d;for(var P=[],d=function(a){P.push(new KICK.material.Material(e,{name:a,shader:e.resourceManager.getShader("kickjs://shader/default/")}))},v=0;v<q.length;v++)v<A.length?(b=A[v],(i=e.project.loadByName(b,"KICK.material.Material"))?P.push(i):d(b)):d("material");h.materials=P;a.name=y;a.addComponent(h);o.push(a);x=[]}},w=0;w<m;w++){var q=h[w].replace(/^\s+|\s+$/g,""),v=q.indexOf(" ");if(!(0>v)){var r=q.substring(0,
v),q=q.substring(v+1);if("o"===r)t(),y=q,A.length=0;else if("usemtl"===r)A.push(q),0<x.length&&(x=[],l[l.length]=x);else if("v"===r)c.push(n(q));else if("vn"===r)f.push(n(q));else if("vt"===r)g.push(n(q));else if("f"===r){r=q.split(" ");x.push(r.slice(0,3));for(q=3;q<r.length;q++)x.push([r[q-1],r[q],r[0]])}}}t();return o}})();KICK=KICK||{};KICK.namespace=function(h){var h=h.split("."),j=window,e;for(e=0;e<h.length;e+=1)"undefined"===typeof j[h[e]]&&(j[h[e]]={}),j=j[h[e]];return j};
(function(){var h=KICK.namespace("KICK.core"),j=KICK.namespace("KICK.mesh");KICK.namespace("KICK.scene");var e=h.Util.fail;h.ResourceManager=function(e){var j=[new h.URLResourceProvider(e),new h.BuiltInResourceProvider(e)],c=function(){return{ref:{},refCount:{}}},e=c(),f=c(),c=c(),g=[e,f,c],x=function(c,e){return function(f){var g;(g=c.ref[f])&&c.refCount[f]++;var h;if(g)return g;for(h=j.length-1;0<=h;h--){var t=j[h];if(0===f.indexOf(t.protocol)){g=t[e](f);break}}g&&(c.ref[f]=g,c.refCount[f]=1);return g}},
A=function(c){return function(e,f){for(var g=j.length-1;0<=g;g--){var h=j[g];if(0===e.indexOf(h.protocol)){h[c](e,f);break}}}};this.getMeshData=A("getMeshData");this.getImageData=A("getImageData");this.getShaderData=A("getShaderData");this.getMesh=x(e,"getMesh");this.getShader=x(f,"getShader");this.getTexture=x(c,"getTexture");this.release=function(c){for(var e=g.length-1;0<=e;e--)g[e].refCount[c]&&(g[e].refCount[c]--,0>=g[e].refCount[c]&&(g[e].ref[c].destroy&&g[e].ref[c].destroy(),delete g[e].refCount[c],
delete g[e].ref[c]))}};h.URLResourceProvider=function(){Object.defineProperties(this,{protocol:{value:""}});this.getMeshData=function(){e("Not implemented yet")};this.getImageData=function(h,j){var c=new Image;c.onload=function(){try{j.setImage(c,h)}catch(f){e("Exception when loading image "+h)}};c.onerror=function(c){e(c);e("Exception when loading image "+h)};c.crossOrigin="anonymous";c.src=h}};h.BuiltInResourceProvider=function(e){var m=this;Object.defineProperties(this,{protocol:{value:"kickjs"}});
this.getMeshData=function(c,e){var g,m=h.Util.getParameterInt,u=h.Util.getParameterFloat;if(0==c.indexOf("kickjs://meshdata/triangle/"))g=j.MeshFactory.createTriangleData();else if(0==c.indexOf("kickjs://meshdata/plane/"))g=j.MeshFactory.createPlaneData();else if(0==c.indexOf("kickjs://meshdata/uvsphere/"))g=m(c,"slices"),m=m(c,"stacks"),u=u(c,"radius"),g=j.MeshFactory.createUVSphereData(g,m,u);else if(0==c.indexOf("kickjs://meshdata/cube/"))g=u(c,"length"),g=j.MeshFactory.createCubeData(g);else{KICK.core.Util.fail("No meshdata found for "+
c);return}e.meshData=g};this.getMesh=function(c){var f,g,m=h.Util.getParameterInt,A=h.Util.getParameterFloat;if(0==c.indexOf("kickjs://mesh/triangle/"))f={name:"Triangle"},g=j.MeshFactory.createTriangleData();else if(0==c.indexOf("kickjs://mesh/plane/"))f={name:"Plane"},g=j.MeshFactory.createPlaneData();else if(0==c.indexOf("kickjs://mesh/uvsphere/"))f={name:"UVSphere"},g=m(c,"slices"),m=m(c,"stacks"),c=A(c,"radius"),g=j.MeshFactory.createUVSphereData(g,m,c);else if(0==c.indexOf("kickjs://mesh/cube/"))f=
{name:"Cube"},g=A(c,"length"),g=j.MeshFactory.createCubeData(g);else return null;if(g)return f.meshData=g,new j.Mesh(e,f)};this.getShaderData=function(c,e){var g,h,j=!1,l=!1,m=!0,u=1E3,n=KICK.material.GLSLConstants,s="phong,shadowmap,error,pick,transparent_phong,unlit,transparent_unlit".split(",");"kickjs://shader/default/"===c&&(c="kickjs://shader/phong/");for(var t=0;t<s.length;t++){var w=s[t],q=0===c.indexOf("kickjs://shader/"+w+"/");q&&(g=n[w+"_vs.glsl"],h=n[w+"_fs.glsl"],0===w.indexOf("transparent_")&&
(j=!0,m=!1,u=2E3),"shadowmap"===w&&(l=!0));if(q)break}KICK.core.Util.applyConfig(e,{blend:j,depthMask:m,renderOrder:u,polygonOffsetEnabled:l,vertexShaderSrc:g,fragmentShaderSrc:h});e.updateShader()};this.getShader=function(c){var f=new KICK.material.Shader(e);this.getShaderData(c,f);return f};this.getImageData=function(c,e){var g;if(0==c.indexOf("kickjs://texture/black/"))g=new Uint8Array([0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255]);else if(0==c.indexOf("kickjs://texture/white/"))g=new Uint8Array([255,
255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]);else if(0==c.indexOf("kickjs://texture/gray/"))g=new Uint8Array([127,127,127,255,127,127,127,255,127,127,127,255,127,127,127,255]);else return KICK.core.Util.fail("Unknown uri "+c),null;e.setImageData(2,2,0,5121,g,c)};this.getTexture=function(c){var f=new KICK.texture.Texture(e,{minFilter:9728,magFilter:9728,generateMipmaps:!1,internalFormat:6408});m.getImageData(c,f);return f}}})();
