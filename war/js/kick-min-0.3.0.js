/*!
 * New BSD License
 *
 * Copyright (c) 2011, Morten Nobel-Joergensen, Kickstart Games ( http://www.kickstartgames.com/ )
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
 * following conditions are met:
 *
 * - Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer.
 * - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following
 * disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -----
 * KICK.math is based on
 * glMatrix.js - High performance matrix and vector operations for WebGL
 * http://code.google.com/p/glmatrix/
 * version 0.9.6
 *
 * Copyright (c) 2011 Brandon Jones
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */
 'use strict';var KICK=KICK||{};KICK.namespace=KICK.namespace||function(g){var g=g.split("."),k=KICK,h;"KICK"===g[0]&&(g=g.slice(1));for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.core");g.Constants={};Object.defineProperties(g.Constants,{_VERSION:{value:"0.0.0",configurable:!0,enumerable:!0},_ASSERT:{value:!0,enumerable:!0,configurable:!0},_DEBUG:{value:!0,enumerable:!0,configurable:!0},_DEGREE_TO_RADIAN:{value:0.01745329251994,enumerable:!0},_RADIAN_TO_DEGREE:{value:57.2957795130824,enumerable:!0},_EPSILON:{value:1.0E-5,enumerable:!0},_LIGHT_TYPE_AMBIENT:{value:1,enumerable:!0},_LIGHT_TYPE_DIRECTIONAL:{value:2,enumerable:!0},_LIGHT_TYPE_POINT:{value:3,
enumerable:!0},GL_DEPTH_BUFFER_BIT:{value:256,enumerable:!0},GL_STENCIL_BUFFER_BIT:{value:1024,enumerable:!0},GL_COLOR_BUFFER_BIT:{value:16384,enumerable:!0},GL_POINTS:{value:0,enumerable:!0},GL_LINES:{value:1,enumerable:!0},GL_LINE_LOOP:{value:2,enumerable:!0},GL_LINE_STRIP:{value:3,enumerable:!0},GL_TRIANGLES:{value:4,enumerable:!0},GL_TRIANGLE_STRIP:{value:5,enumerable:!0},GL_TRIANGLE_FAN:{value:6,enumerable:!0},GL_ZERO:{value:0,enumerable:!0},GL_ONE:{value:1,enumerable:!0},GL_SRC_COLOR:{value:768,
enumerable:!0},GL_ONE_MINUS_SRC_COLOR:{value:769,enumerable:!0},GL_SRC_ALPHA:{value:770,enumerable:!0},GL_ONE_MINUS_SRC_ALPHA:{value:771,enumerable:!0},GL_DST_ALPHA:{value:772,enumerable:!0},GL_ONE_MINUS_DST_ALPHA:{value:773,enumerable:!0},GL_DST_COLOR:{value:774,enumerable:!0},GL_ONE_MINUS_DST_COLOR:{value:775,enumerable:!0},GL_SRC_ALPHA_SATURATE:{value:776,enumerable:!0},GL_FUNC_ADD:{value:32774,enumerable:!0},GL_BLEND_EQUATION:{value:32777,enumerable:!0},GL_BLEND_EQUATION_RGB:{value:32777,enumerable:!0},
GL_BLEND_EQUATION_ALPHA:{value:34877,enumerable:!0},GL_FUNC_SUBTRACT:{value:32778,enumerable:!0},GL_FUNC_REVERSE_SUBTRACT:{value:32779,enumerable:!0},GL_BLEND_DST_RGB:{value:32968,enumerable:!0},GL_BLEND_SRC_RGB:{value:32969,enumerable:!0},GL_BLEND_DST_ALPHA:{value:32970,enumerable:!0},GL_BLEND_SRC_ALPHA:{value:32971,enumerable:!0},GL_CONSTANT_COLOR:{value:32769,enumerable:!0},GL_ONE_MINUS_CONSTANT_COLOR:{value:32770,enumerable:!0},GL_CONSTANT_ALPHA:{value:32771,enumerable:!0},GL_ONE_MINUS_CONSTANT_ALPHA:{value:32772,
enumerable:!0},GL_BLEND_COLOR:{value:32773,enumerable:!0},GL_ARRAY_BUFFER:{value:34962,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER:{value:34963,enumerable:!0},GL_ARRAY_BUFFER_BINDING:{value:34964,enumerable:!0},GL_ELEMENT_ARRAY_BUFFER_BINDING:{value:34965,enumerable:!0},GL_STREAM_DRAW:{value:35040,enumerable:!0},GL_STATIC_DRAW:{value:35044,enumerable:!0},GL_DYNAMIC_DRAW:{value:35048,enumerable:!0},GL_BUFFER_SIZE:{value:34660,enumerable:!0},GL_BUFFER_USAGE:{value:34661,enumerable:!0},GL_CURRENT_VERTEX_ATTRIB:{value:34342,
enumerable:!0},GL_FRONT:{value:1028,enumerable:!0},GL_BACK:{value:1029,enumerable:!0},GL_FRONT_AND_BACK:{value:1032,enumerable:!0},GL_TEXTURE_2D:{value:3553,enumerable:!0},GL_CULL_FACE:{value:2884,enumerable:!0},GL_BLEND:{value:3042,enumerable:!0},GL_DITHER:{value:3024,enumerable:!0},GL_STENCIL_TEST:{value:2960,enumerable:!0},GL_DEPTH_TEST:{value:2929,enumerable:!0},GL_SCISSOR_TEST:{value:3089,enumerable:!0},GL_POLYGON_OFFSET_FILL:{value:32823,enumerable:!0},GL_SAMPLE_ALPHA_TO_COVERAGE:{value:32926,
enumerable:!0},GL_SAMPLE_COVERAGE:{value:32928,enumerable:!0},GL_NO_ERROR:{value:0,enumerable:!0},GL_INVALID_ENUM:{value:1280,enumerable:!0},GL_INVALID_VALUE:{value:1281,enumerable:!0},GL_INVALID_OPERATION:{value:1282,enumerable:!0},GL_OUT_OF_MEMORY:{value:1285,enumerable:!0},GL_CW:{value:2304,enumerable:!0},GL_CCW:{value:2305,enumerable:!0},GL_LINE_WIDTH:{value:2849,enumerable:!0},GL_ALIASED_POINT_SIZE_RANGE:{value:33901,enumerable:!0},GL_ALIASED_LINE_WIDTH_RANGE:{value:33902,enumerable:!0},GL_CULL_FACE_MODE:{value:2885,
enumerable:!0},GL_FRONT_FACE:{value:2886,enumerable:!0},GL_DEPTH_RANGE:{value:2928,enumerable:!0},GL_DEPTH_WRITEMASK:{value:2930,enumerable:!0},GL_DEPTH_CLEAR_VALUE:{value:2931,enumerable:!0},GL_DEPTH_FUNC:{value:2932,enumerable:!0},GL_STENCIL_CLEAR_VALUE:{value:2961,enumerable:!0},GL_STENCIL_FUNC:{value:2962,enumerable:!0},GL_STENCIL_FAIL:{value:2964,enumerable:!0},GL_STENCIL_PASS_DEPTH_FAIL:{value:2965,enumerable:!0},GL_STENCIL_PASS_DEPTH_PASS:{value:2966,enumerable:!0},GL_STENCIL_REF:{value:2967,
enumerable:!0},GL_STENCIL_VALUE_MASK:{value:2963,enumerable:!0},GL_STENCIL_WRITEMASK:{value:2968,enumerable:!0},GL_STENCIL_BACK_FUNC:{value:34816,enumerable:!0},GL_STENCIL_BACK_FAIL:{value:34817,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_FAIL:{value:34818,enumerable:!0},GL_STENCIL_BACK_PASS_DEPTH_PASS:{value:34819,enumerable:!0},GL_STENCIL_BACK_REF:{value:36003,enumerable:!0},GL_STENCIL_BACK_VALUE_MASK:{value:36004,enumerable:!0},GL_STENCIL_BACK_WRITEMASK:{value:36005,enumerable:!0},GL_VIEWPORT:{value:2978,
enumerable:!0},GL_SCISSOR_BOX:{value:3088,enumerable:!0},GL_COLOR_CLEAR_VALUE:{value:3106,enumerable:!0},GL_COLOR_WRITEMASK:{value:3107,enumerable:!0},GL_UNPACK_ALIGNMENT:{value:3317,enumerable:!0},GL_PACK_ALIGNMENT:{value:3333,enumerable:!0},GL_MAX_TEXTURE_SIZE:{value:3379,enumerable:!0},GL_MAX_VIEWPORT_DIMS:{value:3386,enumerable:!0},GL_SUBPIXEL_BITS:{value:3408,enumerable:!0},GL_RED_BITS:{value:3410,enumerable:!0},GL_GREEN_BITS:{value:3411,enumerable:!0},GL_BLUE_BITS:{value:3412,enumerable:!0},
GL_ALPHA_BITS:{value:3413,enumerable:!0},GL_DEPTH_BITS:{value:3414,enumerable:!0},GL_STENCIL_BITS:{value:3415,enumerable:!0},GL_POLYGON_OFFSET_UNITS:{value:10752,enumerable:!0},GL_POLYGON_OFFSET_FACTOR:{value:32824,enumerable:!0},GL_TEXTURE_BINDING_2D:{value:32873,enumerable:!0},GL_SAMPLE_BUFFERS:{value:32936,enumerable:!0},GL_SAMPLES:{value:32937,enumerable:!0},GL_SAMPLE_COVERAGE_VALUE:{value:32938,enumerable:!0},GL_SAMPLE_COVERAGE_INVERT:{value:32939,enumerable:!0},GL_NUM_COMPRESSED_TEXTURE_FORMATS:{value:34466,
enumerable:!0},GL_COMPRESSED_TEXTURE_FORMATS:{value:34467,enumerable:!0},GL_DONT_CARE:{value:4352,enumerable:!0},GL_FASTEST:{value:4353,enumerable:!0},GL_NICEST:{value:4354,enumerable:!0},GL_GENERATE_MIPMAP_HINT:{value:33170,enumerable:!0},GL_BYTE:{value:5120,enumerable:!0},GL_UNSIGNED_BYTE:{value:5121,enumerable:!0},GL_SHORT:{value:5122,enumerable:!0},GL_UNSIGNED_SHORT:{value:5123,enumerable:!0},GL_INT:{value:5124,enumerable:!0},GL_UNSIGNED_INT:{value:5125,enumerable:!0},GL_FLOAT:{value:5126,enumerable:!0},
GL_DEPTH_COMPONENT:{value:6402,enumerable:!0},GL_ALPHA:{value:6406,enumerable:!0},GL_RGB:{value:6407,enumerable:!0},GL_RGBA:{value:6408,enumerable:!0},GL_LUMINANCE:{value:6409,enumerable:!0},GL_LUMINANCE_ALPHA:{value:6410,enumerable:!0},GL_UNSIGNED_SHORT_4_4_4_4:{value:32819,enumerable:!0},GL_UNSIGNED_SHORT_5_5_5_1:{value:32820,enumerable:!0},GL_UNSIGNED_SHORT_5_6_5:{value:33635,enumerable:!0},GL_FRAGMENT_SHADER:{value:35632,enumerable:!0},GL_VERTEX_SHADER:{value:35633,enumerable:!0},GL_MAX_VERTEX_ATTRIBS:{value:34921,
enumerable:!0},GL_MAX_VERTEX_UNIFORM_VECTORS:{value:36347,enumerable:!0},GL_MAX_VARYING_VECTORS:{value:36348,enumerable:!0},GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS:{value:35661,enumerable:!0},GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS:{value:35660,enumerable:!0},GL_MAX_TEXTURE_IMAGE_UNITS:{value:34930,enumerable:!0},GL_MAX_FRAGMENT_UNIFORM_VECTORS:{value:36349,enumerable:!0},GL_SHADER_TYPE:{value:35663,enumerable:!0},GL_DELETE_STATUS:{value:35712,enumerable:!0},GL_LINK_STATUS:{value:35714,enumerable:!0},GL_VALIDATE_STATUS:{value:35715,
enumerable:!0},GL_ATTACHED_SHADERS:{value:35717,enumerable:!0},GL_ACTIVE_UNIFORMS:{value:35718,enumerable:!0},GL_ACTIVE_ATTRIBUTES:{value:35721,enumerable:!0},GL_SHADING_LANGUAGE_VERSION:{value:35724,enumerable:!0},GL_CURRENT_PROGRAM:{value:35725,enumerable:!0},GL_NEVER:{value:512,enumerable:!0},GL_LESS:{value:513,enumerable:!0},GL_EQUAL:{value:514,enumerable:!0},GL_LEQUAL:{value:515,enumerable:!0},GL_GREATER:{value:516,enumerable:!0},GL_NOTEQUAL:{value:517,enumerable:!0},GL_GEQUAL:{value:518,enumerable:!0},
GL_ALWAYS:{value:519,enumerable:!0},GL_KEEP:{value:7680,enumerable:!0},GL_REPLACE:{value:7681,enumerable:!0},GL_INCR:{value:7682,enumerable:!0},GL_DECR:{value:7683,enumerable:!0},GL_INVERT:{value:5386,enumerable:!0},GL_INCR_WRAP:{value:34055,enumerable:!0},GL_DECR_WRAP:{value:34056,enumerable:!0},GL_VENDOR:{value:7936,enumerable:!0},GL_RENDERER:{value:7937,enumerable:!0},GL_VERSION:{value:7938,enumerable:!0},GL_NEAREST:{value:9728,enumerable:!0},GL_LINEAR:{value:9729,enumerable:!0},GL_NEAREST_MIPMAP_NEAREST:{value:9984,
enumerable:!0},GL_LINEAR_MIPMAP_NEAREST:{value:9985,enumerable:!0},GL_NEAREST_MIPMAP_LINEAR:{value:9986,enumerable:!0},GL_LINEAR_MIPMAP_LINEAR:{value:9987,enumerable:!0},GL_TEXTURE_MAG_FILTER:{value:10240,enumerable:!0},GL_TEXTURE_MIN_FILTER:{value:10241,enumerable:!0},GL_TEXTURE_WRAP_S:{value:10242,enumerable:!0},GL_TEXTURE_WRAP_T:{value:10243,enumerable:!0},GL_TEXTURE:{value:5890,enumerable:!0},GL_TEXTURE_CUBE_MAP:{value:34067,enumerable:!0},GL_TEXTURE_BINDING_CUBE_MAP:{value:34068,enumerable:!0},
GL_TEXTURE_CUBE_MAP_POSITIVE_X:{value:34069,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_X:{value:34070,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Y:{value:34071,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:{value:34072,enumerable:!0},GL_TEXTURE_CUBE_MAP_POSITIVE_Z:{value:34073,enumerable:!0},GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:{value:34074,enumerable:!0},GL_MAX_CUBE_MAP_TEXTURE_SIZE:{value:34076,enumerable:!0},GL_TEXTURE0:{value:33984,enumerable:!0},GL_TEXTURE1:{value:33985,enumerable:!0},GL_TEXTURE2:{value:33986,
enumerable:!0},GL_TEXTURE3:{value:33987,enumerable:!0},GL_TEXTURE4:{value:33988,enumerable:!0},GL_TEXTURE5:{value:33989,enumerable:!0},GL_TEXTURE6:{value:33990,enumerable:!0},GL_TEXTURE7:{value:33991,enumerable:!0},GL_TEXTURE8:{value:33992,enumerable:!0},GL_TEXTURE9:{value:33993,enumerable:!0},GL_TEXTURE10:{value:33994,enumerable:!0},GL_TEXTURE11:{value:33995,enumerable:!0},GL_TEXTURE12:{value:33996,enumerable:!0},GL_TEXTURE13:{value:33997,enumerable:!0},GL_TEXTURE14:{value:33998,enumerable:!0},GL_TEXTURE15:{value:33999,
enumerable:!0},GL_TEXTURE16:{value:34E3,enumerable:!0},GL_TEXTURE17:{value:34001,enumerable:!0},GL_TEXTURE18:{value:34002,enumerable:!0},GL_TEXTURE19:{value:34003,enumerable:!0},GL_TEXTURE20:{value:34004,enumerable:!0},GL_TEXTURE21:{value:34005,enumerable:!0},GL_TEXTURE22:{value:34006,enumerable:!0},GL_TEXTURE23:{value:34007,enumerable:!0},GL_TEXTURE24:{value:34008,enumerable:!0},GL_TEXTURE25:{value:34009,enumerable:!0},GL_TEXTURE26:{value:34010,enumerable:!0},GL_TEXTURE27:{value:34011,enumerable:!0},
GL_TEXTURE28:{value:34012,enumerable:!0},GL_TEXTURE29:{value:34013,enumerable:!0},GL_TEXTURE30:{value:34014,enumerable:!0},GL_TEXTURE31:{value:34015,enumerable:!0},GL_ACTIVE_TEXTURE:{value:34016,enumerable:!0},GL_REPEAT:{value:10497,enumerable:!0},GL_CLAMP_TO_EDGE:{value:33071,enumerable:!0},GL_MIRRORED_REPEAT:{value:33648,enumerable:!0},GL_FLOAT_VEC2:{value:35664,enumerable:!0},GL_FLOAT_VEC3:{value:35665,enumerable:!0},GL_FLOAT_VEC4:{value:35666,enumerable:!0},GL_INT_VEC2:{value:35667,enumerable:!0},
GL_INT_VEC3:{value:35668,enumerable:!0},GL_INT_VEC4:{value:35669,enumerable:!0},GL_BOOL:{value:35670,enumerable:!0},GL_BOOL_VEC2:{value:35671,enumerable:!0},GL_BOOL_VEC3:{value:35672,enumerable:!0},GL_BOOL_VEC4:{value:35673,enumerable:!0},GL_FLOAT_MAT2:{value:35674,enumerable:!0},GL_FLOAT_MAT3:{value:35675,enumerable:!0},GL_FLOAT_MAT4:{value:35676,enumerable:!0},GL_SAMPLER_2D:{value:35678,enumerable:!0},GL_SAMPLER_CUBE:{value:35680,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_ENABLED:{value:34338,enumerable:!0},
GL_VERTEX_ATTRIB_ARRAY_SIZE:{value:34339,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_STRIDE:{value:34340,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_TYPE:{value:34341,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_NORMALIZED:{value:34922,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_POINTER:{value:34373,enumerable:!0},GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:{value:34975,enumerable:!0},GL_COMPILE_STATUS:{value:35713,enumerable:!0},GL_SHADER_COMPILER:{value:36346,enumerable:!0},GL_LOW_FLOAT:{value:36336,enumerable:!0},GL_MEDIUM_FLOAT:{value:36337,
enumerable:!0},GL_HIGH_FLOAT:{value:36338,enumerable:!0},GL_LOW_INT:{value:36339,enumerable:!0},GL_MEDIUM_INT:{value:36340,enumerable:!0},GL_HIGH_INT:{value:36341,enumerable:!0},GL_FRAMEBUFFER:{value:36160,enumerable:!0},GL_RENDERBUFFER:{value:36161,enumerable:!0},GL_RGBA4:{value:32854,enumerable:!0},GL_RGB5_A1:{value:32855,enumerable:!0},GL_RGB565:{value:36194,enumerable:!0},GL_DEPTH_COMPONENT16:{value:33189,enumerable:!0},GL_STENCIL_INDEX:{value:6401,enumerable:!0},GL_STENCIL_INDEX8:{value:36168,
enumerable:!0},GL_DEPTH_STENCIL:{value:34041,enumerable:!0},GL_RENDERBUFFER_WIDTH:{value:36162,enumerable:!0},GL_RENDERBUFFER_HEIGHT:{value:36163,enumerable:!0},GL_RENDERBUFFER_INTERNAL_FORMAT:{value:36164,enumerable:!0},GL_RENDERBUFFER_RED_SIZE:{value:36176,enumerable:!0},GL_RENDERBUFFER_GREEN_SIZE:{value:36177,enumerable:!0},GL_RENDERBUFFER_BLUE_SIZE:{value:36178,enumerable:!0},GL_RENDERBUFFER_ALPHA_SIZE:{value:36179,enumerable:!0},GL_RENDERBUFFER_DEPTH_SIZE:{value:36180,enumerable:!0},GL_RENDERBUFFER_STENCIL_SIZE:{value:36181,
enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:{value:36048,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:{value:36049,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:{value:36050,enumerable:!0},GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:{value:36051,enumerable:!0},GL_COLOR_ATTACHMENT0:{value:36064,enumerable:!0},GL_DEPTH_ATTACHMENT:{value:36096,enumerable:!0},GL_STENCIL_ATTACHMENT:{value:36128,enumerable:!0},GL_DEPTH_STENCIL_ATTACHMENT:{value:33306,enumerable:!0},GL_NONE:{value:0,
enumerable:!0},GL_FRAMEBUFFER_COMPLETE:{value:36053,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:{value:36054,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:{value:36055,enumerable:!0},GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:{value:36057,enumerable:!0},GL_FRAMEBUFFER_UNSUPPORTED:{value:36061,enumerable:!0},GL_FRAMEBUFFER_BINDING:{value:36006,enumerable:!0},GL_RENDERBUFFER_BINDING:{value:36007,enumerable:!0},GL_MAX_RENDERBUFFER_SIZE:{value:34024,enumerable:!0},GL_INVALID_FRAMEBUFFER_OPERATION:{value:1286,
enumerable:!0},GL_UNPACK_FLIP_Y_WEBGL:{value:37440,enumerable:!0},GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL:{value:37441,enumerable:!0},GL_CONTEXT_LOST_WEBGL:{value:37442,enumerable:!0},GL_UNPACK_COLORSPACE_CONVERSION_WEBGL:{value:37443,enumerable:!0},GL_BROWSER_DEFAULT_WEBGL:{value:37444,enumerable:!0}})})();this.exports=this.exports||{};exports.Constants=KICK.core.Constants;KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){KICK.namespace("KICK.material").GLSLConstants={"__error_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvoid main(void)\n{\ngl_FragColor = vec4(1.0,0.5, 0.9, 1.0);\n}","__error_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ","__pick_fs.glsl":"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 gameObjectUID;\nvoid main(void)\n{\ngl_FragColor = gameObjectUID;\n}","__pick_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nuniform vec4 _gameObjectUID;\nvarying vec4 gameObjectUID;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\ngameObjectUID = _gameObjectUID;\n}",
"__shadowmap_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 packDepth( const in float depth ) {\nconst vec4 bitShift = vec4( 16777216.0, 65536.0, 256.0, 1.0 );\nconst vec4 bitMask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bitShift );\nres -= res.xxyz * bitMask;\nreturn res;\n}\nvoid main() {\ngl_FragColor = packDepth( gl_FragCoord.z );\n}\n","__shadowmap_vs.glsl":"attribute vec3 vertex;\nuniform mat4 _mvProj;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\n} ",
"light.glsl":"struct DirectionalLight {\nvec3 lDir;\nvec3 colInt;\nvec3 halfV;\n};\n// assumes that normal is normalized\nvoid getDirectionalLight(vec3 normal, DirectionalLight dLight, float specularExponent, out vec3 diffuse, out float specular){\nfloat diffuseContribution = max(dot(normal, dLight.lDir), 0.0);\n\tfloat specularContribution = max(dot(normal, dLight.halfV), 0.0);\nspecular = pow(specularContribution, specularExponent);\n\tdiffuse = (dLight.colInt * diffuseContribution);\n}\nuniform DirectionalLight _dLight;\nuniform vec3 _ambient;",
"phong_fs.glsl":'#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform vec3 mainColor;\nuniform float specularExponent;\nuniform vec3 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\n#pragma include "shadowmap.glsl"\nvoid main(void)\n{\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(vNormal, _dLight, specularExponent, diffuse, specular);\nfloat visibility;\nif (SHADOWS){\ncomputeLightVisibility();\n} else {\nvisibility = 1.0;\n}\nvec3 color = max(diffuse*visibility,_ambient.xyz)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*vec4(color, 1.0)+vec4(specular*specularColor,0.0);\n}\n',
"phong_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat4 _lightMat;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec4 vShadowMapCoord;\nvoid main(void) {\nvec4 v = vec4(vertex, 1.0);\ngl_Position = _mvProj * v;\nvUv = uv1;\nvNormal= normalize(_norm * normal);\nvShadowMapCoord = _lightMat * v;\n} ","shadowmap.glsl":"varying vec4 vShadowMapCoord;\nuniform sampler2D _shadowMapTexture;\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 16777216.0 ), 1.0 / ( 65536.0 ), 1.0 / 256.0, 1.0 );\nreturn dot( rgba_depth, bit_shift );\n}\nfloat computeLightVisibility(){\nvec3 shadowCoord = vShadowMapCoord.xyz / vShadowMapCoord.w;\nvec4 packedShadowDepth = texture2D(_shadowMapTexture,shadowCoord.xy);\nfloat shadowDepth = unpackDepth(packedShadowDepth);\nif (shadowDepth < shadowCoord.z){\nreturn 1.0;\n}\nreturn 0.0;\n}",
"transparent_phong_fs.glsl":'#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform vec4 mainColor;\nuniform float specularExponent;\nuniform vec3 specularColor;\nuniform sampler2D mainTexture;\n#pragma include "light.glsl"\nvoid main(void)\n{\nvec3 diffuse;\nfloat specular;\ngetDirectionalLight(vNormal, _dLight, specularExponent, diffuse, specular);\nvec4 color = vec4(max(diffuse,_ambient.xyz),1.0)*mainColor;\ngl_FragColor = texture2D(mainTexture,vUv)*color+vec4(specular*specularColor,0.0);\n}\n',
"transparent_phong_vs.glsl":"attribute vec3 vertex;\nattribute vec3 normal;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nuniform mat3 _norm;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvoid main(void) {\n// compute position\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n// compute light info\nvNormal= normalize(_norm * normal);\n} ","transparent_unlit_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nuniform vec4 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = texture2D(mainTexture,vUv)*mainColor;\n}\n",
"transparent_unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}","unlit_fs.glsl":"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec2 vUv;\nuniform vec3 mainColor;\nuniform sampler2D mainTexture;\nvoid main(void)\n{\ngl_FragColor = texture2D(mainTexture,vUv)*vec4(mainColor,1.0);\n}\n","unlit_vs.glsl":"attribute vec3 vertex;\nattribute vec2 uv1;\nuniform mat4 _mvProj;\nvarying vec2 vUv;\nvoid main(void) {\ngl_Position = _mvProj * vec4(vertex, 1.0);\nvUv = uv1;\n}"}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.math"),k=KICK.namespace("KICK.math.vec2"),h=KICK.namespace("KICK.math.vec3"),x=KICK.namespace("KICK.math.vec4"),l=KICK.namespace("KICK.math.mat3"),i=KICK.namespace("KICK.math.mat4"),c=KICK.namespace("KICK.math.quat4"),e=KICK.namespace("KICK.math.aabb"),f=Math.min,p=Math.max,m=Math.sqrt,A=Math.cos,z=Math.acos,q=Math.sin,s=Math.asin,n=Math.abs,v=Math.tan,o=Math.atan,w=Math.atan2,r=Math.PI,y=function(a,b){var d,j=0,u=a.length/b,c=Array(u);for(d=0;d<u;d++,j+=b)c[d]=
a.subarray(j,j+b);return c};g.vec2=k;k.wrapArray=function(a){return y(a,2)};k.array=function(a,b){var d=new Float32Array(2*a);if(b)b.mem=d;return k.wrapArray(d)};k.create=function(a){var b=new Float32Array(2);a&&(b[0]=a[0],b[1]=a[1]);return b};k.set=function(a,b){b[0]=a[0];b[1]=a[1];return b};k.add=function(a,b,d){if(!d||a==d)return a[0]+=b[0],a[1]+=b[1],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];return d};k.subtract=function(a,b,d){if(!d||a==d)return a[0]-=b[0],a[1]-=b[1],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];return d};
k.equal=function(a,b,d){d||(d=1.0E-5);for(var j=0;2>j;j++)if(n(a[j]-b[j])>d)return!1;return!0};k.normalize=function(a,b){b||(b=a);var d=a[0],j=a[1],u=m(d*d+j*j);if(u){if(1==u)return b[0]=d,b[1]=j,b}else return b[0]=0,b[1]=0,b;u=1/u;b[0]=d*u;b[1]=j*u;return b};g.vec3=h;h.wrapArray=function(a){return y(a,3)};h.array=function(a,b){var d=new Float32Array(3*a);if(b)b.mem=d;return h.wrapArray(d)};h.create=function(a){var b=new Float32Array(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b};h.set=function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};h.add=function(a,b,d){if(!d||a===d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d};h.subtract=function(a,b,d){if(!d||a===d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};h.equal=function(a,b,d){d||(d=1.0E-5);for(var j=0;3>j;j++)if(n(a[j]-b[j])>d)return!1;return!0};h.multiply=function(a,b,d){if(!d||a==d)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;d[0]=a[0]*b[0];
d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};h.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};h.scale=function(a,b,d){if(!d||a===d)return a[0]*=b,a[1]*=b,a[2]*=b,a;d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};h.normalize=function(a,b){b||(b=a);var d=a[0],j=a[1],u=a[2],c=Math.sqrt(d*d+j*j+u*u);if(c){if(1===c)return b[0]=d,b[1]=j,b[2]=u,b}else return b[0]=0,b[1]=0,b[2]=0,b;c=1/c;b[0]=d*c;b[1]=j*c;b[2]=u*c;return b};h.cross=function(a,b,d){d||(d=a);var j=a[0],u=a[1],a=a[2],c=b[0],
t=b[1],b=b[2];d[0]=u*b-a*t;d[1]=a*c-j*b;d[2]=j*t-u*c;return d};h.length=function(a){var b=a[0],d=a[1],a=a[2];return m(b*b+d*d+a*a)};h.lengthSqr=function(a){var b=a[0],d=a[1],a=a[2];return b*b+d*d+a*a};h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};h.direction=function(a,b,d){d||(d=a);var j=a[0]-b[0],u=a[1]-b[1],a=a[2]-b[2],b=m(j*j+u*u+a*a);if(!b)return d[0]=0,d[1]=0,d[2]=0,d;b=1/b;d[0]=j*b;d[1]=u*b;d[2]=a*b;return d};h.lerp=function(a,b,d,j){j||(j=a);j[0]=a[0]+d*(b[0]-a[0]);j[1]=a[1]+d*
(b[1]-a[1]);j[2]=a[2]+d*(b[2]-a[2]);return j};h.dist=function(a,b){var d=b[0]-a[0],j=b[1]-a[1],u=b[2]-a[2];return Math.sqrt(d*d+j*j+u*u)};h.unproject=function(){var a=new Float32Array(16),b=new Float32Array(4);return function(d,j,u,c,t){t||(t=d);b[0]=2*(d[0]-c[0])/c[2]-1;b[1]=2*(d[1]-c[1])/c[3]-1;b[2]=2*d[2]-1;b[3]=1;i.multiply(u,j,a);if(!i.inverse(a))return null;i.multiplyVec4(a,b);if(0===b[3])return null;t[0]=b[0]/b[3];t[1]=b[1]/b[3];t[2]=b[2]/b[3];return t}}();h.sphericalToCarterian=function(a,
b){var d=a[0],j=-a[1],u=a[2],c=d*A(u);b||(b=h.create());b[0]=c*A(j);b[1]=d*q(u);b[2]=c*q(j);return b};h.cartesianToSpherical=function(a,b){var d=a[0],j=a[1],u=a[2],c;0==d&&(d=1.0E-5);b||(b=h.create());b[0]=c=m(d*d+j*j+u*u);b[1]=-o(u/d);0>d&&(b[1]+=r);b[2]=s(j/c);return b};h.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};g.vec4=x;x.wrapArray=function(a){return y(a,4)};x.array=function(a,b){var d=new Float32Array(4*a);if(b)b.mem=d;return x.wrapArray(d)};x.create=function(a){var b=new Float32Array(4);
a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b};x.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};x.add=function(a,b,d){if(!d||a==d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};x.subtract=function(a,b,d){if(!d||a==d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a[3]-=b[3],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};x.equal=function(a,b,d){d||(d=1.0E-5);for(var j=0;2>j;j++)if(n(a[j]-
b[j])>d)return!1;return!0};x.multiply=function(a,b,d){if(!d||a==d)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a[3]*=b[3],a;d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};x.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};x.length=function(a){var b=a[0],d=a[1],j=a[2],a=a[3];return m(b*b+d*d+j*j+a*a)};x.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};x.scale=function(a,b,d){if(!d||a==d)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;d[0]=
a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[2]*b;return d};x.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};g.mat3=l;l.create=function(a){var b=new Float32Array(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]);return b};l.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};l.identity=function(a){a||(a=l.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=
1;return a};l.transpose=function(a,b){if(!b||a===b){var d=a[1],j=a[2],u=a[5];a[1]=a[3];a[2]=a[6];a[3]=d;a[5]=a[7];a[6]=j;a[7]=u;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};l.toMat4=function(a,b){b||(b=i.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};l.toQuat=function(a,b){var d=a[0],j=a[1],u=a[2],i=a[3],t=a[4],e=a[5],
f=a[6],g=a[7],n=a[8],s=d+t+n;b||(b=c.create());0<s?(d=0.5/m(s+1),b[0]=(e-g)*d,b[1]=(f-u)*d,b[2]=(j-i)*d,b[3]=0.25/d):d>t&&d>n?(d=2*m(1+d-t-n),b[0]=0.25*d,b[1]=(i+j)/d,b[2]=(f+u)/d,b[3]=(e-g)/d):t>n?(d=2*m(1+t-d-n),b[0]=(i+j)/d,b[1]=0.25*d,b[2]=(g+e)/d,b[3]=(f-u)/d):(d=2*m(1+n-d-t),b[0]=(f+u)/d,b[1]=(g+e)/d,b[2]=0.25*d,b[3]=(j-i)/d);return b};l.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};l.strPretty=function(a){return"["+a[0]+
", "+a[3]+", "+a[6]+"\n, "+a[1]+", "+a[4]+", "+a[7]+"\n, "+a[2]+", "+a[5]+", "+a[8]+"]"};g.mat4=i;i.create=function(a){var b=new Float32Array(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b};i.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];
b[14]=a[14];b[15]=a[15];return b};i.setTRS=function(a,b,d,j){j||(j=i.create());var u=d[0],c=d[1],d=d[2],t=b[0],e=b[1],f=b[2],g=b[3],m=t+t,n=e+e,s=f+f,b=t*m,p=t*n,t=t*s,h=e*n,e=e*s,f=f*s,m=g*m,n=g*n,g=g*s;j[0]=(1-(h+f))*u;j[1]=(p+g)*u;j[2]=(t-n)*u;j[3]=0;j[4]=(p-g)*c;j[5]=(1-(b+f))*c;j[6]=(e+m)*c;j[7]=0;j[8]=(t+n)*d;j[9]=(e-m)*d;j[10]=(1-(b+h))*d;j[11]=0;j[12]=a[0];j[13]=a[1];j[14]=a[2];j[15]=1;return j};i.setTRSInverse=function(a,b,d,j){j||(j=i.create());var u=d[0],c=d[1],t=d[2],e=b[0],f=b[1],g=b[2],
b=b[3],m=e+e,n=f+f,d=g+g,s=e*m,p=e*n,e=e*d,h=f*n,f=f*d,g=g*d,m=b*m,n=b*n,q=b*d,b=(1-(h+g))*u,d=(p+q)*u,u=(e-n)*u,p=(p-q)*c,g=(1-(s+g))*c,c=(f+m)*c,e=(e+n)*t,f=(f-m)*t,t=(1-(s+h))*t,s=a[0],h=a[1],a=a[2],m=b*g-d*p,n=b*c-u*p,q=d*c-u*g,l=e*h-f*s,v=e*a-t*s,r=1*e,A=f*a-t*h,k=1*f,z=1*t,o=m*z-n*k+q*r;if(!o)return null;o=1/o;j[0]=(g*z-c*k)*o;j[1]=(-d*z+u*k)*o;j[2]=1*q*o;j[3]=0;j[4]=(-p*z+c*r)*o;j[5]=(b*z-u*r)*o;j[6]=-1*n*o;j[7]=0;j[8]=(p*k-g*r)*o;j[9]=(-b*k+d*r)*o;j[10]=1*m*o;j[11]=0;j[12]=(-p*A+g*v-c*l)*
o;j[13]=(b*A-d*v+u*l)*o;j[14]=(-s*q+h*n-a*m)*o;j[15]=(e*q-f*n+t*m)*o;return j};i.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};i.transpose=function(a,b){if(!b||a===b){var d=a[1],j=a[2],u=a[3],c=a[6],t=a[7],i=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=d;a[6]=a[9];a[7]=a[13];a[8]=j;a[9]=c;a[11]=a[14];a[12]=u;a[13]=t;a[14]=i;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=
a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};i.determinant=function(a){var b=a[0],d=a[1],j=a[2],u=a[3],c=a[4],t=a[5],i=a[6],e=a[7],f=a[8],g=a[9],n=a[10],m=a[11],s=a[12],p=a[13],h=a[14],a=a[15];return s*g*i*u-f*p*i*u-s*t*n*u+c*p*n*u+f*t*h*u-c*g*h*u-s*g*j*e+f*p*j*e+s*d*n*e-b*p*n*e-f*d*h*e+b*g*h*e+s*t*j*m-c*p*j*m-s*d*i*m+b*p*i*m+c*d*h*m-b*t*h*m-f*t*j*a+c*g*j*a+f*d*i*a-b*g*i*a-c*d*n*a+b*t*n*a};i.inverse=function(a,b){b||(b=a);var d=
a[0],j=a[1],u=a[2],c=a[3],t=a[4],i=a[5],e=a[6],f=a[7],g=a[8],n=a[9],m=a[10],s=a[11],p=a[12],h=a[13],q=a[14],l=a[15],r=d*i-j*t,v=d*e-u*t,A=d*f-c*t,k=j*e-u*i,z=j*f-c*i,o=u*f-c*e,y=g*h-n*p,w=g*q-m*p,x=g*l-s*p,J=n*q-m*h,K=n*l-s*h,Q=m*l-s*q,D=r*Q-v*K+A*J+k*x-z*w+o*y;if(!D)return null;D=1/D;b[0]=(i*Q-e*K+f*J)*D;b[1]=(-j*Q+u*K-c*J)*D;b[2]=(h*o-q*z+l*k)*D;b[3]=(-n*o+m*z-s*k)*D;b[4]=(-t*Q+e*x-f*w)*D;b[5]=(d*Q-u*x+c*w)*D;b[6]=(-p*o+q*A-l*v)*D;b[7]=(g*o-m*A+s*v)*D;b[8]=(t*K-i*x+f*y)*D;b[9]=(-d*K+j*x-c*y)*D;
b[10]=(p*z-h*A+l*r)*D;b[11]=(-g*z+n*A-s*r)*D;b[12]=(-t*J+i*w-e*y)*D;b[13]=(d*J-j*w+u*y)*D;b[14]=(-p*k+h*v-q*r)*D;b[15]=(g*k-n*v+m*r)*D;return b};i.toRotationMat=function(a,b){b||(b=i.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};i.toMat3=function(a,b){b||(b=l.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};
i.toNormalMat3=function(a,b){var d=a[0],j=a[1],u=a[2],c=a[4],t=a[5],i=a[6],e=a[8],f=a[9],g=a[10],n=g*t-i*f,m=-g*c+i*e,s=f*c-t*e,p=d*n+j*m+u*s;if(!p)return null;p=1/p;b||(b=l.create());b[0]=n*p;b[3]=(-g*j+u*f)*p;b[6]=(i*j-u*t)*p;b[1]=m*p;b[4]=(g*d-u*e)*p;b[7]=(-i*d+u*c)*p;b[2]=s*p;b[5]=(-f*d+j*e)*p;b[8]=(t*d-j*c)*p;return b};i.toInverseMat3=function(a,b){var d=a[0],j=a[1],u=a[2],c=a[4],t=a[5],i=a[6],e=a[8],f=a[9],g=a[10],n=g*t-i*f,m=-g*c+i*e,s=f*c-t*e,p=d*n+j*m+u*s;if(!p)return null;p=1/p;b||(b=l.create());
b[0]=n*p;b[1]=(-g*j+u*f)*p;b[2]=(i*j-u*t)*p;b[3]=m*p;b[4]=(g*d-u*e)*p;b[5]=(-i*d+u*c)*p;b[6]=s*p;b[7]=(-f*d+j*e)*p;b[8]=(t*d-j*c)*p;return b};i.multiply=function(a,b,d){d||(d=a);var j=a[0],u=a[1],c=a[2],t=a[3],i=a[4],e=a[5],f=a[6],g=a[7],n=a[8],m=a[9],p=a[10],s=a[11],h=a[12],q=a[13],l=a[14],a=a[15],r=b[0],v=b[1],A=b[2],k=b[3],z=b[4],o=b[5],y=b[6],w=b[7],x=b[8],J=b[9],K=b[10],Q=b[11],D=b[12],Z=b[13],V=b[14],b=b[15];d[0]=r*j+v*i+A*n+k*h;d[1]=r*u+v*e+A*m+k*q;d[2]=r*c+v*f+A*p+k*l;d[3]=r*t+v*g+A*s+k*a;
d[4]=z*j+o*i+y*n+w*h;d[5]=z*u+o*e+y*m+w*q;d[6]=z*c+o*f+y*p+w*l;d[7]=z*t+o*g+y*s+w*a;d[8]=x*j+J*i+K*n+Q*h;d[9]=x*u+J*e+K*m+Q*q;d[10]=x*c+J*f+K*p+Q*l;d[11]=x*t+J*g+K*s+Q*a;d[12]=D*j+Z*i+V*n+b*h;d[13]=D*u+Z*e+V*m+b*q;d[14]=D*c+Z*f+V*p+b*l;d[15]=D*t+Z*g+V*s+b*a;return d};i.multiplyVec3=function(a,b,d){d||(d=b);var j=b[0],u=b[1],b=b[2];d[0]=a[0]*j+a[4]*u+a[8]*b+a[12];d[1]=a[1]*j+a[5]*u+a[9]*b+a[13];d[2]=a[2]*j+a[6]*u+a[10]*b+a[14];return d};i.multiplyVec3Vector=function(a,b,d){d||(d=b);var j=b[0],u=b[1],
b=b[2];d[0]=a[0]*j+a[4]*u+a[8]*b;d[1]=a[1]*j+a[5]*u+a[9]*b;d[2]=a[2]*j+a[6]*u+a[10]*b;d[3]=a[3]*j+a[7]*u+a[11]*b;return d};i.multiplyVec4=function(a,b,d){d||(d=b);var j=b[0],u=b[1],c=b[2],b=b[3];d[0]=a[0]*j+a[4]*u+a[8]*c+a[12]*b;d[1]=a[1]*j+a[5]*u+a[9]*c+a[13]*b;d[2]=a[2]*j+a[6]*u+a[10]*c+a[14]*b;d[3]=a[3]*j+a[7]*u+a[11]*c+a[15]*b;return d};i.translate=function(a,b,d){var j=b[0],c=b[1],b=b[2],i,t,e,f,g,n,m,p,s,h,q,l;if(!d||a===d)return a[12]=a[0]*j+a[4]*c+a[8]*b+a[12],a[13]=a[1]*j+a[5]*c+a[9]*b+a[13],
a[14]=a[2]*j+a[6]*c+a[10]*b+a[14],a[15]=a[3]*j+a[7]*c+a[11]*b+a[15],a;i=a[0];t=a[1];e=a[2];f=a[3];g=a[4];n=a[5];m=a[6];p=a[7];s=a[8];h=a[9];q=a[10];l=a[11];d[0]=i;d[1]=t;d[2]=e;d[3]=f;d[4]=g;d[5]=n;d[6]=m;d[7]=p;d[8]=s;d[9]=h;d[10]=q;d[11]=l;d[12]=i*j+g*c+s*b+a[12];d[13]=t*j+n*c+h*b+a[13];d[14]=e*j+m*c+q*b+a[14];d[15]=f*j+p*c+l*b+a[15];return d};i.scale=function(a,b,d){var j=b[0],c=b[1],b=b[2];if(!d||a===d)return a[0]*=j,a[1]*=j,a[2]*=j,a[3]*=j,a[4]*=c,a[5]*=c,a[6]*=c,a[7]*=c,a[8]*=b,a[9]*=b,a[10]*=
b,a[11]*=b,a;d[0]=a[0]*j;d[1]=a[1]*j;d[2]=a[2]*j;d[3]=a[3]*j;d[4]=a[4]*c;d[5]=a[5]*c;d[6]=a[6]*c;d[7]=a[7]*c;d[8]=a[8]*b;d[9]=a[9]*b;d[10]=a[10]*b;d[11]=a[11]*b;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};i.rotate=function(a,b,d,j){var c=d[0],i=d[1],d=d[2],t,e,f,g,n,p,s,h,l,r,v,k,z,o,y,w,x,L,U,X,M;g=m(c*c+i*i+d*d);if(!g)return null;1!==g&&(g=1/g,c*=g,i*=g,d*=g);t=q(b);e=A(b);f=1-e;b=a[0];g=a[1];n=a[2];p=a[3];s=a[4];h=a[5];l=a[6];r=a[7];v=a[8];k=a[9];z=a[10];o=a[11];y=c*c*f+e;w=i*c*f+
d*t;x=d*c*f-i*t;L=c*i*f-d*t;U=i*i*f+e;X=d*i*f+c*t;M=c*d*f+i*t;c=i*d*f-c*t;i=d*d*f+e;j?a!==j&&(j[12]=a[12],j[13]=a[13],j[14]=a[14],j[15]=a[15]):j=a;j[0]=b*y+s*w+v*x;j[1]=g*y+h*w+k*x;j[2]=n*y+l*w+z*x;j[3]=p*y+r*w+o*x;j[4]=b*L+s*U+v*X;j[5]=g*L+h*U+k*X;j[6]=n*L+l*U+z*X;j[7]=p*L+r*U+o*X;j[8]=b*M+s*c+v*i;j[9]=g*M+h*c+k*i;j[10]=n*M+l*c+z*i;j[11]=p*M+r*c+o*i;return j};i.rotateX=function(a,b,d){var j=q(b),b=A(b),c=a[4],i=a[5],t=a[6],e=a[7],f=a[8],g=a[9],n=a[10],m=a[11];d?a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],
d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[4]=c*b+f*j;d[5]=i*b+g*j;d[6]=t*b+n*j;d[7]=e*b+m*j;d[8]=c*-j+f*b;d[9]=i*-j+g*b;d[10]=t*-j+n*b;d[11]=e*-j+m*b;return d};i.rotateY=function(a,b,d){var j=q(b),b=A(b),c=a[0],i=a[1],t=a[2],e=a[3],f=a[8],g=a[9],n=a[10],m=a[11];d?a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=c*b+f*-j;d[1]=i*b+g*-j;d[2]=t*b+n*-j;d[3]=e*b+m*-j;d[8]=c*j+f*b;d[9]=i*j+g*b;d[10]=t*j+n*b;d[11]=e*j+m*b;return d};
i.rotateZ=function(a,b,d){var j=q(b),b=A(b),c=a[0],i=a[1],t=a[2],e=a[3],f=a[4],g=a[5],n=a[6],m=a[7];d?a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=c*b+f*j;d[1]=i*b+g*j;d[2]=t*b+n*j;d[3]=e*b+m*j;d[4]=c*-j+f*b;d[5]=i*-j+g*b;d[6]=t*-j+n*b;d[7]=e*-j+m*b;return d};i.frustum=function(a,b,d,j,c,e,t){t||(t=i.create());var f=b-a,g=j-d,n=e-c;t[0]=2*c/f;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=2*c/g;t[6]=0;t[7]=0;t[8]=(b+a)/f;t[9]=(j+d)/g;t[10]=-(e+c)/
n;t[11]=-1;t[12]=0;t[13]=0;t[14]=-(2*e*c)/n;t[15]=0;return t};i.perspective=function(a,b,d,j,c){a=d*v(a*r/360);b*=a;return i.frustum(-b,b,-a,a,d,j,c)};i.ortho=function(a,b,d,j,c,e,t){t||(t=i.create());var f=b-a,g=j-d,n=e-c;t[0]=2/f;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=2/g;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=-2/n;t[11]=0;t[12]=-(a+b)/f;t[13]=-(j+d)/g;t[14]=-(e+c)/n;t[15]=1;return t};i.lookAt=function(a,b,d,j){j||(j=i.create());var c=a[0],e=a[1],a=a[2],f=d[0],g=d[1],n=d[2],d=b[1],p=b[2];if(c==b[0]&&e==d&&
a==p)return i.identity(j);var s,h,q,l,d=c-b[0],p=e-b[1],b=a-b[2];l=1/m(d*d+p*p+b*b);d*=l;p*=l;b*=l;s=g*b-n*p;n=n*d-f*b;f=f*p-g*d;(l=m(s*s+n*n+f*f))?(l=1/l,s*=l,n*=l,f*=l):f=n=s=0;g=p*f-b*n;h=b*s-d*f;q=d*n-p*s;(l=m(g*g+h*h+q*q))?(l=1/l,g*=l,h*=l,q*=l):q=h=g=0;j[0]=s;j[1]=g;j[2]=d;j[3]=0;j[4]=n;j[5]=h;j[6]=p;j[7]=0;j[8]=f;j[9]=q;j[10]=b;j[11]=0;j[12]=-(s*c+n*e+f*a);j[13]=-(g*c+h*e+q*a);j[14]=-(d*c+p*e+b*a);j[15]=1;return j};i.decompose=function(){var a=i.create();return function(b,d,j,f){var e=[b[0],
b[1],b[2]],g=[b[4],b[5],b[6]],n=[b[8],b[9],b[10]];d||(d=h.create());j||(j=c.create());f||(f=h.create());d[0]=b[12];d[1]=b[13];d[2]=b[14];f[0]=e=h.length(e);f[1]=g=h.length(g);f[2]=n=h.length(n);i.set(b,a);a[0]/=e;a[1]/=e;a[2]/=e;a[4]/=g;a[5]/=g;a[6]/=g;a[8]/=n;a[9]/=n;a[10]/=n;c.setFromRotationMatrix(a,j);return[d,j,f]}}();i.fromRotationTranslation=function(a,b,d){d||(d=i.create());var j=a[0],c=a[1],f=a[2],e=a[3],g=j+j,n=c+c,m=f+f,a=j*g,p=j*n,j=j*m,s=c*n,c=c*m,f=f*m,g=e*g,n=e*n,e=e*m;d[0]=1-(s+f);
d[1]=p+e;d[2]=j-n;d[3]=0;d[4]=p-e;d[5]=1-(a+f);d[6]=c+g;d[7]=0;d[8]=j+n;d[9]=c-g;d[10]=1-(a+s);d[11]=0;d[12]=b[0];d[13]=b[1];d[14]=b[2];d[15]=1;return d};i.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};i.strPretty=function(a){return"["+a[0]+", "+a[4]+", "+a[8]+", "+a[12]+"\n, "+a[1]+", "+a[5]+", "+a[9]+", "+a[13]+"\n, "+a[2]+", "+a[6]+", "+a[10]+", "+a[14]+
"\n, "+a[3]+", "+a[7]+", "+a[11]+", "+a[15]+"]"};g.quat4=c;c.create=x.create;c.set=x.set;c.calculateW=function(a,b){var d=a[0],c=a[1],f=a[2],e=-m(n(1-d*d-c*c-f*f));if(!b||a==b)return a[3]=e,a;b[0]=d;b[1]=c;b[2]=f;b[3]=e;return b};c.inverse=function(a,b){var d=1/c.dot(a,a);if(!b||a==b)return a[0]*=-d,a[1]*=-d,a[2]*=-d,a[3]*=d,a;b[0]=-a[0]*d;b[1]=-a[1]*d;b[2]=-a[2]*d;b[3]=a[3]*d;return b};c.conjugate=function(a,b){if(!b||a==b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=
a[3];return b};c.length=x.length;c.dot=x.dot;c.normalize=function(a,b){b||(b=a);var d=a[0],c=a[1],f=a[2],e=a[3],i=Math.sqrt(d*d+c*c+f*f+e*e);if(0===i)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;i=1/i;b[0]=d*i;b[1]=c*i;b[2]=f*i;b[3]=e*i;return b};c.multiply=function(a,b,d){d||(d=a);var c=a[0],f=a[1],e=a[2],a=a[3],i=b[0],g=b[1],n=b[2],b=b[3];d[0]=c*b+a*i+f*n-e*g;d[1]=f*b+a*g+e*i-c*n;d[2]=e*b+a*n+c*g-f*i;d[3]=a*b-c*i-f*g-e*n;return d};c.multiplyVec3=function(a,b,d){d||(d=b);var c=b[0],f=b[1],e=b[2],b=a[0],
i=a[1],g=a[2],a=a[3],n=a*c+i*e-g*f,m=a*f+g*c-b*e,p=a*e+b*f-i*c,c=-b*c-i*f-g*e;d[0]=n*a+c*-b+m*-g-p*-i;d[1]=m*a+c*-i+p*-b-n*-g;d[2]=p*a+c*-g+n*-i-m*-b;return d};c.identity=function(a){a||(a=c.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.toEuler=function(a,b){var d=a[0],c=a[1],f=a[2],e=a[3],i=c*c;b||(b=h.create());b[0]=57.2957795130824*w(2*(e*d+c*f),1-2*(d*d+i));b[1]=57.2957795130824*s(2*(e*c-f*d));b[2]=57.2957795130824*w(2*(e*f+d*c),1-2*(i+f*f));return b};c.angleAxis=function(a,b,d){var a=0.00872664625997*
a,j=q(a);d||(d=c.create());d[3]=A(a);d[2]=b[2]*j;d[1]=b[1]*j;d[0]=b[0]*j;return d};c.lookAt=function(a,b,d,c,f){var e=h.create(),i=h.create(),g=h.create();h.subtract(a,b,g);h.normalize(g);h.cross(d,g,i);h.normalize(i);h.cross(g,i,e);h.normalize(e);f||(f=l.create());f[0]=i[0];f[1]=i[1];f[2]=i[2];f[3]=e[0];f[4]=e[1];f[5]=e[2];f[6]=g[0];f[7]=g[1];f[8]=g[2];return l.toQuat(f,c)};c.setEuler=function(a,b){var d=0.00872664625997*a[0],j=0.00872664625997*a[1],f=0.00872664625997*a[2],e=A(d),i=A(j),g=A(f),d=
q(d),j=q(j),f=q(f);b||(b=c.create());b[3]=e*i*g+d*j*f;b[0]=d*i*g-e*j*f;b[1]=e*j*g+d*i*f;b[2]=e*i*f-d*j*g;return b};c.setFromRotationMatrix=function(a,b){var d,j,f,e;f=a[0];var g=a[4],n=a[8],m=a[1],p=a[5],s=a[9],h=a[2],q=a[6],l=a[10],r=Math.pow(i.determinant(a),1/3);e=Math.sqrt(Math.max(0,r+f+p+l))/2;d=Math.sqrt(Math.max(0,r+f-p-l))/2;j=Math.sqrt(Math.max(0,r-f+p-l))/2;f=Math.sqrt(Math.max(0,r-f-p+l))/2;d=0>q-s?-Math.abs(d):Math.abs(d);j=0>n-h?-Math.abs(j):Math.abs(j);f=0>m-g?-Math.abs(f):Math.abs(f);
d=[d,j,f,e];b?c.set(d,b):b=c.create(d);c.normalize(b);return b};c.toMat3=function(a,b){b||(b=l.create());var d=a[0],c=a[1],f=a[2],e=a[3],i=d+d,g=c+c,n=f+f,m=d*i,p=d*g,d=d*n,s=c*g,c=c*n,f=f*n,i=e*i,g=e*g,e=e*n;b[0]=1-(s+f);b[1]=p+e;b[2]=d-g;b[3]=p-e;b[4]=1-(m+f);b[5]=c+i;b[6]=d+g;b[7]=c-i;b[8]=1-(m+s);return b};c.toMat4=function(a,b){b||(b=i.create());var d=a[0],c=a[1],f=a[2],e=a[3],g=d+d,n=c+c,m=f+f,p=d*g,s=d*n,d=d*m,h=c*n,c=c*m,f=f*m,g=e*g,n=e*n,e=e*m;b[0]=1-(h+f);b[1]=s+e;b[2]=d-n;b[3]=0;b[4]=s-
e;b[5]=1-(p+f);b[6]=c+g;b[7]=0;b[8]=d+n;b[9]=c-g;b[10]=1-(p+h);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};c.slerp=function(a,b,d,c){c||(c=a);var f=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];if(1<=n(f))return c!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]),c;var e=z(f),i=m(1-f*f);if(0.0010>n(i))return c[0]=0.5*a[0]+0.5*b[0],c[1]=0.5*a[1]+0.5*b[1],c[2]=0.5*a[2]+0.5*b[2],c[3]=0.5*a[3]+0.5*b[3],c;f=q((1-d)*e)/i;d=q(d*e)/i;c[0]=a[0]*f+b[0]*d;c[1]=a[1]*f+b[1]*d;c[2]=a[2]*f+b[2]*d;c[3]=a[3]*f+b[3]*d;
return c};c.difference=function(a,b,d){d||(d=a);var c=-a[0],f=-a[1],e=-a[2],a=a[3],i=b[0],g=b[1],n=b[2],b=b[3];d[0]=c*b+a*i+f*n-e*g;d[1]=f*b+a*g+e*i-c*n;d[2]=e*b+a*n+c*g-f*i;d[3]=a*b-c*i-f*g-e*n;return d};c.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};g.aabb=e;e.create=function(a,b){var d=new Float32Array(6);a?(d[0]=a[0],d[1]=a[1],d[2]=a[2],6==a.length?(d[3]=a[3],d[4]=a[4],d[5]=a[5]):b?(d[3]=b[0],d[4]=b[1],d[5]=b[2]):(d[3]=d[0],d[4]=d[1],d[5]=d[2])):(d[0]=Number.MAX_VALUE,d[1]=
Number.MAX_VALUE,d[2]=Number.MAX_VALUE,d[3]=Number.MIN_VALUE,d[4]=Number.MIN_VALUE,d[5]=Number.MIN_VALUE);return d};e.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b};e.merge=function(a,b,d){d||(d=new Float32Array(6));d[0]=f(a[0],b[0]);d[1]=f(a[1],b[1]);d[2]=f(a[2],b[2]);d[3]=p(a[3],b[3]);d[4]=p(a[4],b[4]);d[5]=p(a[5],b[5]);return d};e.addPoint=function(a,b){a[0]=f(a[0],b[0]);a[1]=f(a[1],b[1]);a[2]=f(a[2],b[2]);a[3]=p(a[3],b[0]);a[4]=p(a[4],b[1]);a[5]=p(a[5],
b[2]);return a};e.center=function(a,b){b||(b=h.create());b[0]=a[3]-a[0];b[1]=a[4]-a[1];b[2]=a[5]-a[2];return b}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.core"),k=KICK.namespace("KICK.scene"),h=new ArrayBuffer(4),x=new Uint32Array(h),l=new Uint8Array(h);g.Engine=function(i,c){var e=null,f="string"===typeof i?document.getElementById(i):i,p=["experimental-webgl","webgl"],m=this,h=(new Date).getTime()-16,l=0,q=new g.Time,s=0,n=0,v=1,o=[],w=[],r,y=new g.Project(this),a=null,b=null,d,j={},u=function(a){m._gameLoop(a)},F=KICK.math.vec2;Object.defineProperties(this,{version:{value:"0.3.0"},resourceManager:{value:new g.ResourceManager(this)},
project:{value:y},gl:{get:function(){return e}},canvas:{value:f},activeScene:{get:function(){return d},set:function(a){d=null===a?new KICK.scene.Scene(engine):a}},mouseInput:{get:function(){a||(a=new g.MouseInput(m),this.addFrameListener(a));return a}},keyInput:{get:function(){b||(b=new g.KeyInput,this.addFrameListener(b));return b}},eventQueue:{get:function(){return r}},time:{value:q},config:{value:new g.Config(c||{})},paused:{get:function(){return null===j},set:function(a){a!=m.paused&&(a?(cancelRequestAnimFrame(j),
j=null):(h=(new Date).getTime()-16,j=requestAnimationFrame(u,this.canvas)))}}});this.isFullScreenSupported=function(){return f.requestFullscreen||f.webkitRequestFullScreen||f.mozRequestFullScreen};this.setFullscreen=function(a){if(this.isFullScreenSupported())a?f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullScreen?(f.onwebkitfullscreenchange=function(){document.webkitIsFullScreen?(f.originalWidth=f.width,f.originalHeight=f.height,f.width=screen.width,f.height=screen.height):(f.width=
f.originalWidth,f.height=f.originalHeight);m.canvasResized()},f.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)):f.mozRequestFullScreen&&f.mozRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};this._gameLoop=function(a){l=a-h;h=a;l*=v;s+=l;n+=1;r.run();this.activeScene.updateAndRender();for(a=w.length-1;0<=a;a--)w[a].frameUpdated();null!==j&&
(j=requestAnimationFrame(u,this.canvas))};this.addFrameListener=function(a){w.push(a)};this.removeFrameListener=function(a){return g.Util.removeElementFromArray(w,a)};this.addContextListener=function(a){o.push(a)};this.removeContextListener=function(a){return g.Util.removeElementFromArray(o,a)};this.createUID=function(){return++y.maxUID};this.getUID=function(a){if(!a.uid)a.uid=m.createUID();return a.uid};this.canvasResized=function(){e.viewportSize=F.create([f.width,f.height]);a&&a.updateCanvasElementPosition()};
(function(){var a,b,c=function(){for(a=p.length-1;0<=a;a--)try{if(e=f.getContext(p[a],m.config))break}catch(b){alert(b)}if(!e)return!1;m.config.enableDebugContext&&(window.WebGLDebugUtils?e=WebGLDebugUtils.makeDebugContext(e):console.log("webgl-debug.js not included - cannot find WebGLDebugUtils"));e.enable(2929);e.enable(3089);return!0};c()?(f.addEventListener("webglcontextlost",function(d){b=m.paused;m.pause();for(a=0;a<o.length;a++)o[a].contextLost();d.preventDefault()},!1),f.addEventListener("webglcontextrestored",
function(d){c();for(a=0;a<o.length;a++)o[a].contextRestored(e);b||m.resume();d.preventDefault()},!1),m.canvasResized(),m.config.checkCanvasResizeInterval&&setInterval(function(){(f.height!==e.viewportSize[0]||f.width!==e.viewportSize[1])&&m.canvasResized()},m.config.checkCanvasResizeInterval),Object.defineProperties(q,{time:{get:function(){return s}},deltaTime:{get:function(){return l}},frame:{get:function(){return n}},scale:{get:function(){return v},set:function(a){v=a}}}),Object.freeze(q),d=new k.Scene(m),
r=new g.EventQueue(m),n=s=0,m._gameLoop(h)):m.config.webglNotFoundFn(f)})()};g.EventQueue=function(i){var c=[],e=function(c,f){return c.timeStart-f.timeStart},f=i.time;this.add=function(i,m,h){var l=f.time+1,i={task:i,timeStart:m+l,timeEnd:(h||m)+l};g.Util.insertSorted(i,c,e);return i};this.cancel=function(f){g.Util.removeElementFromArray(c,f)};this.run=function(){for(var e=0,i=f.time,g=c.length,h;e<g&&(h=c[e]).timeStart<i;e++)h.task(),h.timeEnd<i&&(c.splice(e,1),g--)};this.clear=function(){c=[]}};
g.Project=function(i){var c={},e={},f=this,p=0,m=function(f,i){if(c[f]instanceof g.ResourceDescriptor){var m=e[f];m&&c[f].updateConfig(m,i)}},h=function(c){var f=c.split("/");2<f.length?(f=f[f.length-2],f=f.substring(0,1).toUpperCase()+f.substring(1)):f=c;return f},l=function(c){var f=g.Project,m;if(c<=f.ENGINE_SHADER_DEFAULT&&c>=f.ENGINE_SHADER_ERROR){switch(c){case f.ENGINE_SHADER_DEFAULT:f="kickjs://shader/default/";break;case f.ENGINE_SHADER_PHONG:f="kickjs://shader/phong/";break;case f.ENGINE_SHADER_UNLIT:f=
"kickjs://shader/unlit/";break;case f.ENGINE_SHADER_TRANSPARENT_PHONG:f="kickjs://shader/transparent_phong/";break;case f.ENGINE_SHADER_TRANSPARENT_UNLIT:f="kickjs://shader/transparent_unlit/";break;case f.ENGINE_SHADER_SHADOWMAP:f="kickjs://shader/__shadowmap/";break;case f.ENGINE_SHADER_PICK:f="kickjs://shader/__pick/";break;case f.ENGINE_SHADER_ERROR:f="kickjs://shader/__error/";break;default:return null}m=new KICK.material.Shader(i,{dataURI:f,name:h(f),uid:c})}else if(c<=f.ENGINE_TEXTURE_BLACK&&
c>=f.ENGINE_TEXTURE_GRAY){switch(c){case f.ENGINE_TEXTURE_BLACK:f="kickjs://texture/black/";break;case f.ENGINE_TEXTURE_WHITE:f="kickjs://texture/white/";break;case f.ENGINE_TEXTURE_GRAY:f="kickjs://texture/gray/";break;default:return null}m=new KICK.texture.Texture(i,{dataURI:f,name:h(f),minFilter:9728,magFilter:9728,generateMipmaps:!1,uid:c})}else if(c<=f.ENGINE_MESH_TRIANGLE&&c>=f.ENGINE_MESH_CUBE){switch(c){case f.ENGINE_MESH_TRIANGLE:f="kickjs://mesh/triangle/";break;case f.ENGINE_MESH_PLANE:f=
"kickjs://mesh/plane/";break;case f.ENGINE_MESH_UVSPHERE:f="kickjs://mesh/uvsphere/?slides=20&stacks=10&radius=1.0";break;case f.ENGINE_MESH_CUBE:f="kickjs://mesh/cube/?length=1.0";break;default:return null}m=new KICK.mesh.Mesh(i,{dataURI:f,name:h(f),uid:c})}return e[c]=m},q;for(q in g.Project)g.Project.hasOwnProperty(q)&&(f[q]=g.Project[q]);Object.defineProperties(this,{maxUID:{get:function(){return p},set:function(c){p=c}},resourceDescriptorUIDs:{get:function(){var f=[],e;for(e in c)f.push(e);return f}}});
this.newProject=function(){f.loadProject({maxUID:0,resourceDescriptors:[]})};this.loadProject=function(c){0<p&&f.closeProject();var c=c||{},e=c.resourceDescriptors||[];p=c.maxUID||0;for(var g=0;g<e.length;g++)f.addResourceDescriptor(e[g]);i.activeScene=c.activeScene?this.load(c.activeScene):KICK.scene.Scene.createDefault(i)};this.closeProject=function(){for(var i in c)f.removeResourceDescriptor(i);c={};e={}};this.load=function(f){var g=e[f];if(g)return g;return(g=c[f])?(g=g.instantiate(i),e[f]=g):
l(f)};this.loadByName=function(e,i){for(var g in c){var m=c[g];if(m.name===e&&(!i||m.type===i))return f.load(m.uid)}return null};this.registerObject=function(f,m){var p=i.getUID(f);e[p]||(e[p]=f,c[p]||(c[p]=new g.ResourceDescriptor({uid:p,type:m,config:{name:f.name}})))};this.refreshResourceDescriptors=function(f){var f=f||function(){return!0},e;for(e in c)m(e,f)};this.getResourceDescriptorByType=function(f){var e=[],i;for(i in c)c[i].type===f&&e.push(c[i]);return e};this.getResourceDescriptor=function(f){m(f);
return c[f]};this.addResourceDescriptor=function(f){f instanceof g.ResourceDescriptor||(f=new g.ResourceDescriptor(f));return c[f.uid]=f};this.removeResourceDescriptor=function(f){var i=e[f];i&&i.detroy&&i.destroy();delete e[f];delete c[f]};this.toJSON=function(e){var m=[],e=e||function(){return!0};f.refreshResourceDescriptors(e);for(var h in c)if(0<=h){var l=c[h];l instanceof g.ResourceDescriptor&&e(l)&&m.push(l.toJSON(e))}return{engineVersion:i.version,maxUID:p,activeScene:i.activeScene.uid,resourceDescriptors:m}}};
g.Project.ENGINE_SHADER_DEFAULT=-100;g.Project.ENGINE_SHADER_PHONG=-101;g.Project.ENGINE_SHADER_UNLIT=-102;g.Project.ENGINE_SHADER_TRANSPARENT_PHONG=-103;g.Project.ENGINE_SHADER_TRANSPARENT_UNLIT=-104;g.Project.ENGINE_SHADER_SHADOWMAP=-105;g.Project.ENGINE_SHADER_PICK=-106;g.Project.ENGINE_SHADER_ERROR=-107;g.Project.ENGINE_TEXTURE_BLACK=-200;g.Project.ENGINE_TEXTURE_WHITE=-201;g.Project.ENGINE_TEXTURE_GRAY=-202;g.Project.ENGINE_MESH_TRIANGLE=-300;g.Project.ENGINE_MESH_PLANE=-301;g.Project.ENGINE_MESH_UVSPHERE=
-302;g.Project.ENGINE_MESH_CUBE=-303;g.ResourceDescriptor=function(i){var i=i||{},c=i.type,e=i.uid,f=i.config,p=g.Util.hasProperty;Object.defineProperties(this,{name:{get:function(){return f.name},set:function(c){f.name=c}},type:{value:c},config:{get:function(){return f}},uid:{value:e}});this.updateConfig=function(c,e){f=c.toJSON(e)};this.instantiate=function(i){var g=KICK.namespace(c),h=f,l={},s;for(s in h)if(p(h,s)){var n=h[s],k=n?n.reftype:null,o=n?n.ref:null;n&&o&&k&&("resource"===k?n=i.resourceManager[n.refMethod](o):
"project"===k&&(n=i.project.load(o)));l[s]=n}l.uid=e;i=new g(i,l);"function"===typeof i.init&&i.init();return i};this.toJSON=function(){return{type:c,uid:e,config:f}}};g.Config=function(i){this.shadows=i.shadows||!1;this.maxNumerOfLights=i.maxNumerOfLights?i.maxNumerOfLights:1;this.enableDebugContext="boolean"===typeof i.enableDebugContext?i.enableDebugContext:!1;this.preserveDrawingBuffer=i.preserveDrawingBuffer||!1;this.alpha="boolean"===typeof i.alpha?i.alpha:!0;this.depth="boolean"===typeof i.depth?
i.depth:!0;this.stencil="boolean"===typeof i.stencil?i.stencil:!1;this.antialias="boolean"===typeof i.antialias?i.antialias:!0;this.premultipliedAlpha="boolean"===typeof i.premultipliedAlpha?i.premultipliedAlpha:!0;this.checkCanvasResizeInterval=i.checkCanvasResizeInterval||0;this.webglNotFoundFn=i.webglNotFoundFn?"string"===typeof i.webglNotFoundFn?KICK.namespace(i.webglNotFoundFn):i.webglNotFoundFn:function(c){c.innerHTML="";var e=document.createElement("div");e.style.cssText=c.style.cssText+";width:"+
c.width+"px;height:"+c.height+"px;display: table-cell;vertical-align: middle;background:#ffeeee;";e.innerHTML="<div style='padding:12px;text-align: center;'><img src='http://www.khronos.org/assets/images/api_logos/webgl.png' style='width:74px;35px;margin-bottom: 10px;margin-left: auto;'><br clear='all'>It doesn't appear your computer can support WebGL.<br><br><a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a></div>";c.parentNode.replaceChild(e,c)}};g.Time=function(){};
g.MouseInput=function(i){var c=KICK.math.vec2,e=[],f=[],p=[],m=c.create(),h=c.create(),l=null,q=c.create(),s=c.create(),n=!1,k=i.canvas,o=g.Util.removeElementFromArray,w=g.Util.contains,r=!0,y=document.body,a=-1!==navigator.userAgent.indexOf("Firefox"),b=-1!==navigator.userAgent.indexOf("Chrome"),d=function(a){a.preventDefault();return!1},j=function(a){m[0]=a.clientX-q[0]+y.scrollLeft;m[1]=a.clientY-q[1]+y.scrollTop;l?c.subtract(m,h,l):l=c.create();c.set(m,h)},u=function(a){b?(s[0]+=a.wheelDeltaX,
s[1]+=a.wheelDeltaY):1===a.axis?s[0]-=a.detail:s[1]-=a.detail;if(n)return a.preventDefault(),!1},F=function(a){a=a.button;w(e,a)||(p.push(a),e.push(a));r||j()},t=function(a){a=a.button;f.push(a);o(e,a);r||j()},x=function(){for(var a=k,b=0,d=0;a.offsetParent;)b+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;b+=a.offsetLeft;d+=a.offsetTop;q[0]=b;q[1]=d};Object.defineProperties(this,{mousePosition:{get:function(){return m}},deltaMovement:{get:function(){return l||c.create()}},deltaWheel:{get:function(){return s}},
mouseWheelPreventDefaultAction:{get:function(){return n},set:function(a){n=a}},mouseMovementEventsEnabled:{get:function(){return r},set:function(a){r!==a&&((r=a)?k.addEventListener("mousemove",j,!1):(k.removeEventListener("mousemove",j,!1),l=null))}}});this.isButtonDown=function(a){return w(p,a)};this.isButtonUp=function(a){return w(f,a)};this.isButton=function(a){return w(e,a)};this.frameUpdated=function(){p.length=0;f.length=0;s[0]=0;s[1]=0;l&&(l[0]=0,l[1]=0)};this.updateCanvasElementPosition=x;
(function(){x();var c=i.canvas;c.addEventListener("mousedown",F,!0);c.addEventListener("mouseup",t,!0);c.addEventListener("mousemove",j,!0);c.addEventListener("contextmenu",d,!0);a?c.addEventListener("MozMousePixelScroll",u,!0):b?c.addEventListener("mousewheel",u,!0):c.addEventListener("DOMMouseScroll",u,!0)})()};g.KeyInput=function(){var i=[],c=[],e=[],f=g.Util.removeElementFromArray,p=g.Util.contains;this.isKeyDown=function(c){return p(i,c)};this.isKeyUp=function(f){return p(c,f)};this.isKey=function(c){return p(e,
c)};this.frameUpdated=function(){i.length=0;c.length=0};document.addEventListener("keydown",function(c){c=c.keyCode;p(e,c)||(i.push(c),e.push(c))},!1);document.addEventListener("keyup",function(i){i=i.keyCode;c.push(i);f(e,i)},!1)};g.Util={hasProperty:function(i,c){return Object.prototype.hasOwnProperty.call(i,c)},getJSONReference:function(i,c){if(null==c)return null;var e=c instanceof KICK.scene.GameObject;return!e&&c.gameObject instanceof KICK.scene.GameObject||e?{ref:i.getUID(c),name:"string"===
typeof c.name?c.name:"",reftype:e?"gameobject":"component"}:{ref:c.uid,name:c.name,reftype:"project"}},componentToJSON:function(i,c,e){var f,p={},m={},e={type:e||c.constructor.name,uid:i.getUID(c),config:p};""===e.type&&g.Util.fail("Cannot serialize object type. Either provide toJSON function or use explicit function name 'function SomeObject(){}' ");var h=function(c){if(Array.isArray(c)){for(var f=[],e=0;e<c.length;e++){var p=h(c[e]);f.push(p)}return f}f=typeof c;return"function"!==f?c&&c.buffer instanceof
ArrayBuffer?g.Util.typedArrayToArray(c):"object"===f?g.Util.getJSONReference(i,c):c:m};for(f in c)if(g.Util.hasProperty(c,f)&&"gameObject"!==f){var l=h(c[f]);l!==m&&(p[f]=l)}return e},applyConfig:function(i,c,e){var f=g.Util.contains,p=g.Util.hasProperty,c=c||{},e=e||[],m;for(m in c)"function"!==typeof c[m]&&!f(e,m)&&p(i,m)&&(i[m]=c[m]);if(c.uid&&c.uid!==i.uid)i.uid=c.uid},getParameter:function(i,c){var e=RegExp("[\\?&]"+c+"=([^&#]*)").exec(i);return null==e?null:e[1]},getParameterInt:function(i,
c,e){i=g.Util.getParameter(i,c);return null===i?e:parseInt(i)},getParameterFloat:function(i,c,e){i=g.Util.getParameter(i,c);return null===i?e:parseFloat(i)},scaleImage:function(i,c,e){var f=document.createElement("canvas");f.width=c;f.height=e;f.getContext("2d").drawImage(i,0,0,i.width,i.height,0,0,f.width,f.height);return f},warn:function(i){debugger;console.log(i)},fail:function(i){debugger;console.error(i)},typedArrayToArray:function(i){for(var c=i.length,e=Array(c),f=0;f<c;f++)e[f]=i[f];return e},
removeElementFromArray:function(i,c,e){for(var f=!1,g=i.length-1;0<=g&&!(i[g]===c&&(f=!0,i.splice(g,1),!e));g--);return f},removeElementsFromArray:function(i,c){var e,f;for(e=i.length-1;0<=e;e--)for(f=c.length-1;0<=f;f--)i[e]===c[f]&&i.splice(e,1)},insertSorted:function(i,c,e){var f;if(!e)e=this.numberSortFunction;for(f=c.length-1;0<=f;f--)if(0>e(c[f],i)){c.splice(f+1,0,i);return}c.unshift(i)},numberSortFunction:function(i,c){return i-c},contains:function(i,c){for(var e=i.length-1;0<=e;e--)if(i[e]===
c)return!0;return!1},uint32ToVec4:function(i,c){c||(c=new Float32Array(4));x[0]=i;for(var e=0;4>e;e++)c[e]=l[e]/255;return c},vec4ToUint32:function(i){for(var c=0;4>c;c++)l[c]=255*i[c];return x[0]},vec4uint8ToUint32:function(i){for(var c=0;4>c;c++)l[c]=i[c];return x[0]},utf8Encode:function(i){for(var c=[],e=0;e<i.length;e++){var f=i.charCodeAt(e);127>f?c.push(f):2047>=f?(c.push(192+(f>>6)),c.push(128+(f&63))):65535>=f&&(c.push(224+(f>>12)),c.push(128+(f>>6&63)),c.push(128+(f&63)))}return new Uint8Array(c)},
utf8Decode:function(i){for(var c="",e=0;e<i.length;e++){var f=i[e];if(0===(f&128))c+=String.fromCharCode(f);else if(192===(f&224)){e++;var g=i[e],f=(f&31)<<6,g=g&63,f=f+g,c=c+String.fromCharCode(f)}else if(224===(f&240)){e++;g=i[e];e++;var m=i[e],f=(f&31)<<12,g=(g&63)<<6,m=m&63,f=f+g+m,c=c+String.fromCharCode(f)}}return c}};Object.freeze(g.Util);if("undefined"===typeof window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){return window.setTimeout(i,16.7)}}(),window.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;if("undefined"===typeof window.console)window.console={};if("undefined"===typeof window.console.log)window.console.log=function(i){alert(i)}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.core"),k=g.Util.utf8Decode,h=g.Util.utf8Encode,x=new Uint8Array(4);g.ChunkData=function(){var g=function(c,e,i,g){var h=this;this.chunkId=c;this.chunkType=e;this.chunkDataLength=i;this.data=g;Object.defineProperties(this,{paddingSize:{get:function(){var c=h.data.length*h.data.BYTES_PER_ELEMENT%4;return c?4-c:0}},paddingData:{get:function(){return x.subarray(0,h.paddingSize)}}})},i=this,c=[],e=function(c){return 1===c?Float32Array:2===c?Float64Array:3===c?Int16Array:
4===c?Int32Array:5===c?Int8Array:6===c?Uint16Array:8===c?Uint8Array:null};this.getSize=function(){for(var f=0,e=0;e<c.length;e++)f+=c[e].chunkDataLength+8+c[e].paddingSize;return 8+f};this.serialize=function(){var f=new ArrayBuffer(i.getSize()),g=0,h=new Uint8Array(f,0),l=new Uint16Array(f,g);l[0]=61441;l[1]=1;g+=4;l=new Uint32Array(f,g);l[0]=c.length;for(var g=g+4,k=0;k<c.length;k++)l=new Uint16Array(f,g),l[0]=c[k].chunkId,l[1]=c[k].chunkType,g+=4,l=new Uint32Array(f,g),l[0]=c[k].chunkDataLength,
g+=4,l=new (e(c[k].chunkType))(f),l.set(c[k].data,g/l.BYTES_PER_ELEMENT),g+=c[k].chunkDataLength,h.set(c[k].paddingData,g),g+=c[k].paddingSize;return f};this.get=function(f){for(var e=0;e<c.length;e++)if(c[e].chunkId===f)return c[e].data;return null};this.getString=function(c){return(c=i.get(c))?k(c):null};this.getNumber=function(c){return(c=i.get(c))?c[0]:null};this.getArrayBuffer=function(c){if(c=i.get(c)){var e=new ArrayBuffer(c.length*c.BYTES_PER_ELEMENT);(new Uint8Array(e)).set(c);return e}return null};
this.remove=function(f){for(var e=0;e<c.length;e++)if(c[e].chunkId===f)return c=c.splice(e,1),!0;return!1};this.setString=function(c,e){var g=h(e);i.set(c,g)};this.setNumber=function(c,e){var g=new Float64Array([e]);i.set(c,g)};this.setArrayBuffer=function(c,e){i.set(c,new Uint8Array(e))};this.set=function(f,e){i.remove(f);var h;h=e instanceof Float32Array?1:e instanceof Float64Array?2:e instanceof Int16Array?3:e instanceof Int32Array?4:e instanceof Int8Array?5:e instanceof Uint16Array?6:e instanceof
Uint8Array?8:null;h&&c.push(new g(f,h,e.length*e.BYTES_PER_ELEMENT,e))};this.deserialize=function(f){if(!(f instanceof ArrayBuffer))return!1;var i=[],h=0,k=new Uint16Array(f,h);if(61441!==k[0]||1!==k[1])return!1;for(var h=h+4,z=new Uint32Array(f,h),q=z[0],h=h+4,s=0;s<q;s++){var k=new Uint16Array(f,h),n=k[0],k=k[1],h=h+4,z=new Uint32Array(f,h),z=z[0],h=h+4,v=e(k),v=new v(f,h,z/v.BYTES_PER_ELEMENT),n=new g(n,k,z,v);i.push(n);h+=z;h+=n.paddingSize}c=i;return!0}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.texture"),k=KICK.namespace("KICK.core"),h=KICK.math.vec2,x=function(g){--g;for(var c=1;32>c;c<<=1)g|=g>>c;return g+1},l=KICK.core.Util.applyConfig;g.RenderTexture=function(g,c){var e=g.gl,f=c||{},h=e.createFramebuffer(),l=f.colorTexture,k=c.dimension,z=[],q=this,s="",n=function(){for(var c=0;c<z.length;c++)e.deleteRenderbuffer(z[c])},v=function(){var c;k=l?l.dimension:k;n();e.bindFramebuffer(36160,h);l?e.framebufferTexture2D(36160,36064,3553,l.textureId,0):(c=
e.createRenderbuffer(),e.bindRenderbuffer(36161,c),e.renderbufferStorage(36161,32854,k[0],k[1]),e.framebufferRenderbuffer(36160,36064,36161,c),z.push(c));c=e.createRenderbuffer();e.bindRenderbuffer(36161,c);e.renderbufferStorage(36161,33189,k[0],k[1]);e.framebufferRenderbuffer(36160,36096,36161,c);z.push(c);e.bindFramebuffer(36160,null)};this.bind=function(){e.renderTarget=q;e.bindFramebuffer(36160,h)};Object.defineProperties(this,{dimension:{get:function(){return k}},colorTexture:{get:function(){return l},
set:function(c){l=c;v()}},name:{get:function(){return s},set:function(c){s=c}}});this.destroy=function(){null!==h&&(n(),e.deleteFramebuffer(h),h=null,g.project.removeResourceDescriptor(q.uid))};this.toJSON=function(){return{uid:q.uid,name:s,colorTexture:KICK.core.Util.getJSONReference(g,l)}};v();g.project.registerObject(q,"KICK.texture.RenderTexture")};g.Texture=function(g,c){var e=g.gl,f=e.createTexture(),p="Texture",m=10497,A=10497,z=9729,q=9729,s=!0,n="memory://void",v=!0,o=6408,w=3553,r=null,
y=this,a=h.create(),b=function(){null!==r&&r!==w&&(e.deleteTexture(f),f=e.createTexture());r=w};this.init=function(){n&&g.resourceManager.getImageData(n,y)};this.bind=function(a){e.activeTexture(33984+a);e.bindTexture(w,f)};this.destroy=function(){null!==f&&(e.deleteTexture(f),f=null,g.project.removeResourceDescriptor(y.uid))};this.setImage=function(d,c){var f,g;n=c;b();y.bind(0);if(3553===w){if(0!=(d.width&d.width-1)||0!=(d.height&d.height-1))f=x(d.width),g=x(d.height),d=k.Util.scaleImage(d,f,g);
v?e.pixelStorei(37440,!0):e.pixelStorei(37440,!1);e.pixelStorei(3317,1);e.texImage2D(3553,0,o,o,5121,d);e.texParameteri(3553,10242,m);e.texParameteri(3553,10243,A);h.set([d.width,d.height],a)}else{var i=[34069,34070,34071,34072,34073,34074],l=d.width/6,p=d.height;f=g=x(d.height);var r=document.createElement("canvas");r.width=f;r.height=g;for(var I=r.getContext("2d"),C=0;6>C;C++)I.drawImage(d,C*l,0,l,p,0,0,f,g),e.pixelStorei(37440,!1),e.pixelStorei(3317,1),e.texImage2D(i[C],0,o,o,5121,r);h.set([f,
g],a)}e.texParameteri(w,10240,q);e.texParameteri(w,10241,z);s&&e.generateMipmap(w)};this.isFPTexturesSupported=function(){var a=e.isTexFloatEnabled;if("boolean"!==typeof a)a=e.getExtension("OES_texture_float"),e.isTexFloatEnabled=a;return a};this.setImageData=function(d,c,f,g,i,l){b();5126===g&&!e.isTexFloatEnabled&&!y.isFPTexturesSupported()&&(KICK.core.Util.fail("OES_texture_float unsupported on the platform. Using 5121 instead of 5126."),g=5121);if(3553!==w)KICK.core.Util.fail("Texture.setImageData only supported by TEXTURE_2D");
else{var k=o;h.set([d,c],a);n=l;y.bind(0);e.pixelStorei(3317,1);e.texImage2D(3553,0,o,d,c,f,k,g,i);e.texParameteri(3553,10240,q);e.texParameteri(3553,10241,z);e.texParameteri(3553,10242,m);e.texParameteri(3553,10243,A);s&&e.generateMipmap(3553)}};this.setTemporaryTexture=function(){var a=new Uint8Array([255,255,255,0,0,0,0,0,0,255,255,255]),b=o;o=6407;this.setImageData(2,2,0,5121,a,"tempTexture");o=b};Object.defineProperties(this,{textureId:{value:f},name:{get:function(){return p},set:function(a){p=
a}},dimension:{get:function(){return a}},dataURI:{get:function(){return n},set:function(a){a!==n&&(n=a,g.resourceManager.getImageData(n,y))}},wrapS:{get:function(){return m},set:function(a){m=a}},wrapT:{get:function(){return A},set:function(a){A=a}},minFilter:{get:function(){return z},set:function(a){z=a}},magFilter:{get:function(){return q},set:function(a){q=a}},generateMipmaps:{get:function(){return s},set:function(a){s=a}},flipY:{get:function(){return v},set:function(a){v=a}},internalFormat:{get:function(){return o},
set:function(a){6406!==a&&6407!==a&&6408!==a&&6409!==a&&6410!==a&&KICK.core.Util.fail("Texture.internalFormat should be either 6406, 6407, 6408, 6409, or LUMINANCE_ALPHA");o=a}},textureType:{get:function(){return w},set:function(a){3553!==a&&34067!==a&&KICK.core.Util.fail("Texture.textureType should be either 3553 or 34067");w=a}}});this.toJSON=function(){return{uid:y.uid,wrapS:m,wrapT:A,minFilter:z,magFilter:q,name:p,generateMipmaps:s,flipY:v,internalFormat:o,textureType:w,dataURI:n}};l(y,c);if(!e.currentTexture)e.currentTexture=
{};g.project.registerObject(y,"KICK.texture.Texture")};g.MovieTexture=function(g,c){var e=g.gl,f="MovieTexture",h=null,m=e.createTexture(),k=33071,z=33071,q=9728,s=9728,n=6408,v=0,o=!1,w=g.time,r=this,y=-1;this.bind=function(a){e.activeTexture(33984+a);e.bindTexture(3553,m);y<w.frame&&h&&(y=w.frame+v,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),o&&e.generateMipmap(3553))};this.destroy=function(){null!==m&&(e.deleteTexture(m),m=null,g.project.removeResourceDescriptor(r.uid))};
this.setTemporaryTexture=function(){var a=new Uint8Array([255,255,255,0,0,0,0,0,0,255,255,255]);r.bind(0);e.pixelStorei(3317,1);e.texImage2D(3553,0,n,2,2,0,6407,5121,a);e.texParameteri(3553,10240,s);e.texParameteri(3553,10241,q);e.texParameteri(3553,10242,k);e.texParameteri(3553,10243,z)};Object.defineProperties(this,{name:{get:function(){return f},set:function(a){f=a}},skipFrames:{get:function(){return v},set:function(a){v=a}},videoElement:{get:function(){return h},set:function(a){h=a}},generateMipmaps:{get:function(){return o},
set:function(a){o=a}},textureId:{value:m},wrapS:{get:function(){return k},set:function(a){k=a}},wrapT:{get:function(){return z},set:function(a){z=a}},minFilter:{get:function(){return q},set:function(a){q=a}},magFilter:{get:function(){return s},set:function(a){s=a}},internalFormat:{get:function(){return n},set:function(a){6406!==a&&6407!==a&&6408!==a&&6409!==a&&6410!==a&&KICK.core.Util.fail("Texture.internalFormat should be either 6406, 6407, 6408, 6409, or LUMINANCE_ALPHA");n=a}}});this.toJSON=function(){return{uid:r.uid,
wrapS:k,wrapT:z,minFilter:q,name:f,magFilter:s,internalFormat:n}};l(r,c);if(!e.currentTexture)e.currentTexture={};g.project.registerObject(r,"KICK.texture.MovieTexture")}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.scene"),k=KICK.namespace("KICK.core");KICK.namespace("KICK.math");var h=KICK.namespace("KICK.math.vec3"),x=KICK.namespace("KICK.math.quat4"),l=KICK.namespace("KICK.math.vec4"),i=KICK.namespace("KICK.math.mat4"),c=KICK.core.Util.applyConfig,e=KICK.core.Util.insertSorted,f=KICK.core.Util.vec4uint8ToUint32;g.GameObject=function(f,e){var g=new KICK.scene.Transform(this),i=[g],h=1,l,n=f.engine.createUID();Object.defineProperties(this,{scene:{value:f},engine:{value:f.engine},
transform:{value:g},layer:{get:function(){return h},set:function(c){"number"!==typeof c&&KICK.core.Util.fail("GameObject.layer must be a Number");h=c}},name:{get:function(){return l},set:function(c){l=c}},uid:{get:function(){return n},set:function(c){n=c}},numberOfComponents:{get:function(){return i.length}}});this.getComponent=function(c){return i[c]};this.addComponent=function(c){if(!(c instanceof KICK.scene.Transform)){if(c.gameObject)throw{name:"Error",message:"Component "+c+" already added to gameObject "+
c.gameObject};if(!c.scriptPriority)c.scriptPriority=0;c.gameObject=this;i.push(c);this.scene.addComponent(c)}};this.removeComponent=function(c){try{delete c.gameObject}catch(f){}k.Util.removeElementFromArray(i,c);this.scene.removeComponent(c)};this.destroy=function(){var c;for(c=i.length-1;0<=c;c--)this.removeComponent(i[c]);this.scene.destroyObject(this)};this.getComponentOfType=function(c){var f,e;for(e=i.length-1;0<=e;e--)if(f=i[e],f instanceof c)return f;return null};this.getComponentsOfType=
function(c){var f,e,g=[];for(e=i.length-1;0<=e;e--)f=i[e],f instanceof c&&g.push(f);return g};this.toJSON=function(){for(var c=[],e,g=0;g<i.length;g++)e=i[g],e.toJSON?c.push(e.toJSON()):c.push(KICK.core.Util.componentToJSON(f.engine,e));return{name:l,layer:h,uid:n,components:c}};c(this,e,["uid"])};g.Transform=function(c){var f=i.identity(i.create()),e=i.identity(i.create()),g=i.identity(i.create()),l=i.identity(i.create()),s=h.create([0,0,0]),n=h.create([0,0,0]),v=x.create([0,0,0,1]),o=x.create([0,
0,0,1]),w=h.create([1,1,1]),r=new Int8Array(6),y=[],a=null,b=this,d=function(){var a;r[2]=1;r[3]=1;r[4]=1;r[5]=1;for(a=y.length-1;0<=a;a--)y[a]._markGlobalDirty()},j=function(){r[0]=1;r[1]=1;d()};Object.defineProperties(this,{gameObject:{value:c},position:{get:function(){if(null==a)return h.create(n);r[4]&&(i.multiplyVec3(this.getGlobalMatrix(),[0,0,0],s),r[4]=0);return h.create(s)},set:function(b){var d;null==a?this.localPosition=b:(d=this.position,h.set(b,n),this.localPosition=[n[0]+d[0]-b[0],n[1]+
d[1]-b[1],n[2]+d[2]-b[2]])}},localPosition:{get:function(){return h.create(n)},set:function(a){h.set(a,n);j()}},localRotationEuler:{get:function(){var a=h.create();x.toEuler(o,a);return a},set:function(a){x.setEuler(a,o);j()}},rotationEuler:{get:function(){var a=h.create();x.toEuler(this.rotation,a);return a},set:function(a){var b=x.create();x.setEuler(a,b);this.rotation=b}},rotation:{get:function(){var b=null;if(null==a)return x.create(o);if(r[5]){x.set(o,v);for(b=this.parent;null!=b;)x.multiply(b.localRotation,
v,v),b=b.parent;r[5]=!1}return v},set:function(b){if(null==a)this.localRotation=b;else{var d=x.create();x.difference(b,this.rotation,d);this.localRotation=x.multiply(o,d)}}},localRotation:{get:function(){return o},set:function(a){x.set(a,o);j()}},localScale:{get:function(){return h.create(w)},set:function(a){h.set(a,w);for(a=0;a<w.length;a++)0===w[a]&&(w[a]=1.0E-5);j()}},children:{value:y},parent:{get:function(){return a},set:function(b){b===this&&KICK.core.Util.fail("Cannot assign parent to self");
b!==a&&(null===b?(a=null,k.Util.removeElementFromArray(b.children,this)):(a=b,b.children.push(this)),d())}}});this.getLocalMatrix=function(){r[0]&&(i.setTRS(n,o,w,f),r[0]=0);return f};this.getLocalTRSInverse=function(){r[1]&&(i.setTRSInverse(n,o,w,g),r[1]=0);return g};this.getGlobalMatrix=function(){if(r[2]){i.set(b.getLocalMatrix(),e);for(var a=b.parent;null!==a;)i.multiply(a.getLocalMatrix(),e,e),a=a.parent;r[2]=0}return e};this.getGlobalTRSInverse=function(){if(r[3]){i.set(b.getLocalTRSInverse(),
l);for(var a=b.parent;null!==a;)i.multiply(l,a.getLocalTRSInverse(),l),a=a.parent;r[3]=0}return l};this._markGlobalDirty=d;this.toJSON=function(){var d=KICK.core.Util.typedArrayToArray;return{type:"KICK.scene.Transform",uid:c.engine.getUID(b),config:{localPosition:d(n),localRotationQuat:d(o),localScale:d(w),parent:a?KICK.core.Util.getJSONReference(a):null}}};this.str=function(){return JSON.stringify(b.toJSON())}};g.Scene=function(c,f){var e={},i=[],h=[],l=[],n=[],v=[],o=[],w=[],r=[],y=[],a=[],b=[],
d=[],j=new KICK.scene.SceneLights,u="Scene",F=0,t=this,x=function(a,b){return a.scriptPriority-b.scriptPriority},G=function(a,b){return b.cameraIndex-a.cameraIndex},H=function(a){a=new g.GameObject(t,a);l.push(a);i.push(a);return e[a.uid]=a};this.destroy=function(){c.project.removeResourceDescriptor(t.uid);if(t===c.activeScene)c.activeScene=null};this.addComponentListener=function(b){g.ComponentChangedListener.isComponentListener(b)||KICK.core.Util.fail("Component listener does not have the correct interface. It should contain the two functions: componentsAdded(components) and componentsRemoved(components)");
y.push(b);b.componentsAdded(a)};this.findComponentsOfType=function(a){for(var b=[],d=i.length-1;0<=d;d--)for(var c=i[d].getComponentsOfType(a),f=0;f<c.length;f++)b.push(c[f]);return b};this.removeComponentListener=function(a){k.Util.removeElementFromArray(y,a)};this.addComponent=function(a){k.Util.insertSorted(a,w,x);var b=c.getUID(a);e[b]=a};this.getObjectByUID=function(a){return e[a]};this.getGameObjectByName=function(a){for(var b=i.length-1;0<=b;b--){var d=i[b];if(d.name===a)return d}};this.removeComponent=
function(a){k.Util.removeElementFromArray(w,a);r.push(a);delete e[a.uid]};Object.defineProperties(this,{engine:{value:c},name:{get:function(){return u},set:function(a){u=a}},uid:{get:function(){return F},set:function(a){F=a}}});this.createGameObject=function(a){var a=H(a),b=a.transform;e[b.uid]=b;return a};this.destroyObject=function(a){n.push(a);delete e[a.uid]};this.getNumberOfGameObjects=function(){return i.length};this.getGameObject=function(a){return i[a]};this.updateAndRender=function(){var f,
e;if(0<l.length)h=h.concat(l),l.length=0;if(0<w.length){var m=w;w=[];for(f=m.length-1;0<=f;f--)if(e=m[f],a.push(e),"function"===typeof e.activated&&e.activated(),"function"===typeof e.update&&k.Util.insertSorted(e,v,x),"function"===typeof e.lateUpdate&&k.Util.insertSorted(e,o,x),"function"===typeof e.render&&d.push(e),"function"===typeof e.render&&k.Util.removeElementFromArray(d,e),e instanceof g.Camera)KICK.core.Util.insertSorted(e,b,G);else if(e instanceof g.Light)1==e.type?j.ambientLight=e:2===
e.type?j.directionalLight=e:j.otherLights.push(e);for(f=y.length-1;0<=f;f--)y[f].componentsAdded(m)}for(f=v.length-1;0<=f;f--)v[f].update();for(f=o.length-1;0<=f;f--)o[f].lateUpdate();if(0<n.length)k.Util.removeElementsFromArray(h,n),k.Util.removeElementsFromArray(i,n),n.length=0;if(0<r.length){m=r;r=[];for(f=m.length-1;0<=f;f--)if(e=m[f],k.Util.removeElementFromArray(a,e),"function"===typeof e.deactivated&&e.deactivated(),"function"===typeof e.update&&k.Util.removeElementFromArray(v,e),"function"===
typeof e.lateUpdate&&k.Util.removeElementFromArray(o,e),e instanceof g.Camera)k.Util.removeElementFromArray(b,e);else if(e instanceof g.Light)1==e.type?j.ambientLight=null:2===e.type?j.directionalLight=null:k.Util.removeElementFromArray(j.otherLights,e);for(f=y.length-1;0<=f;f--)y[f].componentsRemoved(m)}for(f=b.length-1;0<=f;f--)b[f].renderScene(j);c.gl.flush()};this.toJSON=function(a){for(var b=[],a=a||function(){return!0},d=0;d<i.length;d++){var c=i[d];a(c)&&b.push(c.toJSON())}return{uid:t.uid,
gameObjects:b,name:u}};(function(){var a,b=KICK.core.Util.hasProperty,d=KICK.core.Util.applyConfig;if(f){F=f.uid;u=f.name||"Scene";var g=f.gameObjects,i={},j={};(function(){for(var b=0;b<g.length;b++)a=f.gameObjects[b],a.newObject=H(a),i[a.uid]=a.newObject})();var h=function(a){var d=function(a){if("number"===typeof a)return a;if(Array.isArray(a))for(var b=0;b<a.length;b++)a[b]=d(a[b]);else if(a&&a&&a.ref&&a.reftype)if("project"===a.reftype)a=c.project.load(a.ref);else if("gameobject"===a.reftype||
"component"===a.reftype)a=t.getObjectByUID(a.ref);return a},f={},e;for(e in a)if(b(a,e)){var g=a[e],g=d(g);f[e]=g}return f};(function(){for(var c,g,l,n=f.gameObjects,k=0;k<n.length;k++){l=f.gameObjects[k];a=l.newObject;for(var r=0;l.components&&r<l.components.length;r++)c=l.components[r],"KICK.scene.Transform"===c.type?(g=a.transform,g.uid=c.uid,e[g.uid]=g):(g=KICK.namespace(c.type),g=new g({uid:c.uid}),g.uid=c.uid,a.addComponent(g)),i[c.uid]=g,j[c.uid]=c.config}for(var t in i)if(b(i,t)&&(c=j[t]))c=
h(c),d(i[t],c)})()}c.project.registerObject(t,"KICK.scene.Scene")})()};g.Scene.createDefault=function(c){c=new g.Scene(c);c.createGameObject().addComponent(new g.Camera);return c};g.Camera=function(g){var m,A=this,z,q,s=!0,n=!1,v=null,o=60,w=0.1,r=1E3,y=-1,a=1,b=-1,d=1,j=[0,0,0,1],u=!0,F=!0,t=!0,x,G=1,H=4294967295,I=new KICK.renderer.ForwardRenderer,C,E,B=null,O=null,Y=null,W=l.create(),R=i.create(),S=i.create(),$=i.create(),aa=i.create(),P={viewMatrix:S,projectionMatrix:R,viewProjectionMatrix:$,
lightViewProjectionMatrix:aa},T=[],L=[],U=[],X=[T,L,U],M=l.create([0,0,1,1]),J=function(){x=(F?16384:0)|(t?256:0)},K=function(a){if(m.currentClearColor!==a)m.currentClearColor=a,m.clearColor(a[0],a[1],a[2],a[3])},Q=function(){var c=v?v.dimension:m.viewportSize,f=c[0],e=f*M[0],g=f*M[1],f=f*M[2],c=c[1]*M[3];m.viewport(e,g,f,c);m.scissor(e,g,f,c);if(m.renderTarget!==v)v?v.bind():m.bindFramebuffer(36160,null),m.renderTarget=v;K(j);m.clear(x);u?i.perspective(o,m.viewportSize[0]/m.viewportSize[1],w,r,R):
i.ortho(y,a,b,d,w,r,R);e=z.getGlobalTRSInverse();i.set(e,S);i.multiply(R,S,$)},D=function(a,b){return(a.renderOrder||1E3)-(b.renderOrder||1E3)},Z=function(){for(var a=h.create(),b=z.position,d=L.length-1;0<=d;d--){var c=L[d];c.distanceToCamera=h.lengthSqr(h.subtract(c.gameObject.transform.position,b,a))}L.sort(function(a,b){return b.distanceToCamera-a.distanceToCamera})},V=function(a,b){P.sceneLights=a;I.render(T,P,b);I.render(L,P,b);I.render(U,P,b)},ba=function(a){var b=a.directionalLight,d=b.gameObject.transform,
c=b.shadowRenderTexture,f=c.dimension,e=f[0],f=f[1];m.viewport(0,0,e,f);m.scissor(0,0,e,f);c.bind();K([0,0,0,0]);m.clear(16640);i.ortho(-5,5,-5,5,-10,10,R);d=d.getGlobalTRSInverse();i.set(d,S);i.multiply(R,S,$);V(a,C);i.set($,aa);b.shadowRenderTextureDebug.bind();m.clear(16640);V(a)};this.pick=function(a,b,d,c,f){c=c||1;f=f||1;if(!B)B=[],O=q.project.load(q.project.ENGINE_SHADER_PICK),Y=new KICK.texture.RenderTexture(q,{dimension:m.viewportSize}),Y.name="__pickRenderTexture";B.push({gameObjectPickedFn:a,
x:b,y:m.viewportSize[1]-d,width:c,height:f})};this.activated=function(){var a=this.gameObject;q=a.engine;z=a.transform;m=q.gl;E=a.scene;E.addComponentListener(A);q.config.shadows?C=q.project.load(q.project.ENGINE_SHADER_SHADOWMAP):n&&(n=!1)};this.deactivated=function(){E.removeComponentListener(A)};this.componentsAdded=function(a){for(var b=a.length-1;0<=b;b--){var d=a[b];if("function"===typeof d.render&&d.gameObject.layer&H){var c=d.renderOrder||1E3;2E3>c?e(d,T,D):3E3<=c?e(d,U,D):L.push(d)}}};this.componentsRemoved=
function(a){for(var b=a.length-1;0<=b;b--){var d=a[b];if("function"===typeof d.render)for(var c=X.length-1;0<=c;c--)k.Util.removeElementFromArray(X[c],d)}};this.renderScene=function(a){if(s&&(n&&a.directionalLight&&a.directionalLight.shadow&&ba(a),Q(),a.recomputeDirectionalLight(S),0<L.length&&Z(),V(a),v&&v.colorTexture&&v.colorTexture.generateMipmaps&&(m.bindTexture(m.TEXTURE_2D,v.colorTexture.textureId),m.generateMipmap(m.TEXTURE_2D)),B&&0<B.length)){Y.bind();K(W);m.clear(16640);V(a,O);for(var b=
B.length-1;0<=b;b--)(function(){var a=B[b],d=4*a.width*a.width,c=new Uint8Array(d);m.readPixels(a.x,a.y,a.width,a.height,6408,5121,c);for(var e=[],g={},i=0;i<d;i+=4){var j=c.subarray(i,i+4),j=f(j);if(0<j)if(g[j])g[j]++;else{var h=E.getObjectByUID(j);h&&(e.push(h),g[j]=1)}}e.length&&q.eventQueue.add(function(){for(var b=0;b<e.length;b++){var d=e[b];a.gameObjectPickedFn(d,g[d.uid])}},0)})();B.length=0}};Object.defineProperties(this,{enabled:{get:function(){return s},set:function(a){s=a}},renderShadow:{get:function(){return n},
set:function(a){q?q.config.shadows&&(n=a):n=a}},renderer:{get:function(){return I},set:function(a){"string"===typeof a&&(a=new (KICK.namespace(a)));a&&"function"===typeof a.render&&(I=a)}},layerMask:{get:function(){return H},set:function(a){H=a}},renderTarget:{get:function(){return v},set:function(a){v=a}},fieldOfView:{get:function(){return o},set:function(a){o=a}},near:{get:function(){return w},set:function(a){w=a}},far:{get:function(){return r},set:function(a){r=a}},perspective:{get:function(){return u},
set:function(a){u=a}},left:{get:function(){return y},set:function(a){y=a}},right:{get:function(){return a},set:function(b){a=b}},bottom:{get:function(){return b},set:function(a){b=a}},top:{get:function(){return d},set:function(a){d=a}},cameraIndex:{get:function(){return G},set:function(a){G=a}},clearColor:{get:function(){return l.create(j)},set:function(a){j=l.create(a)}},clearFlagColor:{get:function(){return F},set:function(a){J();F=a}},clearFlagDepth:{get:function(){return t},set:function(a){J();
t=a}},normalizedViewportRect:{get:function(){return M},set:function(a){l.set(a,M)}}});this.toJSON=function(){return{type:"KICK.scene.Camera",uid:A.uid||(q?q.getUID(A):0),config:{enabled:s,renderShadow:n,renderer:I.name,layerMask:H,renderTarget:v,fieldOfView:o,near:w,far:r,perspective:u,left:y,right:a,bottom:b,top:d,cameraIndex:G,clearColor:j,clearFlagColor:F,clearFlagDepth:t,normalizedViewportRect:KICK.core.Util.typedArrayToArray(M)}}};c(this,g);J()};g.Camera.prototype.setupClearFlags=function(c,
f){this.clearColor=c;this.clearDepth=f;delete this._currentClearFlags};g.ComponentChangedListener={isComponentListener:function(c){return c&&"function"===typeof c.componentsAdded&&"function"===typeof c.componentsRemoved}};g.MeshRenderer=function(f){var e,g=[],i,h,l=this;this.activated=function(){e=this.gameObject.transform};Object.defineProperties(this,{renderOrder:{get:function(){return h}},material:{get:function(){return 0===g.length?null:g[0]},set:function(c){g[0]=c;h=g[0].renderOrder}},materials:{get:function(){return g},
set:function(c){g=[];for(var f=0;f<c.length;f++)g[f]=c[f],h=g[f].renderOrder},enumerable:!0},mesh:{get:function(){return i},set:function(c){i=c},enumerable:!0}});this.render=function(c,f){for(var h=g.length,l=0;l<h;l++){var k=f||g[l].shader;i.bind(k);k.bindUniform(g[l],c,e);i.render(l)}};this.toJSON=function(){return KICK.core.Util.componentToJSON(l.gameObject.engine,this,"KICK.scene.MeshRenderer")};c(this,f)};g.Light=function(f){var e=this,g=h.create([1,1,1]),i,l=3,k,n=1,v=0.05,o=null,w=null,r=null,
y=null,a=1,b=h.create(),d=function(){h.set([g[0]*a,g[1]*a,g[2]*a],b)},j,u,x=function(){k?(o=new KICK.texture.Texture(i,{minFilter:9728,magFilter:9728,wrapS:33071,wrapT:33071,flipY:!1,generateMipmaps:!1}),o.setImageData(512,512,0,5121,null,""),w=new KICK.texture.RenderTexture(i,{colorTexture:o}),r=new KICK.texture.Texture(i,{minFilter:9728,magFilter:9728,wrapS:33071,wrapT:33071,flipY:!1,generateMipmaps:!1}),r.setImageData(512,512,0,5121,null,""),y=new KICK.texture.RenderTexture(i,{colorTexture:r})):
w&&(w.destroy(),o.destroy())};Object.defineProperties(this,{shadowRenderTextureDebug:{get:function(){return y}},shadowTextureDebug:{get:function(){return r}},shadowRenderTexture:{get:function(){return w}},shadowTexture:{get:function(){return o}},shadow:{get:function(){return k},set:function(a){a!==k&&(k=a,i&&x())}},shadowStrength:{get:function(){return n},set:function(a){n=a}},shadowBias:{get:function(){return v},set:function(a){v=a}},color:{get:function(){return h.create(g)},set:function(a){h.set(a,
g);d()}},type:{get:function(){return l},set:function(a){i||(l=a)}},intensity:{get:function(){return a},set:function(b){a=b;d()}},colorIntensity:{get:function(){return b},set:function(a){b=a}},gameObject:{get:function(){return j},set:function(a){j=a}},scriptPriority:{get:function(){return u},set:function(a){u=a}}});this.activated=function(){i=e.gameObject.engine;x()};c(this,f)};Object.freeze(g.Light);g.SceneLights=function(){var c=null,f=null,e=h.create(),g=h.create(),k=null;Object.defineProperties(this,
{ambientLight:{get:function(){return c},set:function(f){c=f}},directionalLight:{get:function(){return f},set:function(c){f=c;k=null!==c?f.gameObject.transform:null}},directionalHalfVector:{value:e},directionalLightDirection:{value:g},otherLights:{value:[]}});this.recomputeDirectionalLight=function(c){null!==f&&(l.set([0,0,-1],g),x.multiplyVec3(k.rotation,g),i.multiplyVec3Vector(c,g),h.normalize(g),h.add([0,0,1],g,e),h.normalize(e))}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.mesh");KICK.namespace("KICK.scene");KICK.namespace("KICK.core");KICK.namespace("KICK.math");var k=KICK.namespace("KICK.math.vec3");KICK.namespace("KICK.math.quat4");var h=KICK.namespace("KICK.math.vec4"),x=KICK.namespace("KICK.math.mat4");g.MeshData=function(h){var i={},c=this,e=[],f,p,m,A,z,q=function(){m=p=f=null},s=function(){return i.vertex},n=function(){var c=f.byteLength/m,e,a,b,d,g=0,h;i={};for(e=0;e<c;e++){for(b in p){d=p[b];a=5126===d.type?Float32Array:
Int32Array;0===e&&(i[b]=new a(c*d.size));h=new a(f,g+d.pointer);for(a=0;a<d.size;a++)i[b][e*d.size+a]=h[a]}g+=m}},v=function(c,e){if(5126===c||5124===c){var a=5126===c?Float32Array:Int32Array;return{get:function(){!s()&&f&&n();return i[e]},set:function(b){b&&(b=new a(b));i[e]=b;q()}}}},o=function(){var e=[],g=[],a=[],b=0,d=[],i,h,l=c.vertex,l=l?l.length/3:0,n={};i=function(f,i,j){var h=c[f];h&&(e.push(i),g.push(f),a.push(j),d.push(h),n[f]={pointer:4*b,size:i,normalized:!1,type:j},b+=i)};i("vertex",
3,5126);i("normal",3,5126);i("uv1",2,5126);i("uv2",2,5126);i("tangent",4,5126);i("color",4,5126);i("int1",1,5124);i("int2",2,5124);i("int3",3,5124);i("int4",4,5124);var k=new ArrayBuffer(4*b*l);for(h=0;h<l;h++)for(var q=4*h*b,s=0;s<g.length;s++){i=5126===a[s]?new Float32Array(k,q):new Int32Array(k,q);for(var o=d[s],v=e[s],w=0;w<v;w++)i[w]=o[h*v+w],q+=4}f=k;p=n;m=4*b};this.serialize=function(){var f=new KICK.core.ChunkData;f.setArrayBuffer(1,c.interleavedArray);f.setString(2,JSON.stringify(c.interleavedArrayFormat));
f.setString(3,c.name);var e=c.subMeshes,a=e.length;f.setNumber(4,a);f.setNumber(5,c.vertexAttrLength);for(var b=0;b<a;b++)f.set(10+b,e[b]);return f.serialize()};this.deserialize=function(f){var e=new KICK.core.ChunkData;if(e.deserialize(f)){c.interleavedArray=e.getArrayBuffer(1);c.interleavedArrayFormat=JSON.parse(e.getString(2));c.name=e.getString(3);f=e.getNumber(4);c.vertexAttrLength=e.getNumber(5);for(var a=[],b=0;b<f;b++)a[b]=e.get(10+b);c.subMeshes=a;return!0}return!1};Object.defineProperties(this,
{aabb:{get:function(){var f=c.vertex;if(!f)return null;for(var e=f.length,a=KICK.math.aabb.create(),b=0;b<e;b+=3){var d=f.subarray(b,b+3);KICK.math.aabb.addPoint(a,d)}return a}},name:{get:function(){return z},set:function(c){z=c}},interleavedArray:{get:function(){!f&&s()&&o();return f},set:function(c){c?f=c:q()}},interleavedArrayFormat:{get:function(){!f&&s()&&o();return p},set:function(c){c?p=c:q()}},vertexAttrLength:{get:function(){!f&&s()&&o();return m},set:function(c){c?m=c:q()}},vertex:v(5126,
"vertex"),normal:v(5126,"normal"),uv1:v(5126,"uv1"),uv2:v(5126,"uv2"),tangent:v(5126,"tangent"),color:v(5126,"color"),int1:v(5124,"int1"),int2:v(5124,"int2"),int3:v(5124,"int3"),int4:v(5124,"int4"),indices:{get:function(){return 0==e?null:e[0]},set:function(c){c&&!(c instanceof Uint16Array)&&(c=new Uint16Array(c));e[0]&&s()&&q();c&&(e[0]=c)}},subMeshes:{get:function(){return e},set:function(c){for(var f=0;f<c.length;f++)c[f]&&!(c[f]instanceof Uint16Array)&&(c[f]=new Uint16Array(c[f]));e=c}},meshType:{get:function(){return A},
set:function(c){A=c}}});this.isValid=function(){!s()&&f&&n();for(var c=i.vertex.length/3,g=0;g<e.length;g++)for(var a=e[g].length-1;0<=a;a--)if(e[g][a]>=c){debugger;return!1}return!0};this.isVertexDataInitialized=s;this.isInterleavedDataInitialized=function(){return f};this.transform=function(c){for(var f=new g.MeshData(this),a=k.wrapArray(f.vertex),b=a.length-1;0<=b;b--)x.multiplyVec3(c,a[b]);return f};this.combine=function(f,e){if(c.meshType!==f.meshType||6==c.meshType)return null;for(var a="vertex,normal,uv1,uv2,tangent,color,int1,int2,int3,int4,indices".split(","),
b=a.length-1;0<=b;b--){var d=a[b];(!c[d]||!f[d])&&a.splice(b,1)}b=function(b,c,d){var f,e,g,i,h;for(f=a.length-1;0<=f;f--)if(g=a[f],b[g]){i=c[g];if(d&&"indices"===g){i=new Uint16Array(i);h=i.length;for(e=0;e<h;e++)i[e]+=d}for(e=0;e<i.length;e++)b[g].push(i[e])}else b[g]=KICK.core.Util.typedArrayToArray(c[g])};d={meshType:c.meshType};e&&(f=f.transform(e));b(d,c,0);b(d,f,this.vertex.length/3);5===c.meshType&&d.indices.splice(c.indices,0,d.indices[c.indices.length],d.indices[c.indices.length+1]);return new g.MeshData(d)};
h||(h={});var v=function(){c.vertex=h.vertex?new Float32Array(h.vertex):null;c.normal=h.normal?new Float32Array(h.normal):null;c.uv1=h.uv1?new Float32Array(h.uv1):null;c.uv2=h.uv2?new Float32Array(h.uv2):null;c.tangent=h.tangent?new Float32Array(h.tangent):null;c.color=h.color?new Float32Array(h.color):null;c.int1=h.int1?new Int32Array(h.int1):null;c.int2=h.int2?new Int32Array(h.int2):null;c.int3=h.int3?new Int32Array(h.int3):null;c.int4=h.int4?new Int32Array(h.int4):null},w=function(){c.interleavedArray=
h.interleavedArray;c.interleavedArrayFormat=h.interleavedArrayFormat;c.vertexAttrLength=h.vertexAttrLength};h instanceof g.MeshData?h.isVertexDataInitialized()?v():w():h.vertex?v():h.interleavedArray&&w();c.name=h.name;c.indices=h.indices;c.meshType=h.meshType||4};g.MeshData.prototype.recalculateNormals=function(){var g=this.vertex.length/3,i=this.indices.length/3,c=this.indices,e=k.wrapArray(this.vertex),f,h={},m=k.array(g,h),A=k.create(),z=k.create(),q=k.create();for(f=0;f<i;f++){var s=c[3*f+0],
n=c[3*f+1],v=c[3*f+2],o=e[s],w=e[v];k.subtract(e[n],o,A);k.subtract(w,o,z);k.cross(A,z,q);k.normalize(q);k.add(m[s],q);k.add(m[n],q);k.add(m[v],q)}for(f=0;f<g;f++)k.normalize(m[f]);this.normal=h.mem};g.MeshData.prototype.recalculateTangents=function(){var g=k.wrapArray(this.vertex),i=g.length,c=k.wrapArray(this.normal),e=this.uv1,f=this.indices,p=f.length/3,m=this.tangent,A=k.array(i),z=k.array(i),q,s=k.create(),n=k.create();for(q=0;q<p;q++){var v=f[3*q+0],o=f[3*q+1],w=f[3*q+2],r=g[v],y=g[o],a=g[w],
b=e[v],d=e[o],j=e[w],u=y[0]-r[0],x=a[0]-r[0],t=y[1]-r[1],N=a[1]-r[1],y=y[2]-r[2],r=a[2]-r[2],a=d[0]-b[0],G=j[0]-b[0],d=d[1]-b[1],j=j[1]-b[1],b=1/(a*j-G*d),j=k.create([(j*u-d*x)*b,(j*t-d*N)*b,(j*y-d*r)*b]),u=k.create([(a*x-G*u)*b,(a*N-G*t)*b,(a*r-G*y)*b]);k.add(A[v],j);k.add(A[o],j);k.add(A[w],j);k.add(z[v],u);k.add(z[o],u);k.add(z[w],u)}if(!m)this.tangent=m=new Float32Array(4*i);m=h.wrapArray(m);for(q=0;q<i;q++)g=c[q],e=A[q],k.subtract(e,g,s),k.dot(g,e,n),k.set(k.normalize(k.multiply(s,n)),m[q]),
m[q][3]=0>k.dot(k.cross(g,e,k.create()),z[q])?-1:1};g.Mesh=function(g,i){var c=g.gl,e,f,h=[],k,A,z="memory://void",q=null,s=this,n=0,v,o=[],w={contextLost:function(){},contextRestored:function(a){e=h=null;c=a;y()}},r=function(){for(var a=0;a<h.length;a++)c.deleteBuffer(h[a]);"number"===typeof e&&(c.deleteBuffer(e),e=null);o.length=0;h.length=0},y=function(){var a=A.subMeshes;r();f=A.interleavedArrayFormat;n=A.vertexAttrLength;v=A.meshType;e=c.createBuffer();c.bindBuffer(34962,e);c.bufferData(34962,
A.interleavedArray,35044);for(var b=0;b<a.length;b++){var d=a[b],g=c.createBuffer();o[b]=d.length;h.push(g);c.bindBuffer(34963,g);c.bufferData(34963,d,35044)}};g.addContextListener(w);Object.defineProperties(this,{aabb:{get:function(){if(!q&&A)q=A.aabb;return q}},name:{get:function(){return k},set:function(a){k=a||"Mesh"}},meshData:{get:function(){return A},set:function(a){A=a;q=null;y()}},dataURI:{get:function(){return z},set:function(a){a!==z&&(z=a,g.resourceManager.getMeshData(a,s))}}});KICK.core.Util.applyConfig(this,
i);g.project.registerObject(this,"KICK.mesh.Mesh");this.verify=function(a){var b=[],c,e;for(e in a.lookupAttribute)"string"===typeof e&&((c=f[e])||b.push(e));return null};this.bind=function(a){a.bind();if(c.meshBuffer!==e||c.meshShader!==a){c.meshBuffer=e;c.meshShader=a;c.bindBuffer(34962,e);for(var b in f)if("undefined"!==typeof a.lookupAttribute[b]){var d=f[b],g=a.lookupAttribute[b];c.enableVertexAttribArray(g);c.vertexAttribPointer(g,d.size,d.type,!1,n,d.pointer)}}};this.render=function(a){c.bindBuffer(34963,
h[a]);c.drawElements(v,o[a],5123,0)};this.destroy=function(){null!==e&&(r(),g.removeContextListener(w),g.project.removeResourceDescriptor(s.uid))};this.toJSON=function(){return{uid:s.uid,name:k,dataURI:z}}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.renderer");KICK.namespace("KICK.core");KICK.namespace("KICK.scene");KICK.namespace("KICK.math");g.NullRenderer=function(){};g.NullRenderer.prototype.render=function(){};g.NullRenderer.prototype.name="KICK.renderer.NullRenderer";g.ForwardRenderer=function(){this.render=function(g,h,x){for(var l=g.length,i=0;i<l;i++)g[i].render(h,x)};this.name="KICK.renderer.ForwardRenderer"}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.material"),k=KICK.namespace("KICK.math"),h=k.mat3,x=k.mat4,k=k.vec4,l=KICK.namespace("KICK.core"),i=l.Util.applyConfig,c=KICK.core.Util.uint32ToVec4,e=x.create(),f=h.create(),p=k.create(),m=x.create([0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1]);g.Shader=function(c,f){var e=c.gl,h=this,l=-1,k=!0,m=1029,p=513,r=!1,y=770,a=771,b=!1,d=2.5,j=10,u=1E3,x="memory://void",t="",N,G=g.GLSLConstants,H=G["__error_vs.glsl"],I=G["__error_fs.glsl"],C=KICK.core.Util.fail,E=
function(){N=(y+1E4*a)*(r?-1:1)},B=function(a,b){var d,a=g.Shader.getPrecompiledSource(c,a);d=b?e.createShader(35632):e.createShader(35633);e.shaderSource(d,a);e.compileShader(d);return!e.getShaderParameter(d,35713)?(d=e.getShaderInfoLog(d),"function"===typeof C&&C(d),null):d};Object.defineProperties(this,{name:{get:function(){return t},set:function(a){t=a}},dataURI:{get:function(){return x},set:function(a){x!==a&&(x=a,c.resourceManager.getShaderData(x,h))}},gl:{value:e},vertexShaderSrc:{get:function(){return H},
set:function(a){"string"!==typeof a&&KICK.core.Util.fail("Shader.vertexShaderSrc must be a string");H=a}},fragmentShaderSrc:{get:function(){return I},set:function(a){"string"!==typeof a&&KICK.core.Util.fail("Shader.fragmentShaderSrc must be a string");I=a}},renderOrder:{get:function(){return u},set:function(a){"number"!==typeof a&&KICK.core.Util.fail("Shader.renderOrder must be a number");u=a}},errorLog:{get:function(){return C},set:function(a){C=a}},engine:{value:c},shaderProgramId:{get:function(){return l}},
polygonOffsetEnabled:{get:function(){return b},set:function(a){b=a}},polygonOffsetFactor:{get:function(){return d},set:function(a){d=a}},polygonOffsetUnits:{get:function(){return j},set:function(a){j=a}},faceCulling:{get:function(){return m},set:function(a){m=a}},depthMask:{get:function(){return k},set:function(a){k=a}},zTest:{get:function(){return p},set:function(a){p=a}},blend:{get:function(){return r},set:function(a){r=a;E()}},blendSFactor:{get:function(){return y},set:function(a){y=a;E()}},blendDFactor:{get:function(){return a},
set:function(b){a=b;E()}}});this.markUniformUpdated=function(){e.boundShader=-1;e.meshShader=-1};this.apply=function(){var a=C||console.log,b=B(H,!1,a),c=B(I,!0,a),d=null===c||null===b;d&&(b=B(G["error_vs.glsl"],!1,a),c=B(G["error_fs.glsl"],!0,a));l=e.createProgram();e.attachShader(l,b);e.attachShader(l,c);e.linkProgram(l);if(!e.getProgramParameter(l,35714))return a("Could not initialise shaders"),!1;e.useProgram(l);e.boundShader=l;b=e.getProgramParameter(l,35718);this.activeUniforms=Array(b);this.lookupUniform=
{};for(a=0;a<b;a++)c=e.getActiveUniform(l,a),this.activeUniforms[a]={size:c.size,type:c.type,name:c.name,location:e.getUniformLocation(l,c.name)},this.lookupUniform[c.name]=this.activeUniforms[a];b=e.getProgramParameter(l,35721);this.activeAttributes=Array(b);this.lookupAttribute={};for(a=0;a<b;a++)c=e.getActiveAttrib(l,a),this.activeAttributes[a]={size:c.size,type:c.type,name:c.name},this.lookupAttribute[c.name]=a;h.markUniformUpdated();return!d};this.destroy=function(){-1!==l&&(e.deleteProgram(l),
l=-1,c.project.removeResourceDescriptor(h.uid))};this.isValid=function(){return-1!==l};this.bind=function(){if(e.boundShader!==l){e.boundShader=l;e.useProgram(l);var c=e.faceCulling;if(c!==m)0===m?e.disable(2884):((!c||0===c)&&e.enable(2884),e.cullFace(m)),e.faceCulling=m;if(e.zTest!==p)e.depthFunc(p),e.zTest=p;if(e.depthMaskCache!==k)e.depthMask(k),e.depthMaskCache=k;if(e.blendKey!==N)e.blendKey=N,r?e.enable(3042):e.disable(3042),e.blendFunc(y,a);if(e.polygonOffsetEnabled!==b)(e.polygonOffsetEnabled=
b)?e.enable(32823):e.disable(32823);b&&e.polygonOffset(d,j)}};this.toJSON=function(){return x?{uid:h.uid,name:t,dataURI:x}:{uid:h.uid,name:t,blend:r,blendSFactor:y,blendDFactor:a,dataURI:x,depthMask:k,faceCulling:m,fragmentShaderSrc:I,vertexShaderSrc:H,polygonOffsetEnabled:b,polygonOffsetFactor:d,polygonOffsetUnits:j,renderOrder:u,zTest:p}};i(h,f);c.project.registerObject(h,"KICK.material.Shader");x&&0!==x.indexOf("memory://")?c.resourceManager.getShaderData(x,h):(E(),h.apply())};g.Shader.getPrecompiledSource=
function(c,f){for(var e in g.GLSLConstants)if("string"===typeof e)var i=g.GLSLConstants[e],f=f.replace('#pragma include "'+e+'"',i),f=f.replace("#pragma include '"+e+"'",i);return f="#define SHADOWS "+(!0===c.config.shadows)+"\n#line 1\n"+f};Object.freeze(g.Shader);g.Shader.prototype.bindUniform=function(g,i,h){var l=this.gl,k=g.uniforms,v,o,w,r,y,a=this.lookupUniform._mv,b=this.lookupUniform._proj,d=this.lookupUniform._mvProj,j=this.lookupUniform._norm,u=this.lookupUniform._gameObjectUID,F=this.lookupUniform._time,
t=this.lookupUniform._viewport,N=this.lookupUniform._shadowMapTexture,g=this.lookupUniform._lightMat;v=i.sceneLights;var G=v.ambientLight,H=v.directionalLight,I=v.otherLights,C,E=0;for(o in k)if(w=this.lookupUniform[o])switch(r=k[o],y=w.location,r=r.value,w.type){case 5126:l.uniform1fv(y,r);break;case 35674:l.uniformMatrix2fv(y,!1,r);break;case 35675:l.uniformMatrix3fv(y,!1,r);break;case 35676:l.uniformMatrix4fv(y,!1,r);break;case 35664:l.uniform2fv(y,r);break;case 35665:l.uniform3fv(y,r);break;case 35666:l.uniform4fv(y,
r);break;case 5124:l.uniform1iv(y,r);break;case 35667:l.uniform2iv(y,r);break;case 35668:l.uniform3iv(y,r);break;case 35669:l.uniform4iv(y,r);break;case 35680:case 35678:r.bind(E);l.uniform1i(y,E);E++;break;default:console.log("Warn cannot find type "+w.type)}b&&l.uniformMatrix4fv(b.location,!1,i.projectionMatrix);if(a||j)C=h.getGlobalMatrix(),o=x.multiply(i.viewMatrix,C,e),a&&l.uniformMatrix4fv(a.location,!1,o),j&&(o=x.toNormalMat3(o,f),l.uniformMatrix3fv(j.location,!1,o));d&&(C=C||h.getGlobalMatrix(),
l.uniformMatrix4fv(d.location,!1,x.multiply(i.viewProjectionMatrix,C,e)));if(null!==G)(d=this.lookupUniform._ambient)&&l.uniform3fv(d.location,G.colorIntensity);if(null!==H&&(d=this.lookupUniform["_dLight.colInt"]))l.uniform3fv(d.location,H.colorIntensity),d=this.lookupUniform["_dLight.lDir"],l.uniform3fv(d.location,v.directionalLightDirection),d=this.lookupUniform["_dLight.halfV"],l.uniform3fv(d.location,v.directionalHalfVector);for(v=I.length-1;0<=v;v--);if(F)v=this.engine.time,l.uniform1f(F.location,
v.time);t&&l.uniform2fv(t.location,l.viewportSize);u&&(F=c(h.gameObject.uid,p),3>this.engine.time.frame&&console.log("transform.gameObject.uid "+h.gameObject.uid),l.uniform4fv(u.location,F));N&&(H.shadowTexture.bind(E),l.uniform1i(N.location,E));g&&(C=C||h.getGlobalMatrix(),i=x.multiply(i.lightViewProjectionMatrix,C,e),l.uniformMatrix4fv(g.location,!1,x.multiply(m,i,e)))};g.Material=function(c,f){var e="Material",h=null,k={},m=this,p;Object.defineProperties(this,{engine:{value:c},name:{get:function(){return e},
set:function(c){e=c}},shader:{get:function(){return h},set:function(c){h=c;m.init()}},uniforms:{get:function(){return k},set:function(c){k=c;h&&h.markUniformUpdated()}},renderOrder:{get:function(){return p}}});this.destroy=function(){c.project.removeResourceDescriptor(m.uid)};this.init=function(){"string"===typeof h&&(h=c.project.load(h));h||(KICK.core.Util.fail("Cannot initiate shader in material "+e),h=c.project.load("kickjs://shader/__error/"));p=h.renderOrder};this.toJSON=function(){var f={},
g;for(g in k)if("string"===typeof g){var i=k[g],a=i.value,a=a instanceof Float32Array||a instanceof Int32Array?l.Util.typedArrayToArray(a):KICK.core.Util.getJSONReference(c,a);f[g]={type:i.type,value:a}}return{uid:m.uid,name:e,shader:KICK.core.Util.getJSONReference(c,h),uniforms:f}};(function(){i(m,f);c.project.registerObject(m,"KICK.material.Material");for(var e in k){var h=k[e].type,l=k[e].value;if((35678===h||35680===h)&&l&&"number"===typeof l.ref)k[e].value=c.project.load(l.ref)}g.Material.verifyUniforms(k)})()};
g.Material.verifyUniforms=function(c){var f,e;for(f in c)if(Array.isArray(c[f].value)||"number"===typeof c[f].value)if(e=c[f].type,5124===e||35667===e||35668===e||35669===e)c[f].value=new Int32Array(c[f].value);else if(!(35678===e||35680===e))c[f].value=new Float32Array(c[f].value)}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.mesh"),k=KICK.namespace("KICK.math"),h=k.vec3,x=k.vec2;g.MeshFactory={createTriangleData:function(){var h=Math.sqrt(0.75);return new g.MeshData({name:"Triangle",vertex:[0,1,0,-h,-0.5,0,h,-0.5,0],uv1:[0.5,1,0.125,0.25,0.875,0.25],normal:[0,0,1,0,0,1,0,0,1],indices:[0,1,2]})},createPlaneData:function(){return new g.MeshData({name:"Plane",vertex:[1,-1,0,1,1,0,-1,-1,0,-1,1,0],uv1:[1,0,1,1,0,0,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1],indices:[0,1,2,2,1,3]})},createUVSphereData:function(l,
i,c){if(!l||3>l)l=20;if(!i||2>i)i=10;c||(c=1);for(var e=2*i*(l+1)+2*(i-1),f={},k=h.array(e,f),m={},A=h.array(e,m),z={},e=x.array(e,z),q=[],s=Math.PI/i,n=Math.PI/2,v=2*Math.PI,o=0,w=0;w<i;w++)for(var r=s*w-n,y=s*(w+1)-n,a=Math.sin(r),r=Math.cos(r),b=Math.sin(y),y=Math.cos(y),d=0;d<=l;d++){var j=v/l*d,u=Math.sin(j),F=Math.cos(j),j=F*r,t=a,N=u*r,F=F*y,G=b,u=u*y;h.set([j,t,N],k[o]);x.set([1-d/l,w/i],e[o]);h.set([c*j,c*t,c*N],A[o]);q.push(o);0<w&&0==d&&q.push(o);o++;h.set([F,G,u],k[o]);x.set([1-d/l,(w+
1)/i],e[o]);h.set([c*F,c*G,c*u],A[o]);q.push(o);d==l&&w<i-1&&q.push(o);o++}return new g.MeshData({name:"UVSphere",vertex:m.mem,uv1:z.mem,normal:f.mem,indices:q,meshType:5})},createCubeData:function(h){h||(h=1);return new g.MeshData({name:"Cube",vertex:[h,h,h,-h,h,h,-h,-h,h,h,-h,h,h,h,h,h,-h,h,h,-h,-h,h,h,-h,h,h,h,h,h,-h,-h,h,-h,-h,h,h,-h,h,h,-h,h,-h,-h,-h,-h,-h,-h,h,-h,-h,-h,h,-h,-h,h,-h,h,-h,-h,h,h,-h,-h,-h,-h,-h,-h,h,-h,h,h,-h],uv1:[1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,
0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],color:[1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,0,1,0,1,0,1,1,1],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.importer"),k=KICK.namespace("KICK.math"),h=k.quat4,x=k.mat4,l=function(g,c){return g.querySelector("[id="+c+"]")};g.ColladaImporter={};g.ColladaImporter.import=function(g,c,e){"string"===typeof g&&(g=(new DOMParser).parseFromString(g,"text/xml"));var f={},k=[],m=[],A=function(a,c){c||(c=Array);var a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s{2,}/g," "),f=a.split(" ").map(Number);return!c||c===Array?f:new c(f)},z=function(a){"#"===a.charAt(0)&&(a=a.substring(1));
if(f[a])return f[a];var c=l(g,a),c=A(c.textContent,"float_array"===c.tagName?Float32Array:Int32Array);return f[a]=c},q=function(a){a.getAttribute("semantic");a=l(g,a.getAttribute("source").substring(1));"vertices"===a.tagName&&(a=a.getElementsByTagName("input")[0],a=l(g,a.getAttribute("source").substring(1)));a=a.getElementsByTagName("technique_common")[0].getElementsByTagName("accessor")[0];a.getAttribute("count");var c=Number(a.getAttribute("stride")),f=Number(a.getAttribute("offset"));f||(f=0);
var a=a.getAttribute("source"),e=z(a);return function(a,b){return e[f+c*a+b]}},s=function(a,c,f){for(var e=a.firstChild,g,h,i=function(){return 3},a=Number(a.getAttribute("count")),k=[],l={},m={},n={},p=[],s=KICK.core.Util.contains,r=f.numberOfVertices||0;null!==e;){g=e.tagName;if("input"===g){g=e.getAttribute("semantic");var o=Number(e.getAttribute("offset"));m[g]=new q(e);k.push(g);l[g]=o;n[g]="TEXCOORD"===g?2:3;s(p,o)||p.push(o)}else if("vcount"===g)var v=A(e.textContent,Int32Array),i=function(a){return v[a]};
else if("p"===g){var x=p.length,w=A(e.textContent,Int32Array),o={};for(g=0;g<k.length;g++)o[k[g]]=[];var y=function(a,b,c){var d="",e,g,h,i,p=a*x;for(h=0;h<k.length;h++)g=k[h],e=l[g],e=w[e+p],d+=a+"#"+e+"#";g=f[d];if("number"===typeof g)P.push(g);else{for(h=0;h<k.length;h++){g=k[h];var a=m[g],t=n[g];e=l[g];e=w[e+p];for(i=0;i<t;i++){var s=a(e,i);b[g].push(s)}}b=r;r+=1;c.push(b);f[d]=b}},z=0,P=[];for(g=0;g<a;g++){var T=i(g);for(h=0;3>h;h++)y(z+h,o,P);for(h=3;h<T;h++)y(z+0,o,P),y(z+h-1,o,P),y(z+h,o,
P);z+=T}for(g=0;g<k.length;g++)z=k[g],h=z.toLowerCase(),"texcoord"===h&&(h="uv1"),c[h]&&c[h].length?(T=KICK.core.Util.typedArrayToArray,y=T(c[h]),z=T(o[z]),y.push.apply(y,z),c[h]=y):c[h]=o[z];c.meshType=4;g=c.subMeshes;g.push(P);c.subMeshes=g;console.log("pushing new sub mesh with "+P.length+" as # "+c.subMeshes.length)}e=e.nextSibling}f.numberOfVertices=r},n=function(a,d){var f=e.createGameObject(),g=f.transform;if(d)g.parent=d;f.name=a.getAttribute("id");r.push(f);for(var i=a.firstElementChild;i;){var l=
i.tagName;if("translate"===l||"rotate"===l||"scale"===l||"matrix"===l){var l=g,o=i,q=o.tagName;o.getAttribute("sid");if("translate"===q)l.localPosition=A(o.textContent);else if("rotate"===q){if(o=A(o.textContent),q=o[3])o=h.angleAxis(q,o),l.localRotation=h.multiply(l.localRotation,o,o)}else if("scale"===q)l.localScale=A(o.textContent);else if("matrix"===q)o=A(o.textContent),o=x.decompose(o),l.localPosition=o[0],l.localRotation=o[1],l.localScale=o[2]}else if("instance_geometry"===l){l=f;q=i.getAttribute("url");
o=void 0;q&&(q=q.substring(1));var o=c,v=[],z=void 0,C=void 0;if(y[q])q=y[q];else{q&&"#"===q.charAt(0)&&(q=q.substring(1));for(z=0;z<w.length;z++)if(C=w[z],C.getAttribute("id")===q){var E=C,B=void 0,O=void 0,z=E.getAttribute("name"),C=void 0,B=E.getElementsByTagName("mesh");if(0==B.length)z=null;else{E={};B=B[0];for(O=B.firstChild;null!==O;)B=O.tagName,"lines"===B?console.log("lines - unsupported"):"linestrips - unsupported"===B?console.log("linestrips"):"polygons"===B?console.log("polygons  - unsupported"):
"polylist"===B||"triangles"===B?(C||(C=new KICK.mesh.MeshData({name:z})),s(O,C,E)):"trifans"===B?console.log("trifans unsupported"):"tristrips"===B&&console.log("tristrips - unsupported"),O=O.nextSibling;z=C}z&&(o=new KICK.mesh.Mesh(o,{meshData:z,name:z.name+" mesh"}),k.push(o),v.push(o));break}q=y[q]=v}for(v=0;v<q.length;v++)o=new KICK.scene.MeshRenderer,o.mesh=q[v],z=new KICK.material.Material(c,{name:"Some material",shader:c.project.load(c.project.ENGINE_SHADER_DEFAULT)}),o.material=z,m.push(z),
l.addComponent(o)}else"node"===l?n(i,g):console.log("Unknown tagName '"+l+"'");i=i.nextElementSibling}},v=g.firstChild.getElementsByTagName("library_geometries"),o=g.firstChild.getElementsByTagName("visual_scene"),w;if(!e)e=c.activeScene;v=v[0];w=v.getElementsByTagName("geometry");for(var r=[],y={},v=0;v<o.length;v++)for(var a=o[v].firstElementChild;a;)n(a,null),a=a.nextElementSibling;return{mesh:k,gameObjects:r,materials:m}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.importer");KICK.namespace("KICK.math");g.ObjImporter={};g.ObjImporter.import=function(g,h,x){for(var g=g.split("\n"),l=g.length,i=[],c=[],e=[],f=[],p=[],m=[f],A=[],z=[],q=[],s="MeshObject",n=function(a,c){c||(c=Array);var a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s{2,}/g," "),e=a.split(" ").map(Number);return!c||c===Array?e:new c(e)},v=function(a){for(var c=[],e=0;e<a.length;e++){var f=a[e].split("/"),g=parseInt(f[0]);c.push([g,2<=f.length?parseInt(f[1]):g,
3<=f.length?parseInt(f[2]):g])}return c},o=function(){var a=function(a,b,c){a=a[b-1];for(b=0;b<a.length;b++)c.push(a[b])};if(0!=i.length){var d=x.createGameObject(),g=new KICK.mesh.MeshData,k=new KICK.mesh.Mesh(h),l=[],n=[],o=[],r,w=[],y={},C=0;q.push(k);for(var E=0;E<m.length;E++){f=m[E];r=[];w.push(r);for(var B=0;B<f.length;B++)for(var O=f[B],Y=v(O),W=0;3>W;W++){var R=O[W];"number"===typeof y[R]?r.push(y[R]):(a(i,Y[W][0],l),e.length&&a(e,Y[W][1],o),c.length&&a(c,Y[W][2],n),r.push(C),y[R]=C,C++)}}g.vertex=
l;if(n.length)g.normal=n;if(o.length)g.uv1=o;g.subMeshes=w;k.meshData=g;k.name=s+" mesh";a=new KICK.scene.MeshRenderer;a.mesh=k;for(var S=[],k=function(a){a=new KICK.material.Material(h,{name:a,shader:h.project.load(h.project.ENGINE_SHADER_DEFAULT)});S.push(a);z.push(a)},B=0;B<w.length;B++)B<p.length?(g=p[B],(l=h.project.loadByName(g,"KICK.material.Material"))?S.push(l):k(g)):k("material");a.materials=S;d.name=s;d.addComponent(a);A.push(d);f=[]}},w=0;w<l;w++){var r=g[w].replace(/^\s+|\s+$/g,""),y=
r.indexOf(" ");if(!(0>y)){var a=r.substring(0,y),r=r.substring(y+1);if("o"===a)o(),s=r,p.length=0;else if("usemtl"===a)p.push(r),0<f.length&&(f=[],m[m.length]=f);else if("v"===a)i.push(n(r));else if("vn"===a)c.push(n(r));else if("vt"===a)e.push(n(r));else if("f"===a){a=r.split(" ");f.push(a.slice(0,3));for(r=3;r<a.length;r++)f.push([a[r-1],a[r],a[0]])}}}o();return{mesh:q,gameObjects:A,materials:z}}})();KICK=KICK||{};KICK.namespace=function(g){var g=g.split("."),k=window,h;for(h=0;h<g.length;h+=1)"undefined"===typeof k[g[h]]&&(k[g[h]]={}),k=k[g[h]];return k};
(function(){var g=KICK.namespace("KICK.core"),k=KICK.namespace("KICK.mesh");KICK.namespace("KICK.scene");var h=g.Util.fail,x=function(g){var h=g.split("/");2<h.length?(h=h[h.length-2],h=h.substring(0,1).toUpperCase()+h.substring(1)):h=g;return h};g.ResourceManager=function(h){var i=[new g.URLResourceProvider(h),new g.BuiltInResourceProvider(h)],h=function(c){return function(e,f){for(var g=i.length-1;0<=g;g--){var h=i[g];if(0===e.indexOf(h.protocol)){h[c](e,f);break}}}};this.getMeshData=h("getMeshData");
this.getImageData=h("getImageData");this.getShaderData=h("getShaderData");this.addResourceProvider=function(c){i.push(c)};this.removeResourceProvider=function(c){for(var e=c.length-1;0<=e;e--)i[e]===c&&i.splice(e,1)}};g.URLResourceProvider=function(){Object.defineProperties(this,{protocol:{value:""}});this.getMeshData=function(){h("Not implemented yet")};this.getImageData=function(g,i){var c=new Image;c.onload=function(){try{i.setImage(c,g)}catch(e){h("Exception when loading image "+g)}};c.onerror=
function(c){h(c);h("Exception when loading image "+g)};c.crossOrigin="anonymous";c.src=g}};g.BuiltInResourceProvider=function(h){var i=this;Object.defineProperties(this,{protocol:{value:"kickjs://"}});this.getMeshData=function(c,e){var f,h=g.Util.getParameterInt,i=g.Util.getParameterFloat;if(0==c.indexOf("kickjs://mesh/triangle/"))f=k.MeshFactory.createTriangleData();else if(0==c.indexOf("kickjs://mesh/plane/"))f=k.MeshFactory.createPlaneData();else if(0==c.indexOf("kickjs://mesh/uvsphere/"))f=h(c,
"slices"),h=h(c,"stacks"),i=i(c,"radius"),f=k.MeshFactory.createUVSphereData(f,h,i);else if(0==c.indexOf("kickjs://mesh/cube/"))f=i(c,"length"),f=k.MeshFactory.createCubeData(f);else{KICK.core.Util.fail("No meshdata found for "+c);return}e.meshData=f};this.getMesh=function(c){console.log("getMesh is deprecated. Use getMeshData instead");var e,f=g.Util.getParameterInt,i=g.Util.getParameterFloat,m={name:x(c)};if(0==c.indexOf("kickjs://mesh/triangle/"))e=k.MeshFactory.createTriangleData();else if(0==
c.indexOf("kickjs://mesh/plane/"))e=k.MeshFactory.createPlaneData();else if(0==c.indexOf("kickjs://mesh/uvsphere/"))e=f(c,"slices"),f=f(c,"stacks"),i=i(c,"radius"),e=k.MeshFactory.createUVSphereData(e,f,i);else if(0==c.indexOf("kickjs://mesh/cube/"))e=i(c,"length"),e=k.MeshFactory.createCubeData(e);else return null;if(e)return m.meshData=e,m.dataURI=c,new k.Mesh(h,m)};this.getShaderData=function(c,e){var f,g,h=!1,i=!1,k=!0,l=1E3,s=KICK.material.GLSLConstants,n="phong,__shadowmap,__error,__pick,transparent_phong,unlit,transparent_unlit".split(",");
"kickjs://shader/default/"===c&&(c="kickjs://shader/phong/");for(var v=0;v<n.length;v++){var o=n[v],w=0===c.indexOf("kickjs://shader/"+o+"/");w&&(f=s[o+"_vs.glsl"],g=s[o+"_fs.glsl"],0===o.indexOf("transparent_")&&(h=!0,k=!1,l=2E3),"__shadowmap"===o&&(i=!0));if(w)break}KICK.core.Util.applyConfig(e,{blend:h,depthMask:k,renderOrder:l,polygonOffsetEnabled:i,vertexShaderSrc:f,fragmentShaderSrc:g});e.apply()};this.getShader=function(c){console.log("getShader is deprecated");var e=new KICK.material.Shader(h);
this.getShaderData(c,e);e.name=x(c);e.dataURI=c;return e};this.getImageData=function(c,e){var f;if(0==c.indexOf("kickjs://texture/black/"))f=new Uint8Array([0,0,0,255,0,0,0,255,0,0,0,255,0,0,0,255]);else if(0==c.indexOf("kickjs://texture/white/"))f=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]);else if(0==c.indexOf("kickjs://texture/gray/"))f=new Uint8Array([127,127,127,255,127,127,127,255,127,127,127,255,127,127,127,255]);else return KICK.core.Util.fail("Unknown uri "+
c),null;e.setImageData(2,2,0,5121,f,c)};this.getTexture=function(c){console.log("getTexture is deprecated!");var e=x(c),e=new KICK.texture.Texture(h,{name:e,minFilter:9728,magFilter:9728,generateMipmaps:!1,internalFormat:6408});i.getImageData(c,e);return e}}})();
